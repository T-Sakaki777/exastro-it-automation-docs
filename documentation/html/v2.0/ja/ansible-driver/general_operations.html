
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>8. Ansible-driver &#8212; Documentation  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/option.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/exastro_documents.css?v=2" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/translations.js"></script>
    <script src="../../../_static/jquery-3.6.3.min.js"></script>
    <script src="../../../_static/exastro_documents.js?v=1"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" /> 
  </head>
<body id="page" class="ja">


<div id="container">

<div id="header">
  <header class="divInner">
    <!-- Exastro logo -->
    <div id="logo"><img src="../../../_static/img/exastro.svg" alt="Exastro"></div>
    <!-- Project name -->
    <div id="projectName"><a href="../../../index.html">Documentation</a></div>
    <!-- Heaedr navigation -->
    <div id="headerSearch">
      <form class="search" action="../../../search.html" method="get">
        <input type="text" name="q" aria-labelledby="searchlabel">
        <button type="submit" value="検索"><img src="../../../_static/img/search.png" alt="検索"></button>
      </form>
    </div>
  </header>
</div><!-- End #header -->


<div id="toolbar">
  <div class="divInner">
    
    <div id="documentVersion">
      <dl>
        <dt>Document version</dt>
        <dd>
          <div>
            <select name="version" onchange="location.href=value;">
                file_path: v2.0/ja/ansible-driver/general_operations
                  <option value="#"
                  selected
                  >current</option>
                file_path: v2.0/ja/ansible-driver/general_operations
                  <option value="#"
                  selected
                  >v2.0 (current)</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>

    <div id="documentLanguage">
      <dl>
        <dt>Language</dt>
        <dd>
          <div>
            <select name="lang" onchange="location.href=value;">
                file_path: v2.0/ja/ansible-driver/general_operations
                hasdoc: True
                  <option value="#"
                  selected
                  >日本語</option>
                file_path: v2.0/en/ansible-driver/general_operations
                hasdoc: False
            </select>
          </div>
        </dd>
      </dl>
    </div>
    <div id="toolbarNavigation">
      <ul>
      </ul>
    </div>
  </div>
</div><!-- End #toolbar -->

<div id="sideMenu">

  <div id="menuButton"></div>
  
  <aside class="divInner">
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Exastro IT Automation Documentation</a></li>
</ul>

    <!-- <ul>
      <li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">索引</a></li>
    </ul> -->
    
  </aside>
</div><!-- End #sideMenu -->


<div id="tableOfContents">
  <div id="tocButton"></div>
  <ul>
<li><a class="reference internal" href="#">8. Ansible-driver</a><ul>
<li><a class="reference internal" href="#id1">8.1. はじめに</a></li>
<li><a class="reference internal" href="#id2">8.2. Ansible driver概要</a><ul>
<li><a class="reference internal" href="#ansible-core">Ansible Coreについて</a></li>
<li><a class="reference internal" href="#ansible-automation-controller">Ansible Automation Controllerについて</a></li>
<li><a class="reference internal" href="#id3">Ansible driverについて</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-variable-handling-in-ansible-driver">8.3. Ansible driverでの変数取り扱い</a><ul>
<li><a class="reference internal" href="#id5">変数の種類</a></li>
<li><a class="reference internal" href="#id6">変数の抜出および具体値登録</a></li>
<li><a class="reference internal" href="#id7">代入値登録による変数の扱い</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">8.4. Ansible driver コンソールメニュー構成</a><ul>
<li><a class="reference internal" href="#id9">メニュー/画面一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">8.5. Ansible driver利用手順</a><ul>
<li><a class="reference internal" href="#id11">作業フロー</a><ul>
<li><a class="reference internal" href="#ansible-legacy">Ansible-Legacy作業フロー</a></li>
<li><a class="reference internal" href="#ansible-legacy-role">Ansible-Legacy Role作業フロー</a></li>
<li><a class="reference internal" href="#ansible-pioneer">Ansible-Pioneer作業フロー</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id12">8.6. Ansible driver機能・操作方法説明</a><ul>
<li><a class="reference internal" href="#id13">基本コンソール</a><ul>
<li><a class="reference internal" href="#general-operations-device-list">機器一覧</a></li>
<li><a class="reference internal" href="#general-operations-input-operation-list">オペレーション一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansible">Ansible 共通コンソール</a><ul>
<li><a class="reference internal" href="#general-operations-interface-information">インターフェース情報</a></li>
<li><a class="reference internal" href="#id17">Ansible Automation Controllerホスト一覧</a></li>
<li><a class="reference internal" href="#general-operations-global-variable-list">グローバル変数管理</a></li>
<li><a class="reference internal" href="#general-operations-template-list">テンプレート管理</a></li>
<li><a class="reference internal" href="#general-operations-file-list">ファイル管理</a></li>
<li><a class="reference internal" href="#id21">収集インターフェース情報</a></li>
<li><a class="reference internal" href="#id22">収集項目値管理</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansibel-legacy-legacy-role-pioneer">Ansibel-Legacy／Legacy Role／Pioneer　コンソール</a><ul>
<li><a class="reference internal" href="#os">OS種別マスタ</a></li>
<li><a class="reference internal" href="#movement">Movement一覧</a></li>
<li><a class="reference internal" href="#playbook-ansible-legacy">Playbook素材集（Ansible-Legacyのみ）</a></li>
<li><a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only">ロールパッケージ管理（Ansible-Legacy Roleのみ）</a></li>
<li><a class="reference internal" href="#general-operations-dialog-type-list-ansible-pioneer-only">対話種別リスト（Ansible-Pioneerのみ）</a></li>
<li><a class="reference internal" href="#general-operations-dialog-files-ansible-pioneer-only">対話ファイル素材集（Ansible-Pioneerのみ）</a></li>
<li><a class="reference internal" href="#movement-playbook-movement-movement">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</a></li>
<li><a class="reference internal" href="#general-operations-nested-variable-list-ansible-legacy-role-only">変数ネスト管理（Ansible-Legacy Roleのみ）</a></li>
<li><a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting">代入値自動登録設定</a></li>
<li><a class="reference internal" href="#general-operations-target-host">作業対象ホスト</a></li>
<li><a class="reference internal" href="#general-operations-substitution-value-list">代入値管理</a></li>
<li><a class="reference internal" href="#general-operations-check-operation-status">作業状態確認</a></li>
<li><a class="reference internal" href="#general-operations-execution-list">作業管理</a></li>
<li><a class="reference internal" href="#general-operations-execution">作業実行</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id33">8.7. 構築コード記述方法</a><ul>
<li><a class="reference internal" href="#general-operations-write-playbook-ansible-legacy">Playbook（Ansible-Legacy）の記述</a><ul>
<li><a class="reference internal" href="#id35">ヘッダーセクション</a></li>
<li><a class="reference internal" href="#tasks">tasksセクション</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-write-dialog-file-ansible-pioneer">対話ファイル（Ansible-Pioneer）の記述</a><ul>
<li><a class="reference internal" href="#id37">対話ファイルの構成</a></li>
<li><a class="reference internal" href="#id38">対話コマンド</a><ul>
<li><a class="reference internal" href="#expect">①expectモジュール</a></li>
<li><a class="reference internal" href="#exec">②execモジュール</a></li>
<li><a class="reference internal" href="#state">③stateモジュール</a></li>
<li><a class="reference internal" href="#command">④commandモジュール</a></li>
<li><a class="reference internal" href="#localaction">⑤localactionモジュール</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id39">正規表記</a></li>
<li><a class="reference internal" href="#id40">複数具体値変数使用時の注意事項</a></li>
<li><a class="reference internal" href="#id41">コマンドプロンプト以外のプロンプトを処理する場合の注意事項</a></li>
<li><a class="reference internal" href="#id42">対話ファイル終了時の注意事項</a></li>
<li><a class="reference internal" href="#yaml">対話ファイルをyaml形式で記載する際の注意事項</a></li>
<li><a class="reference internal" href="#lang">構築対象機器のログインユーザーのLANGについての注意事項</a></li>
<li><a class="reference internal" href="#id43">構築対象機器へ投入するコマンドの終端コードについての注意事項</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-write-role-package-ansible-legacy-role">ロールパッケージ（Ansible-Legacy Role）の記述</a><ul>
<li><a class="reference internal" href="#playbook">マスターPlaybook</a><ul>
<li><a class="reference internal" href="#id45">① へッダーセクション</a></li>
<li><a class="reference internal" href="#roles">② rolesセクション</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id46">変数名の一意管理</a></li>
<li><a class="reference internal" href="#defaults-main-yml-ita">デフォルト変数定義ファイル(defaults-&gt;main.yml)のITA独自仕様</a></li>
<li><a class="reference internal" href="#ansible-role-directory-structure">Ansible Role Directory Structureにおける所定ディクレトリのサブディレクトリについて注意事項</a></li>
<li><a class="reference internal" href="#id47">ロールパッケージ内のロール名をディレクトリ階層にした場合の留意点</a></li>
</ul>
</li>
<li><a class="reference internal" href="#itareadme-ansible-legacy-role">ITAreadme（Ansible-Legacy Roleのみ）の記述</a><ul>
<li><a class="reference internal" href="#ita-readme">ITA readmeのファイル名の命名規則</a></li>
<li><a class="reference internal" href="#id48">読替表のフォーマット</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-write-translation-table-ansible-legacy-role-only">読替表（Ansible-Legacy Roleのみ）の記述</a><ul>
<li><a class="reference internal" href="#id50">読替表のファイル名は以下の命名規則</a></li>
<li><a class="reference internal" href="#id51">読替表のフォーマット</a></li>
<li><a class="reference internal" href="#id52">注意事項</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ita-readme-ansible-legacy-role">「ita_readme」と「読替表」の活用例（Ansible-Legacy Roleのみ）</a></li>
<li><a class="reference internal" href="#backyard">BackYardコンテンツ</a><ul>
<li><a class="reference internal" href="#id53">変数自動登録</a></li>
<li><a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting2">代入自動値登録設定</a><ul>
<li><a class="reference internal" href="#id55">① 代入値自動登録に登録されている情報を代入値管理へ反映時</a></li>
<li><a class="reference internal" href="#id56">② 代入値自動登録に登録されていない情報（代入値管理のみに登録）を代入値管理へ反映時</a></li>
<li><a class="reference internal" href="#id57">③ 代入値自動登録に登録されている情報を作業対象ホストへの反映時</a></li>
<li><a class="reference internal" href="#id58">④ 代入値自動登録に登録されていない情報（作業対象ホストのみに登録）を作業対象ホストへ反映時</a></li>
<li><a class="reference internal" href="#id59">⑤ 同一Movementと変数と代入順序に、複数項目の紐付が登録されている場合</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ansibleita">Ansible利用ガイドラインITA追加ルール</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id60">8.8. 運用操作</a><ul>
<li><a class="reference internal" href="#id61">メンテナンス</a></li>
<li><a class="reference internal" href="#general-operations-about-the-maintenance-method">メンテナンス方法について</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id63">8.9. 付録</a><ul>
<li><a class="reference internal" href="#general-operations-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu">Ansible実行時に使用される投入データとITAメニューの紐づけ</a><ul>
<li><a class="reference internal" href="#id65">Ansible-Legacy投入データ</a></li>
<li><a class="reference internal" href="#id66">Ansible-Pioneer投入データ</a></li>
<li><a class="reference internal" href="#ansible-legacyrole">Ansible-LegacyRole投入データ</a></li>
<li><a class="reference internal" href="#id67">投入データを直接実行する方法</a><ul>
<li><a class="reference internal" href="#id68">① 投入データの解凍先ディレクトリの作成</a></li>
<li><a class="reference internal" href="#id69">② 投入データを直接実行するコマンド</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id70">Ansible実行時に作成される結果データ</a><ul>
<li><a class="reference internal" href="#legacy">Legacy結果データに保存されるファイル一覧</a></li>
<li><a class="reference internal" href="#pioneer">Pioneer結果データに保存されるファイル一覧</a></li>
<li><a class="reference internal" href="#legacy-role">Legacy-Role 結果データに保存されるファイル一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-option-parameter-list">オプションパラメータ一覧</a></li>
<li><a class="reference internal" href="#ansible-automation-controllerita">Ansible Automation ControllerでITA独自変数を利用する場合の留意事項</a><ul>
<li><a class="reference internal" href="#ita">ITA独自変数を利用して作成したファイルの取り扱い</a></li>
<li><a class="reference internal" href="#id72">留意事項</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-data-resources-deleted-when-executing">実行時データ削除で削除されるデータリソース</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>


<div id="contents">
<main class="divInner">

 
 <div id="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">HOME</a></li>
    
    <li><span class="section-number">8. </span>Ansible-driver</li>
  </ul>
</div>


<div id="article">
<article class="divInner">
<div class="body" role="main">

  <section id="ansible-driver">
<h1><span class="section-number">8. </span>Ansible-driver<a class="headerlink" href="#ansible-driver" title="この見出しへのパーマリンク">¶</a></h1>
<section id="id1">
<h2><span class="section-number">8.1. </span>はじめに<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本書では、ITAの機能および操作方法について説明します。</div>
</div>
</section>
<section id="id2">
<h2><span class="section-number">8.2. </span>Ansible driver概要<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章ではAnsible、Ansible Automation ControllerおよびAnsible driverについて説明します。</div>
</div>
<section id="ansible-core">
<h3>Ansible Coreについて<a class="headerlink" href="#ansible-core" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible Coreとは、多数の構築管理対象に対して、アプリーケーション/システムのデプロイ作業を容易にするPF構築自動化ツールです。</div>
<div class="line">Ansible Coreは、PlaybookというYAML形式のテキストファイルに定型処理をタスクとして記述し、それをAnsible Coreに実行させることにより、さまざまな処理を実現できます。</div>
<div class="line">タスクはモジュールと呼ばれる処理プログラムと紐付いており、さまざまな機器に対する制御を行うことができます。</div>
<div class="line">Ansible Coreの詳細情報については、Ansible Coreのマニュアルを参照してください。</div>
</div>
</section>
<section id="ansible-automation-controller">
<h3>Ansible Automation Controllerについて<a class="headerlink" href="#ansible-automation-controller" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible Automation Controllerとは、PF構築自動化ツールであるAnsibleにアクセスコントロール、ジョブスケジューリング、タスクの可視化などの機能を拡張した管理プラットフォームです。</div>
<div class="line">“プロジェクト”、”インベントリ”、”認証情報”の組合せで”ジョブテンプレート”を作成しAnsibleを実行できます。</div>
<div class="line">複数の“ジョブテンプレート”を組み合せて”ワークフロージョブテンプレート”を作成することによって、より多彩な作業フローを表現することができます。</div>
<div class="line">Ansible Automation Controllerの詳細情報については、Ansible Automation Controllerのマニュアルを参照してください。</div>
<div class="line">ITAで対応可能なAnsible Automation Controllerのバージョンは、 <a class="reference internal" href="architecture.html"><span class="doc">目次</span></a> を参照してください。</div>
<div class="line">最新のバージョンに対応した記法は使えないことがありますので、ご注意ください。</div>
</div>
</section>
<section id="id3">
<h3>Ansible driverについて<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible driverは、ITAシステムのオプションとして機能し、ITAシステムで登録した構築対象のサーバ・ストレージ・ネットワーク各機器に対し、Ansible Core、Ansible Automation Controllerのどちらを経由するかを選択し、実際の運用設定を自動的に行います。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image41.png"><img alt="../../../_images/image41.png" class="align-center" src="../../../_images/image41.png" style="width: 6.68819in; height: 3.35972in;" /></a>
<div class="line-block">
<div class="line">Ansible driverには用途に応じて以下3つのモードを用意しています。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>Legacy モード</strong></div>
<div class="line">Ansible標準の機能を用いて各種ホストへ設定を投入します。</div>
<div class="line">構築コードを単体YAMLファイルとして登録し、作業パターンをその組み合わせで構成します。</div>
<div class="line">OS,NWの環境設定などの作業用に使われることを想定します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Legacy Role モード</strong></div>
<div class="line">Legacyモードと同じく、Ansible標準の機能を用いて各種ホストへ設定を投入します。</div>
<div class="line">構築コードをパッケージとして登録し、作業パターンをRoleの組み合わせで構成します。</div>
<div class="line">製品部門などが提供するRoleパッケージを用いて、製品のインストール、環境構築などを行う際に使われることを想定します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Pioneer モード</strong></div>
<div class="line">Ansibleに独自モジュールを追加し、対話形式による設定投入を可能とします。</div>
<div class="line">サーバ、ストレージ、ネットワークを問わず、Telnet, SSH でログイン可能なあらゆる機器に対応しています。対象機器と直接やり取りが必要となるため、相応のＩＴスキルが必要となります。</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">また、Ansible driverは、Playbook中の変数を画面から設定することができます。詳細は本書「 <a class="reference internal" href="#general-operations-variable-handling-in-ansible-driver"><span class="std std-ref">Ansible driverでの変数取り扱い</span></a> 」をご参照ください。</div>
</div>
</section>
</section>
<section id="general-operations-variable-handling-in-ansible-driver">
<span id="id4"></span><h2><span class="section-number">8.3. </span>Ansible driverでの変数取り扱い<a class="headerlink" href="#general-operations-variable-handling-in-ansible-driver" title="この見出しへのパーマリンク">¶</a></h2>
<section id="id5">
<h3>変数の種類<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible driverでは、Playbook中の変数の具体値をITAの設定画面から設定することができます。</div>
<div class="line"><strong>※設定方法の詳細は、本書「</strong> <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> <strong>」を参照してください。</strong></div>
<div class="line">Playbook中の変数で、ITAの変数として扱える変数は以下の8種類があります。</div>
</div>
<table class="docutils align-left" id="id74">
<caption><span class="caption-text">変数の種類</span><a class="headerlink" href="#id74" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 16.4%" />
<col style="width: 59.0%" />
<col style="width: 8.2%" />
<col style="width: 8.2%" />
<col style="width: 8.2%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>種類</strong></p></th>
<th class="head"><p><strong>内容</strong></p></th>
<th class="head"><p><strong>Legacy</strong></p></th>
<th class="head"><p><strong>Pioneer</strong></p></th>
<th class="head"><p><strong>Legacy</strong>
<strong>Role</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>通常変数</p></td>
<td><p>変数名に対して具体値を1つ定義できる変数です。</p>
<p>Playbook内の変数は {{△VAR_xxx△}} で記述してください。</p>
<p>△:半角スペース　xxx: 半角英数字とアンダースコア（ _ ）</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</pre></div>
</div>
</td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td><p>複数具体値変数</p></td>
<td><p>変数名に対して具体値を複数定義できる変数です。</p>
<p>Playbook内の変数は {{△VAR_xxx△}} で記述してください。</p>
<p>△:半角スペース　xxx: 半角英数字とアンダースコア（ _ ）</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</pre></div>
</div>
</td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-even"><td><p>多段変数</p></td>
<td><p>階層化された変数です。</p>
<p>Playbook内の変数は {{△VAR_xxx△}} で記述してください。</p>
<p>△:半角スペース　xxx: 半角英数字とアンダースコア（ _ ）</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">user-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alice</span>
<span class="w">      </span><span class="nt">authorized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</pre></div>
</div>
<p>メンバー変数名は、下記の7文字を除くascii文字(0x20～0x7e)が使用出来ます。</p>
<p>&quot; . [ ] ' \ :</p>
<p>尚、コーテーションで囲まないと変数名の先頭に使用出来ない文字がいくつかあります。詳しくは、Ansibleドキュメント <a class="reference external" href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html">Yaml syntax</a> を参照下さい。</p>
</td>
<td><p>×</p></td>
<td><p>×</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td><p>グローバル変数</p></td>
<td><p>「グローバル変数」メニューから登録された変数です。</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-even"><td><p>テンプレート埋込変数</p></td>
<td><p>「テンプレート管理」メニューから登録された変数です。</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td><p>ファイル埋込変数</p></td>
<td><p>「ファイル管理」メニューから登録された変数です。</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-even"><td><p>ITA独自変数</p></td>
<td><p>ITA 独自で定義された変数です。</p>
<p>基本コンソールの機器一覧の下記項目を変数として扱えます。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ホスト名</p></td>
<td><p>__loginhostname__</p></td>
</tr>
<tr class="row-odd"><td><p>プロトコル</p></td>
<td><p>__loginprotocol__</p></td>
</tr>
<tr class="row-even"><td><p>ログインユーザID</p></td>
<td><p>__loginuser__</p></td>
</tr>
<tr class="row-odd"><td><p>ログインパスワード</p></td>
<td><p>__loginpassword__</p></td>
</tr>
</tbody>
</table>
<p><strong>変数名の前後の「__」は半角アンダーバー2文字です。</strong></p>
<p>機器一覧については、 <a class="reference internal" href="../it_automation_base/basic_console.html"><span class="doc">基本コンソール</span></a> を参照してください。</p>
<p>作業実行時のオペレーションを変数として扱えます。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>オペレーション</p></td>
<td><p>__operation__</p></td>
</tr>
</tbody>
</table>
<p>設定値 : 実施予定日時「YYYY/MM/DD HH:MM」_オペレーションID:オペレーション名称</p>
<p>作業実行時のディレクトリパスを下記の変数として扱えます。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>作業ディレクトリパス</p></td>
<td><p>__workflowdir__</p></td>
</tr>
</tbody>
</table>
<p>Playbook内で作業ディレクトリパス配下にファイルを作成することで、「<em>作業実行</em>」の結果データでファイルをダウンロードすることができます。</p>
<p>Symphony実行時の各Movementで共有するディレクトリパスを下記の変数として扱えます。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Symphony</p>
<p>作業ディレクトリパス</p>
</td>
<td><p>__symphony_workflowdir__</p></td>
</tr>
</tbody>
</table>
<p>Playbook内でSymphony作業ディレクトリパス配下にファイルを作成することで、各Movement間でファイルを共有することが出来ます。
また、ansible driverの作業実行から実行した場合は__workflowdir__と同じパスが設定されます。</p>
<p>Conductor実行時の各Movementで共有するディレクトリパスを下記の変数として扱えます。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Conductor</p>
<p>作業ディレクトリパス</p>
</td>
<td><p>__conductor_workflowdir__</p></td>
</tr>
</tbody>
</table>
<p>Playbook内でConductor作業ディレクトリパス配下にファイルを作成することで、各Movement間でファイルを共有することが出来ます。また、ansible driverの作業実行から実行した場合は__workflowdir__と同じパスが設定されます。</p>
<p>Conductorの「Status file branch」ノードで参照するステータスファイルのファイルパスを下記の変数として扱えます。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ステータスファイルパス</p></td>
<td><p>__movement_status_filepath__</p></td>
</tr>
</tbody>
</table>
<p>Playbook内で作業ディレクトリパス配下にステータスファイルを作成することでができます。</p>
<p>収集機能の各ファイルパスを下記の変数として扱えます。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>作業ディレクトリ（in）の「_parameters」のパス</p></td>
<td><p>__parameters_dir_for_epc__</p></td>
</tr>
<tr class="row-odd"><td><p>作業ディレクトリ（in）の「_parameters_file」のパス</p></td>
<td><p>__parameters_file_dir_for_epc__</p></td>
</tr>
<tr class="row-even"><td><p>作業結果ディレクトリ（out）の「_parameters」のパス</p></td>
<td><p>__parameter_dir__</p></td>
</tr>
<tr class="row-odd"><td><p>作業結果ディレクトリ（out）の「_parameters_file」のパス</p></td>
<td><p>__parameters_file_dir__</p></td>
</tr>
</tbody>
</table>
<p>「_parameters」：ソースファイル（パラメータ）格納先用</p>
<p>「_parameters_file」：収集したファイルの格納先用</p>
<p>※パラメータの対象がファイルアップロードカラムの場合のファイル配置</p>
<p>収集機能の詳細については、「ITA_利用手順マニュアル収集機能」を参照して下さい。</p>
</td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td><p>読替変数</p></td>
<td><p>Defaults変数定義ファイルまたはITA readmeに定義されている「VAR_×××」形式以外の変数をITAで扱う場合の変数「LCA_×××」です。</p>
<p>詳細は「 <a class="reference internal" href="#general-operations-write-translation-table-ansible-legacy-role-only"><span class="std std-ref">読替表（Ansible-Legacy Roleのみ）の記述</span></a> 」を参照して下さい。</p>
</td>
<td><p>×</p></td>
<td><p>×</p></td>
<td><p>○</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id6">
<h3>変数の抜出および具体値登録<a class="headerlink" href="#id6" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">各モードとも、ITAにアップロードしたPlaybook等の資材から変数を抜出し、各メニューから具体値を登録できます。各メニューから登録した変数の具体値は、作業実行時にホスト変数ファイルに出力されます。</div>
<div class="line">変数の抜出方法は以下のとおりです。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>Ansible-Legacy</strong></div>
<div class="line">「Playbook素材集 (本書： <a class="reference internal" href="#general-operations-playbook-file-list-ansible-legacy-only"><span class="std std-ref">Playbook素材集（Ansible-Legacyのみ）</span></a> )」でアップロードしたPlaybookより、以下の書式の変数定義を抜出します。</div>
</div>
<table class="docutils align-left" id="id75">
<caption><span class="caption-text">変数の抜出および具体値登録（Ansible-Legacy）</span><a class="headerlink" href="#id75" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>書式</p></th>
<th class="head"><p>具体値の設定</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>{{△VAR_xxx△}}</p>
<p>{{△VAR_xxx△|△フィルター△}}</p>
</td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a>」や「<a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a>」メニューより行います。</p>
<p>具体値の登録の仕方で通常変数か複数具体値変数かを決定します。</p>
</td>
</tr>
<tr class="row-odd"><td><p>{{△GBL_xxx△}}</p>
<p>{{△GBL_xxx△|△フィルター△}}</p>
</td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-global-variable-list"><span class="std std-ref">グローバル変数管理</span></a>」メニューより行います。</p></td>
</tr>
<tr class="row-even"><td><p>{{△TPF_xxx△}}</p>
<p>{{△TPF_xxx△|△フィルター△}}</p>
</td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-template-list"><span class="std std-ref">テンプレート管理</span></a>」メニューより行います。</p></td>
</tr>
<tr class="row-odd"><td><p>{{△CPF_xxx△}}</p>
<p>{{△CPF_xxx△|△フィルター△}}</p>
</td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-file-list"><span class="std std-ref">ファイル管理</span></a>」メニューより行います。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※ △:半角スペース　xxx: 半角英数字とアンダースコア（ _ ）</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Ansible-Pioneer</strong></div>
<div class="line">「対話ファイル素材 (本書： <a class="reference internal" href="#general-operations-dialog-files-ansible-pioneer-only"><span class="std std-ref">対話ファイル素材集（Ansible-Pioneerのみ）</span></a> )」でアップロードした対話ファイルより、以下の書式の変数定義を抜出します。</div>
</div>
<table class="docutils align-left" id="id76">
<caption><span class="caption-text">変数の抜出および具体値登録（Ansible-Pioneer）</span><a class="headerlink" href="#id76" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>書式</p></th>
<th class="head"><p>具体値の設定</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>{{△VAR_xxx△}}</p></td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a>」や「<a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a>」メニューより行います。</p>
<p>具体値の登録の仕方で通常変数か複数具体値変数かを決定します。</p>
</td>
</tr>
<tr class="row-odd"><td><p>{{△GBL_xxx△}}</p></td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-global-variable-list"><span class="std std-ref">グローバル変数管理</span></a>」メニューより行います。</p></td>
</tr>
<tr class="row-even"><td><p>{{△TPF_xxx△}}</p></td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-template-list"><span class="std std-ref">テンプレート管理</span></a>」メニューより行います。</p></td>
</tr>
<tr class="row-odd"><td><p>{{△CPF_xxx△}}</p></td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-file-list"><span class="std std-ref">ファイル管理</span></a>」メニューより行います。</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><strong>Ansible-Legacy Role</strong></div>
<div class="line">「ロールパッケージ管理 (本書： <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理（Ansible-Legacy Roleのみ）</span></a> )」でアップロードしたロールパッケージ内のdefaults変数定義ファイルより変数定義の抜出を行います。</div>
<div class="line">詳しくは「ロールパッケージの記述(本書： <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理（Ansible-Legacy Roleのみ）</span></a> )」を参照してください。</div>
<div class="line">また、読替表を作成することでdefaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」以外の変数をITAで扱うことが出来ます。詳しくは「 <a class="reference internal" href="#general-operations-write-translation-table-ansible-legacy-role-only"><span class="std std-ref">読替表（Ansible-Legacy Roleのみ）の記述</span></a> 」を参照して下さい。</div>
<div class="line">また、アップロードしたロールパッケージ内のplaybookより、以下の書式の変数定義を抜出します。</div>
</div>
<table class="docutils align-left" id="id77">
<caption><span class="caption-text">変数の抜出および具体値登録（Ansible-Legacy Role）</span><a class="headerlink" href="#id77" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 12.5%" />
<col style="width: 12.5%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>書式</p></th>
<th class="head" colspan="2"><p>ロールパッケージ内のディレクトリ</p></th>
<th class="head" rowspan="2"><p>具体値の設定</p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>tasks</strong></p>
<p><strong>templates</strong></p>
<p><strong>handlers</strong></p>
<p><strong>meta</strong></p>
</th>
<th class="head"><p><strong>その他</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>{{△GBL_xxx△}}</p>
<p>{{△GBL_xxx△|△フィルター△}}</p>
</td>
<td rowspan="3"><p><strong>○</strong></p></td>
<td rowspan="3"><p><strong>×</strong></p></td>
<td><p>具体値の登録は「 <a class="reference internal" href="#general-operations-global-variable-list"><span class="std std-ref">グローバル変数管理</span></a> 」メニューより行います。</p></td>
</tr>
<tr class="row-even"><td><p>{{△TPF_xxx△}}</p>
<p>{{△TPF_xxx△|△フィルター△}}</p>
</td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-template-list"><span class="std std-ref">テンプレート管理</span></a>」メニューより行います。</p></td>
</tr>
<tr class="row-odd"><td><p>{{△CPF_xxx△}}</p>
<p>{{△CPF_xxx△|△フィルター△}}</p>
</td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-file-list"><span class="std std-ref">ファイル管理</span></a>」メニューより行います。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※ 〇：変数定義抜出対象のplaybook　 ×：変数定義抜出対象外のplaybook</div>
</div>
</li>
</ol>
</section>
<section id="id7">
<h3>代入値登録による変数の扱い<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Playbookで定義した変数の値は代入値登録機能により上書きすることができます。</div>
<div class="line">Playbook中の変数と、代入値管理機能で登録した変数の値の関係を、以下の図に示します。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image_2a_1.png"><img alt="../../../_images/image_2a_1.png" class="align-center" src="../../../_images/image_2a_1.png" style="width: 6.68819in; height: 3.35972in;" /></a>
<div class="line-block">
<div class="line">代入値管理機能で登録した変数の値は、各ホスト用に変数定義ファイル(host_vars)に出力され、Ansibleで元のPlaybookと変数定義用ファイルを入力として各ホストに実行されます。</div>
</div>
<div class="line-block">
<div class="line">この結果、変数の値の優先順位は以下のようになります。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">代入値管理機能で登録した値</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Playbook中の変数に指定した値</div>
<div class="line">詳細は 「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」を参照してください。</div>
</div>
</li>
</ol>
</section>
</section>
<section id="id8">
<h2><span class="section-number">8.4. </span>Ansible driver コンソールメニュー構成<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章では、ITAコンソールのメニュー構成について説明します。</div>
</div>
<section id="id9">
<h3>メニュー/画面一覧<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">¶</a></h3>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>ITA 基本コンソールのメニュー</strong></div>
<div class="line">Ansible driverで利用するITA基本コンソールのメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id78">
<caption><span class="caption-text">基本コンソール メニュー/画面一覧</span><a class="headerlink" href="#id78" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 17.6%" />
<col style="width: 23.5%" />
<col style="width: 52.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>No</strong></p></th>
<th class="head"><p><strong>メニューグループ</strong></p></th>
<th class="head"><p><strong>メニュー・画面</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td rowspan="3"><p>ITA基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>作業対象システム一覧をメンテナンス(閲覧/登録/更新/廃止)します。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>紐付対象メニュー</p></td>
<td><p>代入値自動登録設定と連携するCMDBを管理します。</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>投入オペレーション一覧</p></td>
<td><p>オペレーション一覧をメンテナンス(閲覧/登録/更新/廃止)できます。</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><strong>Ansible共通コンソールのメニュー</strong></div>
<div class="line">Ansible共通コンソールのメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id79">
<caption><span class="caption-text">共通コンソール メニュー/画面一覧</span><a class="headerlink" href="#id79" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 17.6%" />
<col style="width: 17.6%" />
<col style="width: 58.8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>No</strong></p></th>
<th class="head"><p><strong>メニューグループ</strong></p></th>
<th class="head"><p><strong>メニュー・画面</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td rowspan="5"><p>Ansible共通コンソール</p></td>
<td><p>インターフェース情報</p></td>
<td><p>Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンとし構築作業をするか選択をします。</p>
<p>ITAシステム・Ansibledriverサーバと実行エンジンのサーバが共有するディレクトリのパスおよび、実行エンジンのサーバへの接続インターフェース情報を管理します。</p>
</td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Ansible Automation Controllerホスト一覧</p></td>
<td><p>Ansible Automation ControllerのRestAPI実行に必要な情報、および構築資材をAnsible Automation
Controllerにファイル転送するために必要な情報を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>グローバル変数管理</p></td>
<td><p>Playbookや対話ファイルなどで共通利用する変数（以降、グローバル変数と称す）と具体値を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>テンプレート管理</p></td>
<td><p>Playbook内のtemplateモジュールでなどで使用するテンプレートファイルと埋め込み変数を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>ファイル管理</p></td>
<td><p>Playbook内の各モジュールで使用する素材ファイルと埋め込み変数を管理します。</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><strong>Ansibleコンソールのメニュー</strong></div>
<div class="line">各Ansibleコンソールに対応するメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id80">
<caption><span class="caption-text">Ansible driverコンソール メニュー/画面一覧</span><a class="headerlink" href="#id80" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="3"><p><strong>No</strong></p></th>
<th class="head" colspan="3"><p><strong>メニューグループ</strong></p></th>
<th class="head" rowspan="3"><p><strong>メニュー・画面</strong></p></th>
<th class="head" rowspan="3"><p><strong>非表示メニュー※</strong></p></th>
<th class="head" rowspan="3"><p><strong>説明</strong></p></th>
</tr>
<tr class="row-even"><th class="head" colspan="3"><p><strong>Ansibleコンソール</strong></p></th>
</tr>
<tr class="row-odd"><th class="head"><p><strong>Legacy</strong></p></th>
<th class="head"><p><strong>Legacy</strong></p>
<p><strong>Role</strong></p>
</th>
<th class="head"><p><strong>Pioneer</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td><p>OS種別</p></td>
<td></td>
<td><p>Pioneerより操作対象となる機器のOS種別を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>Movement一覧</p></td>
<td></td>
<td><p>Symphonyに登録するMovementの一覧を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td></td>
<td><p>Playbook素材集</p></td>
<td></td>
<td><p>Playbookファイルを管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td><p>ロールパッケージ管理</p></td>
<td></td>
<td><p>ロールパッケージを管理します。</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td><p>対話種別リスト</p></td>
<td></td>
<td><p>同一目的の対話ファイルを対話種別としてまとめる種別を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td><p>対話ファイル素材集</p></td>
<td></td>
<td><p>対話種別に紐づけるOS種別とITAシステム独自フォーマットの作業手順ファイル（以降、対話ファイルと称します。）を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</p></td>
<td></td>
<td><p>Movementとプレイブック素材の関連付けを管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td><p>変数ネスト管理</p></td>
<td></td>
<td><p>多段変数が繰返配列で構成されている場合の最大繰返配列数を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>代入値自動登録設定</p></td>
<td></td>
<td><p>CMDBのメニューに登録されているオぺレーションとホスト毎の項目値を紐付けるMovementと変数を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>作業対象ホスト</p></td>
<td></td>
<td><p>Movementで使用するホストを管理します。</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>代入値管理</p></td>
<td></td>
<td><p>変数の代入値を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>作業実行</p></td>
<td></td>
<td><p>作業実行するMovementとオペレーションを選択し実行を指示します。</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>作業状態確認</p></td>
<td></td>
<td><p>作業実行状態を表示します。</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>作業管理</p></td>
<td></td>
<td><p>作業実行履歴を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>15</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>変数名一覧</p></td>
<td><p>○</p></td>
<td><p>Legacy:</p>
<p>Playbook素材集にアップロードしたPlaybookで使用している変数名を管理します。</p>
<p>pioneer:</p>
<p>対話ファイル素材集にアップロードした対話ファイルで使用している変数名を管理します。</p>
<p>Legacy:-role:</p>
<p>ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内のデフォルト変数定義ファイルやITAreadmeファイルで定義している変数名を管理します。</p>
</td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p><strong>○</strong></p></td>
<td><p>Movement変数紐付管理</p></td>
<td><p>○</p></td>
<td><p>Movementで使用している変数を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>17</p></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td><p>ロール名管理</p></td>
<td><p>○</p></td>
<td><p>ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内に登録しているロールを管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>18</p></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td><p>ロール変数名管理</p></td>
<td><p>○</p></td>
<td><p>ロールパッケージ管理にアップロードしたロールパッケージファイル「 zip」内のデフォルト変数定義ファイルやITAreadmeファイルで定義している変数名をロール毎に管理します。</p></td>
</tr>
<tr class="row-even"><td><p>19</p></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td><p>変数具体値管理</p></td>
<td><p>○</p></td>
<td><p>ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内のデフォルト変数定義ファイルやITAreadmeファイルで定義している変数の具体値を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>20</p></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td><p>メンバー変数管理</p></td>
<td><p>○</p></td>
<td><p>ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内のデフォルト変数定義ファイルやITAreadmeファイルで定義している多段変数のメンバー変数を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>21</p></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td><p>多段変数メンバー管理</p></td>
<td><p>○</p></td>
<td><p>ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内のデフォルト変数定義ファイルやITAreadmeファイルで定義している多段変数の構造を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>22</p></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td><p>多段変数配列組合せ管理</p></td>
<td><p>○</p></td>
<td><p>ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内のデフォルト変数定義ファイルやITAreadmeファイルで定義している多段変数の繰り返し数を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>23</p></td>
<td></td>
<td><p><strong>○</strong></p></td>
<td></td>
<td><p>読替変数一覧</p></td>
<td><p>○</p></td>
<td><p>ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内の読替表ファイルで定義している変数を管理します。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※ 非表示メニューは、バックヤード機能でデータの登録・更新を行うメニューです。</div>
<div class="line">Ansible Driver機能をインストールした状態では表示されないメニューに設定されています。</div>
<div class="line">非表示メニューを表示するには、「管理コンソール/ロール・メニュー紐付管理」で各メニューの復活処理を行います。詳細は <a class="reference internal" href="../it_automation_base/management_console.html"><span class="doc">管理コンソール</span></a> を参照してください。</div>
<div class="line">尚、データの更新を行うとバックヤード機能が正しく動作しなくなります。データの更新はしないで下さい。</div>
</div>
</div>
</li>
</ol>
</section>
</section>
<section id="id10">
<h2><span class="section-number">8.5. </span>Ansible driver利用手順<a class="headerlink" href="#id10" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">各Ansibleコンソールの利用手順について説明します。</div>
</div>
<section id="id11">
<h3>作業フロー<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">各Ansibleコンソールにおける標準的な作業フローは以下のとおりです。</div>
<div class="line">各作業の詳細は次項に記載しています。</div>
<div class="line">ITA基本コンソールの利用方法は、 <a class="reference internal" href="../it_automation_base/basic_console.html"><span class="doc">基本コンソール</span></a> を参照してください。</div>
</div>
<section id="ansible-legacy">
<h4>Ansible-Legacy作業フロー<a class="headerlink" href="#ansible-legacy" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">以下は、Ansible-Legacyで作業を実行するまでの流れです。</div>
</div>
<ul>
<li><p><strong>作業フロー詳細と参照先</strong></p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>機器情報にAnsible利用情報を設定</strong></div>
<div class="line">ITA基本コンソールの機器一覧の画面から、各機器に対してAnsible利用情報を設定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-device-list"><span class="std std-ref">機器一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>投入オペレーション名の登録</strong></div>
<div class="line">ITA基本コンソールのオペレーション一覧の画面から、作業用の投入オペレーション名を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-input-operation-list"><span class="std std-ref">オペレーション一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>インターフェース情報の登録</strong></div>
<div class="line">Ansible共通コンソールのインターフェース情報の画面から、Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンにするかを選択し、実行エンジンのサーバへの接続情報の登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-interface-information"><span class="std std-ref">インターフェース情報</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業パターン(Movement)の登録</strong></div>
<div class="line">Ansible-LegacyコンソールのMovement一覧の画面から、作業用のMovementを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-movement-list"><span class="std std-ref">Movement一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Playbookの登録</strong></div>
<div class="line">Ansible-LegacyコンソールのPlaybook素材集の画面から、作業で使用するPlaybookを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-playbook-file-list-ansible-legacy-only"><span class="std std-ref">Playbook素材集（Ansible-Legacyのみ）</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>テンプレートファイルの登録（必要に応じて実施）</strong></div>
<div class="line">Ansible共通コンソールのテンプレート管理の画面から、Playbook内のtemplateモジュールなどで使用しているtemplateファイル(src)とtemplate埋め込み変数の登録／更新／廃止を行います。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-template-list"><span class="std std-ref">テンプレート管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>素材ファイルの登録 （必要に応じて実施）</strong></div>
<div class="line">Ansible共通コンソールのファイル管理の画面から、作業対象サーバに配置するファイルを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-file-list"><span class="std std-ref">ファイル管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Movementにプレイブック素材を指定</strong></div>
<div class="line">Ansible-LegacyコンソールのMovement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）の画面から、登録したMovementにプレイブック素材を指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業対象ホストの指定</strong></div>
<div class="line">Ansible-Legacyコンソールの作業対象ホストの画面から、作業対象ホストを指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-target-host"><span class="std std-ref">作業対象ホスト</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>変数値の設定（必要に応じて実施）</strong></div>
<div class="line">Ansible-Legacyコンソールの代入値管理の画面から、Movementに登録したPlaybook内で定義した変数の値を設定します。変数を利用していない場合、設定は不要です。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業実行</strong></div>
<div class="line">Ansible-Legacyコンソールの作業実行の画面から、実行日時、投入オペレーションを選択して設定して処理の実行を指示します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-execution"><span class="std std-ref">作業実行</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業状態確認</strong></div>
<div class="line">Ansible-Legacyコンソールの作業状態確認の画面では、実行した作業の状態がリアルタイムで表示されます。また、作業の緊急停止や、実行ログ、エラーログを監視することができます。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業履歴確認</strong></div>
<div class="line">Ansible-Legacyコンソールの作業管理の画面では、実行した作業の一覧が表示され履歴が確認できます。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-execution-list"><span class="std std-ref">作業管理</span></a> を参照してください。</div>
</div>
</li>
</ol>
</li>
</ul>
</section>
<section id="ansible-legacy-role">
<h4>Ansible-Legacy Role作業フロー<a class="headerlink" href="#ansible-legacy-role" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">以下は、Ansible-Legacy Roleで作業を実行するまでの流れです。</div>
</div>
<ul>
<li><p><strong>作業フロー詳細と参照先</strong></p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>機器情報にAnsible利用情報を設定</strong></div>
<div class="line">ITA基本コンソールの機器一覧の画面から、各機器に対してAnsible利用情報を設定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-device-list"><span class="std std-ref">機器一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>投入オペレーション名の登録</strong></div>
<div class="line">ITA基本コンソールのオペレーション一覧の画面から、作業用の投入オペレーション名を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-input-operation-list"><span class="std std-ref">オペレーション一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>インターフェース情報の登録</strong></div>
<div class="line">Ansible共通コンソールのインターフェース情報の画面から、Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンにするかを選択し、実行エンジンのサーバへの接続情報を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-interface-information"><span class="std std-ref">インターフェース情報</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業パターン(Movement)の登録</strong></div>
<div class="line">Ansible-LegacyRoleコンソールのMovement一覧の画面から、作業用のMovementを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-movement-list"><span class="std std-ref">Movement一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>ロールパッケージの登録</strong></div>
<div class="line">Ansible-LegacyRoleコンソールのロールパッケージ管理の画面から、作業で使用するロールパッケージを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理（Ansible-Legacy Roleのみ）</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>テンプレートファイルの登録（必要に応じて実施）</strong></div>
<div class="line">Ansible共通コンソールのテンプレート管理の画面から、ロールパッケージのtemplateモジュールなどで使用しているtemplateファイル(src)とtemplate埋め込み変数の登録／更新／廃止を行います。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-template-list"><span class="std std-ref">テンプレート管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>素材ファイルの登録 （必要に応じて実施）</strong></div>
<div class="line">Ansible共通コンソールのファイル管理の画面から、作業対象サーバに配置するファイルを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-file-list"><span class="std std-ref">ファイル管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Movementにロールパッケージを指定</strong></div>
<div class="line">Ansible-LegacyRoleコンソールのMovement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）の画面から、登録したMovementにプレイブック素材を指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>多段変数の最大繰返数を指定</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの多段変数最大繰返管理の画面から、多段変数で配列定義されているメンバー変数の配列の最大繰返数を指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-nested-variable-list-ansible-legacy-role-only"><span class="std std-ref">変数ネスト管理（Ansible-Legacy Roleのみ）</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業対象ホストの指定</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの作業対象ホストの画面から、作業対象ホストを指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-target-host"><span class="std std-ref">作業対象ホスト</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>変数値の設定</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの代入値管理の画面から、Movementに登録したPlaybook内で定義した変数の値を設定します。変数を利用していない場合、設定は不要です。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業実行</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの作業実行の画面から、実行日時、投入オペレーションを選択して設定して処理の実行を指示します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-execution"><span class="std std-ref">作業実行</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業状態確認</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの作業状態確認の画面から、実行した作業の状態がリアルタイムで表示されます。また、作業の緊急停止や、実行ログ、エラーログを監視することができます。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業履歴確認</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの作業管理の画面から、実行した作業の一覧が表示され履歴が確認できます。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-execution-list"><span class="std std-ref">作業管理</span></a> を参照してください。</div>
</div>
</li>
</ol>
</li>
</ul>
</section>
<section id="ansible-pioneer">
<h4>Ansible-Pioneer作業フロー<a class="headerlink" href="#ansible-pioneer" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">以下は、Ansible-Pioneerで作業を実行するまでの流れです。</div>
</div>
<ul>
<li><p><strong>作業フロー詳細と参照先</strong></p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>OS種別の登録</strong></div>
<div class="line">Pioneerより操作対象となる機器のOS種別を設定します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>機器情報にAnsible利用情報を設定</strong></div>
<div class="line">ITA基本コンソールの機器一覧の画面から、各機器に対してAnsible利用情報を設定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-device-list"><span class="std std-ref">機器一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>投入オペレーション名の登録</strong></div>
<div class="line">ITA基本コンソールのオペレーション一覧の画面から、作業用の投入オペレーション名を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-input-operation-list"><span class="std std-ref">オペレーション一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>インターフェース情報の登録</strong></div>
<div class="line">Ansible共通コンソールのインターフェース情報の画面から、Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンにするかを選択し、実行エンジンのサーバへの接続情報の登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-interface-information"><span class="std std-ref">インターフェース情報</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業パターン(Movement)の登録</strong></div>
<div class="line">Ansible-PioneerコンソールのMovement一覧の画面から、作業用のMovementを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-movement-list"><span class="std std-ref">Movement一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>対話種別の登録</strong></div>
<div class="line">Ansible-Pioneerコンソールの対話種別リストの画面から、対話種別を登録します。</div>
<div class="line">OS種別ごとの差異を対話ファイルごとに定義し、同一目的の対話ファイルを対話種別として纏めて機器差分を吸収(抽象化)します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-dialog-type-list-ansible-pioneer-only"><span class="std std-ref">対話種別リスト（Ansible-Pioneerのみ）</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>対話ファイルの登録</strong></div>
<div class="line">Ansible-Pioneerコンソールの対話ファイル素材集の画面から、対話種別とOS種別の組み合わせに対して対話ファイルを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-dialog-files-ansible-pioneer-only"><span class="std std-ref">対話ファイル素材集（Ansible-Pioneerのみ）</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>テンプレートファイルの登録(必要に応じて実施)</strong></div>
<div class="line">Ansible共通コンソールのテンプレート管理の画面から、対話ファイルで使用しているtemplateファイルとtemplate埋め込み変数の登録／更新／廃止を行います。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-template-list"><span class="std std-ref">テンプレート管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>素材ファイルの登録(必要に応じて実施)</strong></div>
<div class="line">Ansible共通コンソールのファイル管理の画面から、作業対象サーバに配置するファイルを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-file-list"><span class="std std-ref">ファイル管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Movementに対話ファイルを指定</strong></div>
<div class="line">Ansible-PioneerコンソールのMovement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）の画面から、登録したMovementに対話ファイルに対応した対話種別リストを指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業対象ホストの指定</strong></div>
<div class="line">Ansible-Pioneerコンソールの作業対象ホストの画面から、作業対象ホストを指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-target-host"><span class="std std-ref">作業対象ホスト</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>変数値の設定</strong></div>
<div class="line">Ansible-Pioneerコンソールの代入値管理の画面から、Movementに登録したPlaybook内で定義した変数の値を設定します。変数を利用していない場合、設定は不要です。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業実行</strong></div>
<div class="line">Ansible-Pioneerコンソールの作業実行の画面から、実行日時、投入オペレーションを選択して設定して処理の実行を指示します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-execution"><span class="std std-ref">作業実行</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業状態確認</strong></div>
<div class="line">Ansible-Pioneerコンソールの作業状態確認の画面では、実行した作業の状態がリアルタイムで表示されます。また、作業の緊急停止や、実行ログ、エラーログを監視することができます。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業履歴確認</strong></div>
<div class="line">Ansible-Pioneerコンソールの作業管理の画面では、実行した作業の一覧が表示され履歴が確認できます。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-execution-list"><span class="std std-ref">作業管理</span></a> を参照してください。</div>
</div>
</li>
</ol>
</li>
</ul>
<div class="line-block">
<div class="line"><strong>■登録画面項目一覧凡例</strong></div>
<div class="line">次項に記載の登録画面項目一覧表の内容について説明します。</div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目…①</strong></p></th>
<th class="head"><p><strong>説明…②</strong></p></th>
<th class="head"><p><strong>入力必須…③</strong></p></th>
<th class="head"><p><strong>入力形式…④</strong></p></th>
<th class="head"><p><strong>制約事項…⑤</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>項目</strong></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">サブメニュー内の項目名です。</div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><strong>説明</strong></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">項目に対する説明です。</div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><strong>入力必須</strong></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">○：項目に対する内容の入力が必須の項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">‐ ：項目に対する内容の入力が任意の項目です。</div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><strong>入力形式</strong></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">手動入力：手動での入力が必要な項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">自動入力：自動で内容が入力される項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">チェックボックス：チェックボックス形式の項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">ボタン：ラジオボタン形式の項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">リスト選択：リストボックス形式の項目です。</div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><strong>制約事項</strong></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">項目に対する制約事項(文字数制限など)です。</div>
</div>
</li>
</ul>
</li>
</ol>
</section>
</section>
</section>
<section id="id12">
<h2><span class="section-number">8.6. </span>Ansible driver機能・操作方法説明<a class="headerlink" href="#id12" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章では、Ansible driverで利用する各コンソールの機能について説明します。</div>
</div>
<section id="id13">
<h3>基本コンソール<a class="headerlink" href="#id13" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">本節では、ITA基本コンソールでの操作について記載します。</div>
<div class="line">本作業はITA基本コンソールマニュアルを参照して、ITA基本コンソール画面内で作業を実施してください。</div>
</div>
<section id="general-operations-device-list">
<span id="id14"></span><h4>機器一覧<a class="headerlink" href="#general-operations-device-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[機器一覧]では、作業対象ホストの情報を登録／更新／廃止を行います。</div>
<div class="line">本書では、主にAnsible driverの動作に必要となる項目について説明します。</div>
<div class="line"><a class="reference internal" href="../it_automation_base/basic_console.html"><span class="doc">基本コンソール</span></a> と合わせて参照してください。</div>
</div>
<figure class="align-default" id="id81">
<a class="reference internal image-reference" href="../../../_images/image51.png"><img alt="サブメニュー画面（機器一覧）" src="../../../_images/image51.png" style="width: 6.14173in; height: 2.86822in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（機器一覧）</span><a class="headerlink" href="#id81" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、機器情報の登録を行います。</div>
</div>
<figure class="align-default" id="id82">
<a class="reference internal image-reference" href="../../../_images/image_2a_7.png"><img alt="登録画面（機器一覧 - 共通項目）" src="../../../_images/image_2a_7.png" style="width: 3.8781in; height: 1.61202in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（機器一覧 - 共通項目）</span><a class="headerlink" href="#id82" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id83">
<a class="reference internal image-reference" href="../../../_images/image7.png"><img alt="登録画面（機器一覧 - Ansible利用情報）" src="../../../_images/image7.png" style="width: 5.97917in; height: 1.10417in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（機器一覧 - Ansible利用情報）</span><a class="headerlink" href="#id83" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の共通項目一覧は以下のとおりです。</div>
<div class="line">Web画面のカラム名の後ろに赤のアスタリスク（＊）が付いているカラムが必須入力になりますが、Ansible　driverを利用する場合には、Ansible利用情報を入力して下さい。</div>
<div class="line">未入力で作業実行した場合、想定外エラーとなる場合があります。</div>
</div>
<table class="docutils align-left" id="id84">
<caption><span class="caption-text">登録画面項目一覧（機器一覧）</span><a class="headerlink" href="#id84" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 9.3%" />
<col style="width: 9.3%" />
<col style="width: 9.3%" />
<col style="width: 9.3%" />
<col style="width: 20.9%" />
<col style="width: 14.0%" />
<col style="width: 14.0%" />
<col style="width: 14.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="4"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力
必須</strong></p></th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="4"><p>管理システム項番</p></td>
<td><p>登録情報を識別する一意のＩＤが自動入力されます。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>自動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="4"><p>ホスト名</p></td>
<td><p>ホスト名を記入します。</p>
<p>※ホスト名をlocalhostに設定しpioneerで作業対象ホストとし使用する場合、作業実行でエラーになる場合があります。その場合、インベントリファイル追加オプションに下記パラメータでansibleサーバーにインストールされているpython3のパスを追記して下さい。</p>
<p>Exp)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_python_interpreter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/python3</span>
</pre></div>
</div>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>IPアドレス</p></td>
<td><p>IPアドレス(xxx.xxx.xxx.xxx形式)を記入します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長15バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2" rowspan="2"><p>EtherWakeOnLan</p></td>
<td colspan="2"><p>MACアドレス</p></td>
<td><p>MACアドレスを記入します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長17バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>ネットワークデバイス名</p></td>
<td><p>ネットワークデバイス名を記入します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p>ログインユーザID</p></td>
<td><p>ログインユーザIDを記入します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長30バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2" rowspan="2"><p>ログインパスワード</p></td>
<td colspan="2"><p>管理</p></td>
<td><p>ITAでパスワードを管理する場合「●」を選択します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>ログインパスワード</p></td>
<td><p>パスワードを指定します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2" rowspan="2"><p>ssh鍵認証情報</p></td>
<td colspan="2"><p>ssh秘密鍵ファイル</p></td>
<td><p>ssh秘密鍵ファイルを指定して鍵認証する場合の秘密鍵ファイルを入力します。アップロードしたファイルは暗号化されて保存されます。※登録後はダウンロード不可となります。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>パスフレーズ</p></td>
<td><p>ssh秘密鍵ファイルにパスフレーズが設定されている場合、パスフレーズを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-even"><td rowspan="10"><p>Ansible利用情報</p></td>
<td rowspan="3"><p>Legacy/Role利用情報</p></td>
<td colspan="2"><p>認証方式</p></td>
<td><p>Ansible・Ansible Automation Controller から機器へ接続する際の認証方式を選択します。</p>
<p>●パスワード認証</p>
<p>ログインパスワードの管理で●の選択と、ログインパスワードの入力が必須です。</p>
<p>●鍵認証（パスフレーズなし）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードが必須です。</p>
<p>●鍵認証（パスフレーズあり）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードと、パスフレーズの入力が必須です。</p>
<p>●鍵認証（鍵交換済み）※1</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードは必要ありません。</p>
<p>●パスワード認証（winrm)</p>
<p>必要に応じてWinRM接続情報を入力します。</p>
<p>尚、パスワード認証（winrm)以外の認証方式の場合、機器側に以下の設定が必要です。</p>
<p>ログインユーザの sudo 権限を NOPASSWD付で /etc/sudoers に設定します。</p>
<p>Exp)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Demo_user</span> <span class="n">ALL</span><span class="o">=</span><span class="p">(</span><span class="n">ALL</span><span class="p">)</span> <span class="n">NOPASSWD</span><span class="p">:</span><span class="n">ALL</span>
</pre></div>
</div>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>WinRM接続情報</p></td>
<td><p>ポート番号</p></td>
<td><p>WindowsServerにWinRM接続する際のポート番号を入力します。</p>
<p>未入力の場合はデフォルト(5985)でのWinRM接続となります。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-even"><td><p>サーバ証明書</p></td>
<td><p>WinRM接続ポートでhttpsのポート番号を指定した場合にサーバﾞ証明書を入力します。
アップロードしたファイルは暗号化されて保存されます。※登録後はダウンロード不可となります。</p>
<p>サーバ証明書の認証を省く場合、インベントリファイル追加オプションに下記を追記して下さい。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_winrm_server_cert_validation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ignore</span>
</pre></div>
</div>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>Pioneer利用情報</p></td>
<td colspan="2"><p>プロトコル</p></td>
<td><p>Pioneerから対象機器にログインする際のプロトコル(ssh/telnet)を選択します。</p>
<p>●sshを選択した場合</p>
<p>認証方式はパスワード認証（winrm)以外を選択してください。</p>
<p>●telnetを選択した場合</p>
<p>認証方式に設定した値は使用せずにtelnetで接続します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>OS種別</p></td>
<td><p>対象機器のOSを選択します。</p>
<p>OS種別マスタで登録されているOS種別がリスト表示されます。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>LANG</p></td>
<td><p>Pioneerの対話ファイルを実行するユーザーのLANGを選択します。</p>
<p>空白の場合はutf-8扱いとなります。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="3"><p>接続オプション</p></td>
<td><p>（ssh接続の場合）</p>
<p>/etc/ansible.cfg/ssh_argsに設定しているsshオプション以外のオプションを設定したい場合、設定したいオプションを入力します。</p>
<p>（telnet接続の場合）</p>
<p>telnet接続時のオプションを設定したい場合、設定したいオプションを入力します。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>インベントリファイル追加オプション「Pioneer利用時は、本項目は適用されません。」</p></td>
<td><p>ITAが設定していないインベントリファイルのオプションパラメータをyaml形式で入力します。</p>
<p>Exp)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network_cli</span>
<span class="nt">ansible_network_os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ios</span>
<span class="nt">ansible_become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="nt">ansible_become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</pre></div>
</div>
<p>各パラメータ値を変数で記述することも出来ます。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_become_password</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_passwd</span><span class="nv"> </span><span class="s">}}&#39;</span>
</pre></div>
</div>
<p>具体値に変数を記述する場合</p>
<p>'{{△VAR_passwd△}}'</p>
<p>△:半角スペース</p>
<p>':シングル・ダブルコーテーションで囲む「必須」</p>
<p>変数の具体値は「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」や「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」メニューから登録します。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Ansible</p>
<p>Automation</p>
<p>Controller</p>
<p>利用情報</p>
</td>
<td colspan="2"><p>インスタンスグループ名※2</p></td>
<td><p>Ansible Automation Controller がクラスタ構成の場合、どのインスタンスグループで実行するかを選択します。ここで設定した、インスタンスグループはインベントリオブジェクトに設定されます。</p>
<p>未選択の場合はAnsible Automation Controller のデフォルトのインスタンスグループになります。</p>
<p>Ansible Automation Controller がクラスタ構成でない場合は、未選択で構いません。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>接続タイプ</p></td>
<td><p>Ansible Automation Controller認証情報の接続タイプを設定します。通常はmachineを選択します。ansible_cnnectionをlocalに設定する必要があるNetwork OSの場合にNetworkを選択します。</p>
<p>Networkを選択した場合、インベントリファイル追加オプションにPlatform Options(ansible_cnnection以外)を設定する必要があります。</p>
<p>Exp)</p>
<p>インベントリファイル追加オプションの設定例</p>
<p>Network OSがiosの場合の設定値</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_network_os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ios</span>
<span class="nt">ansible_become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="nt">ansible_become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</pre></div>
</div>
<p>Ansible Automation Controllerの認証情報の接続タイプについては、ドキュメント <a class="reference external" href="https://docs.ansible.com/ansible-tower/3.6.4/html_ja/userguide/credentials.html">認証情報
タイプ</a> を参照して下さい。</p>
<p>Network OSとansible_connectionの関連やPlatform Optionsについては、Ansibleドキュメント <a class="reference external" href="https://docs.ansible.com/ansible/devel/network/user_guide/platform_index.html">Platform
Options</a> を参照ください。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-even"><td colspan="4"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※1 認証方式が鍵認証（鍵交換済み）に設定する為に必要な公開鍵ファイルの配布</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible Coreの場合</div>
<div class="line">ansibleがインストールされているサーバーの実行ユーザー「Ansible共通コンソール=&gt;インターフェース情報に設定されている実行ユーザー」から作業対象ホストにssh接続します。</div>
<div class="line">実行ユーザーの公開鍵ファイルをログイン先ユーザーのauthorized_keysにコピーして下さい。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Ansible Automation Controllerの場合</div>
<div class="line">Ansible Automation Controllerのawxユーザーから作業対象ホストにssh接続しています。</div>
<div class="line">awxユーザーの公開鍵ファイルをログイン先ユーザーのauthorized_keysにコピーして下さい。ブラウザよりAnsible Automation Controllerにログインし、「設定」→「ジョブ」→「分離されたジョブに公開するパス」に「/var/lib/awx/.ssh/」を設定します。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image8.png"><img alt="../../../_images/image8.png" class="align-center" src="../../../_images/image8.png" style="width: 4.97986in; height: 1.51304in;" /></a>
<div class="line-block">
<div class="line">尚、AnsibleTower4.x以降、awxユーザーの.sshディレクトリが扱えない為、作業対象ホストと鍵認証（鍵交換済み）での接続は出来ません。</div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※2 Ansible driverのバックヤード機能 「Ansible Automation Controllerデータ同期」により取得したデータから選択します。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-input-operation-list">
<span id="id15"></span><h4>オペレーション一覧<a class="headerlink" href="#general-operations-input-operation-list" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">[オペレーション一覧]画面では、オーケストレータで実行する作業対象ホストに対するオペレーションを管理します。作業はITA基本コンソール内メニューより選択します。</div>
</div>
<figure class="align-default" id="id85">
<a class="reference internal image-reference" href="../../../_images/image9.png"><img alt="サブメニュー画面（オペレーション一覧）" src="../../../_images/image9.png" style="width: 6.69236in; height: 3.14167in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（オペレーション一覧）</span><a class="headerlink" href="#id85" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line">登録方法の詳細は、関連マニュアルの <a class="reference internal" href="../it_automation_base/basic_console.html"><span class="doc">基本コンソール</span></a> をご参照下さい。</div>
</div>
</section>
</section>
<section id="ansible">
<h3>Ansible 共通コンソール<a class="headerlink" href="#ansible" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">本節では、Ansible共通コンソールでの操作について記載します。</div>
</div>
<section id="general-operations-interface-information">
<span id="id16"></span><h4>インターフェース情報<a class="headerlink" href="#general-operations-interface-information" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[インターフェース情報]では、Ansible Core、AnsibleTower、Ansible Automation Controllerのいずれかを実行エンジンに選択し、ITAシステム・Ansible driverサーバと実行エンジンのサーバが共有するディレクトリのパスのおよび実行エンジンのサーバへの接続インターフェース情報を登録／更新／廃止を行います。</div>
</div>
<figure class="align-default" id="id86">
<a class="reference internal image-reference" href="../../../_images/image10.png"><img alt="サブメニュー画面（インタフェース情報）" src="../../../_images/image10.png" style="width: 6.11321in; height: 3.20764in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（インタフェース情報）</span><a class="headerlink" href="#id86" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「一覧」-「更新」ボタンより、インターフェース情報の登録を行います。</div>
</div>
<figure class="align-default" id="id87">
<a class="reference internal image-reference" href="../../../_images/image11.png"><img alt="登録画面（インタフェース情報）" src="../../../_images/image11.png" style="width: 6.11319in; height: 0.69811in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（インタフェース情報）</span><a class="headerlink" href="#id87" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">インタフェース情報画面の項目一覧は以下のとおりです。</div>
<div class="line">インタフェース情報が未登録または、複数レコード登録されている状態で作業実行した場合、作業実行は想定外エラーとなります。</div>
</div>
<table class="docutils align-left" id="id88">
<caption><span class="caption-text">登録画面項目一覧（インタフェース情報）</span><a class="headerlink" href="#id88" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 10.8%" />
<col style="width: 10.8%" />
<col style="width: 10.8%" />
<col style="width: 32.4%" />
<col style="width: 10.8%" />
<col style="width: 10.8%" />
<col style="width: 13.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力
必須</strong></p></th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>実行エンジン</p></td>
<td><p>実行するエンジンを下記の3種類から選択します。</p>
<p>・Ansible Core</p>
<p>・Ansible Tower</p>
<p>・Ansible Automation Controller</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-odd"><td rowspan="6"><p>Ansible Core</p>
<p>インターフェース</p>
</td>
<td colspan="2"><p>ホスト</p></td>
<td><p>Ansibleサーバのホスト名（またはIPアドレス）を入力します。</p>
<p>HTTPS通信の場合はホスト名が推奨です。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p>
<p>実行エンジンがAnsible Core以外でもansible-vaultコマンドを実行するAnsible Coreインターフェースの設定が必要です。</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>プロトコル</p></td>
<td><p>Ansibleサーバとのプロトコルを </p>
<p>http / https のどちらかを入力します。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
<p>実行エンジンがAnsible Core以外でもansible-vaultコマンドを実行するAnsible Coreインターフェースの設定が必要です。</p>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>ポート</p></td>
<td><p>Ansibleサーバの接続ポート(80/443)を入力します。通常はHTTPS(443)です。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
<p>実行エンジンがAnsible Core以外でもansible-vaultコマンドを実行するAnsible Coreインターフェースの設定が必要です。</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>実行ユーザー</p></td>
<td><p>sudoコマンドでansible-playbook/ansible-vaultコマンドを実行するとユーザーを入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長64バイト</p>
<p>実行エンジンがAnsible Core以外でもansible-vaultコマンドを実行するAnsible Coreインターフェースの設定が必要です。</p>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>ACCESS_KEY_ID</p></td>
<td><p>Ansibleサーバと接続時の認証に使用するアクセスキーを入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長64バイト</p>
<p>実行エンジンがAnsible Core以外でもansible-vaultコマンドを実行するAnsible Coreインターフェースの設定が必要です。</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>SECRET_ACCESS_KEY</p></td>
<td><p>Ansibleサーバと接続時の認証に使用するシークレットアクセスキーを入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長64バイト</p>
<p>実行エンジンがAnsible Core以外でもansible-vaultコマンドを実行するAnsible Coreインターフェースの設定が必要です。</p>
</td>
</tr>
<tr class="row-odd"><td rowspan="6"><p>Ansible</p>
<p>Automation</p>
<p>Controller</p>
<p>インターフェース</p>
</td>
<td colspan="2"><p>代表ホスト</p></td>
<td><p>Ansible Automation Controllerホスト一覧に登録されているホストの一覧より、ITAと通信するAnsible Automation Controllerを選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>プロトコル</p></td>
<td><p>Ansible Automation Controllerサーバとのプロトコルを http / https のどちらかを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>ポート</p></td>
<td><p>Ansible Automation Controllerサーバの接続ポート(80/443)を入力します。通常はHTTPS(443)です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>組織名</p></td>
<td><p>Ansible Automation Controllerサーバに登録されている組織名を選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>認証トークン</p></td>
<td><p>ITAからAnsible Automation Controllerサーバに接続するユーザーの認証トークンを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p>
<p>実行エンジンがAnsible Core以外の場合に入力必須</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>実行時データ削除</p></td>
<td><p>作業実行時にITAとAnsible Automation Controller 内に一時的に生成したデータリソースを作業終了後に削除するかを選択します。
「削除する」を選択した場合に削除されるデータリソースは「 <a class="reference internal" href="#general-operations-data-resources-deleted-when-executing"><span class="std std-ref">実行時データ削除で削除されるデータリソース</span></a> 」を参照して下さい。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>Proxy</p></td>
<td colspan="2"><p>Adress</p></td>
<td><p>プロキシサーバのアドレスを入力します。</p>
<p>ITAがプロキシ環境下にある場合、Ansible/Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</p>
<p>プロキシサーバのURLが</p>
<p>http://procy.gate.co.jp:8080の場合</p>
<p>Addressにはhttp://procy.gate.co.jpを入力します。</p>
<p>Portには 8080を入力します。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大128バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>Port</p></td>
<td><p>プロキシサーバのポートを入力します。</p>
<p>ITAがプロキシ環境下にある場合、Ansible/Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td></td>
</tr>
<tr class="row-odd"><td rowspan="4"><p>SCM管理</p>
<p>Git連携先情報</p>
</td>
<td colspan="2"><p>ホスト名</p></td>
<td><p>Ansible Automation Controllerから連携先のGitリポジトリへsshプロトコルで接続する為のホスト名（またはIPアドレス）を入力します。</p>
<p>Ansible driverのバックヤード機能がインストールされているホストにAnsible Automation Controllerと連携するGitリポジトリが作成されます。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p>
<p>実行エンジンがAnsible Automation Controllerの場合に必須入力です。</p>
</td>
</tr>
<tr class="row-even"><td rowspan="3"><p>Linuxアカウント</p></td>
<td><p>ユーザー</p></td>
<td><p>Ansible Automation Controllerから連携先のGitリポジトリへsshプロトコルで接続する為のユーザーを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p>
<p>実行エンジンがAnsible Automation Controllerの場合に必須入力です。</p>
</td>
</tr>
<tr class="row-odd"><td><p>ssh秘密鍵ファイル</p></td>
<td><p>Ansible Automation Controllerから連携先のGitリポジトリへsshプロトコルの鍵認証で接続する為の秘密鍵ファイルを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ファイル</p></td>
<td><p>ファイル選択</p>
<p>最大サイズ4Gバイト</p>
<p>実行エンジンがAnsible Automation Controllerの場合に必須入力です。</p>
</td>
</tr>
<tr class="row-even"><td><p>パスフレーズ</p></td>
<td><p>ssh秘密鍵ファイルに設定されているパスフレーズを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>データリレイストレージパス(ITA)※</p></td>
<td><p>ITAシステム・Ansible driverサーバから見たディレクトリを入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>データリレイストレージパス(Ansible)</p></td>
<td><p>Ansibleサーバーから見たディレクトリを入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p>
<p>実行エンジンがAnsible Core以外では使用しない情報です。</p>
</td>
</tr>
<tr class="row-odd"><td colspan="3"><p>Symphonyインスタンスデータリレイストレージパス(Ansible)</p></td>
<td><p>Symphony実行時、各Movementで共有するディレクトリです。Ansibleサーバーから見たディレクトリを入力します。</p>
<p>ITAシステムから見たパスはSymphonyインターフェース情報より設定します。Symphonyインターフェース情報については「利用手順マニュアル Symphony」を参照して下さい。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p>
<p>実行エンジンがAnsible Core以外では使用ない情報です。</p>
</td>
</tr>
<tr class="row-even"><td colspan="3"><p>Conductorインスタンスデータリレイストレージパス(Ansible)</p></td>
<td><p>Conductor実行時、各Movementで共有するディレクトリです。Ansibleサーバーから見たディレクトリを入力します。</p>
<p>ITAシステムから見たパスはConductorインターフェース情報より設定します。Conductorインターフェース情報については<a class="reference internal" href="../it_automation_base/conductor.html"><span class="doc">Conductor</span></a> を参照して下さい。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p>
<p>実行エンジンがAnsible Core以外では使用ない情報です。</p>
</td>
</tr>
<tr class="row-odd"><td colspan="3"><p>オプションパラメータ</p></td>
<td><p>Movement共通のオプションパラメータを入力します。</p>
<p>実行エンジンがAnsible Coreの場合はansible-playbookコマンドのオプションパラメータ、実行エンジンがAnsible Core以外の場合はジョブテンプレートのパラメータを入力します。</p>
<p>Movement固有のオプションパラメータはMovement一覧で入力します。</p>
<p>オプションパラメータの詳細については、「 <a class="reference internal" href="#general-operations-option-parameter-list"><span class="std std-ref">オプションパラメータ一覧</span></a> 」を参照してください。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>並列実行数</p></td>
<td><p>同時に実行できるMovement(Legacy/Pioneer/Legacy-Role)の最大数を入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>状態監視周期（単位ミリ秒）</p></td>
<td><p>「<a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a>」で表示されるログのリフレッシュ間隔を入力します。通常は3000ミリ秒程度が推奨値です。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最小値1000ミリ秒</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>進行状態表示行数</p></td>
<td><p>「<a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a>」での進行ログ・エラーログの最大表示行数を入力します。</p>
<p>ステータスが[未実行]、[準備中]、[実行中]、[実行中(遅延)]の場合、指定した行数でログを出力します。</p>
<p>ステータスが[完了]、[完了(異常)]、[想定外エラー]、[緊急停止]、[未実行(予約)]、[予約取消]の場合、指定した行数ではなくすべてのログを出力します。</p>
<p>環境毎にチューニングを要しますが、通常は1000行程度が推奨値です。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="3"><p>NULL連携</p></td>
<td><p>代入値自動登録設定でパラメータシートの具体値がNULL(空白)の場合に、代入値管理への登録をNULL(空白)の値で行うか設定します。</p>
<p>代入値自動登録設定メニューの「NULL連携」が空白の場合この値が適用されます。</p>
<p>・「有効」の場合、パラメータシートの値がどのような値でも代入値管理への登録が行われます。</p>
<p>・「無効」の場合、パラメータシートに値が入っている場合のみ代入値管理への登録が行われます。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="3"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※ データリレイストレージパスは、ITAとAnsibleが別サーバで運用する構成もサポートするので、ディレクトリパスを別々に管理します。詳細は <a class="reference internal" href="architecture.html"><span class="doc">目次</span></a> を参照してください。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="id17">
<h4>Ansible Automation Controllerホスト一覧<a class="headerlink" href="#id17" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">[Ansible Automation Controllerホスト一覧]では、Ansible Automation ControllerのRestAPI実行に必要な情報、および構築資材をAnsible Automation Controllerにファイル転送するために必要な情報を登録／更新／廃止を行います。</div>
<div class="line">クラスタ構成の場合は、構成している全てのサーバを登録して下さい。</div>
<div class="line">ただし、Ansible Automation Controllerのhop nodeの登録は不要です。</div>
</div>
<figure class="align-default" id="id89">
<a class="reference internal image-reference" href="../../../_images/image12.png"><img alt="サブメニュー画面（Ansible Automation Controller ホスト一覧）" src="../../../_images/image12.png" style="width: 6.26944in; height: 3.04348in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Ansible Automation Controller ホスト一覧）</span><a class="headerlink" href="#id89" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line">「一覧」-「更新」ボタンより、Ansible Automation Controllerのホスト情報の登録を行います。</div>
</div>
<figure class="align-default" id="id90">
<a class="reference internal image-reference" href="../../../_images/image13.png"><img alt="登録画面（Ansible Automation Controller ホスト一覧）" src="../../../_images/image13.png" style="width: 6.46875in; height: 0.83333in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Ansible Automation Controller ホスト一覧）</span><a class="headerlink" href="#id90" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">Ansible Automation Controllerホスト一覧画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id91">
<caption><span class="caption-text">登録画面項目一覧（Ansible Automation Controller ホスト一覧）</span><a class="headerlink" href="#id91" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>ホスト</p></td>
<td><p>Ansible Automation Controllerサーバのホスト名（またはIPアドレス）を入力します。</p>
<p>HTTPS通信の場合はホスト名が推奨です。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>認証方式</p></td>
<td><p>Ansible Automation Controllerサーバへファイル転送(scp)で接続する
際の認証方式を選択します。</p>
<p>●パスワード認証</p>
<p>ログインユーザとパスワードの入力が必須です。</p>
<p>●鍵認証（パスフレーズなし）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードが必須です。</p>
<p>●鍵認証（パスフレーズあり）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードと、パスフレーズの入力が必須です。</p>
<p>●鍵認証（鍵交換済み）※</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードは必要ありません。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長30バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>ログインユーザ</p></td>
<td><p>Ansible Automation Controllerサーバへファイル転送(scp)で接続する際のログインユーザを入力します。</p>
<p>ログインユーザは、Ansible Automation Controllerインストール時に生成されるawxユーザーにパスワードを設定し、使用することを強く推奨します。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長30バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>パスワード</p></td>
<td><p>認証方式でパスワード認証を選択した場合に必須入力となります。
ログインユーザのパスワードを指定します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長30バイト</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>ssh鍵認証情報</p></td>
<td><p>ssh秘密鍵ファイル</p></td>
<td><p>ssh秘密鍵ファイルを指定して鍵認証する場合の秘密鍵ファイルを入力します。
アップロードしたファイルは暗号化されて保存されます。※登録後はダウンロード不可となります。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-odd"><td><p>パスフレーズ</p></td>
<td><p>ssh秘密鍵ファイルにパスフレーズが設定されている場合、パスフレーズを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>isolated Tower</p></td>
<td><p>クラスタ構成で構築されている場合で、対象ノードがAnsibleTowerのisolated node/Ansible Automation Controllerのexecution node の場合、「●」を選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>選択方式</p></td>
<td></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※ 認証方式が鍵認証（鍵交換済み）に設定する為に必要な公開鍵ファイルの配布</div>
<div class="line">ITAがインストールされているサーバーのrootからAnsible Automation Controllerのawxユーザーでssh接続します。</div>
<div class="line">rootの公開鍵ファイルをAnsible Automation Controllerのawxユーザーのauthorized_keysにコピーして下さい。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-global-variable-list">
<span id="id18"></span><h4>グローバル変数管理<a class="headerlink" href="#general-operations-global-variable-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[グローバル変数管理]では、Playbookや対話ファイルなどで利用するグローバル変数名を登録／更新／廃止を行います。</div>
</div>
<figure class="align-default" id="id92">
<a class="reference internal image-reference" href="../../../_images/image14.png"><img alt="サブメニュー画面（グローバル変数管理）" src="../../../_images/image14.png" style="width: 5.8005in; height: 2.58022in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（グローバル変数管理）</span><a class="headerlink" href="#id92" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、オペレーション情報の登録を行います。</div>
</div>
<figure class="align-default" id="id93">
<a class="reference internal image-reference" href="../../../_images/image15.png"><img alt="登録画面（グローバル変数管理）" src="../../../_images/image15.png" style="width: 5.78962in; height: 0.74566in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（グローバル変数管理）</span><a class="headerlink" href="#id93" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">グローバル変数管理画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id94">
<caption><span class="caption-text">登録画面項目一覧（グローバル変数管理）</span><a class="headerlink" href="#id94" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>グローバル変数名</p></td>
<td><p>変数名を入力します。</p>
<p>変数名は、「GBL_****」形式で入力します。</p>
<p>****
：半角英数字とアンダースコア（
_
）が利用可能です。(最小値:1バイト、最大値:128バイト)</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>具体値</p></td>
<td><p>具体値を入力します。複数行の具体値も入力できますが、Pioneerの対話ファイルで使用しているグローバル変数で複数行の具体値を設定すると、作業実行時にエラーとなります。</p>
<p>具体値にファイル埋込変数「CPF_」とテンプレート埋込変数「TPF_」が入力出来ます。変数を記述する場合、Playbookに変数を記述する場合と同様、変数名を{{}}で囲みます。</p>
<p>入力例)</p>
<p>具体値にTPF_sampleを入力する場合</p>
<p>'{{△TPF_sample△}}'
△:半角スペース</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長8192バイト</p></td>
</tr>
<tr class="row-even"><td><p>変数名説明</p></td>
<td><p>変数に対する説明・コメントを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="general-operations-template-list">
<span id="id19"></span><h4>テンプレート管理<a class="headerlink" href="#general-operations-template-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[テンプレート管理]では、Playbookで定義しているtemplateモジュールやios_configモジュールなどのパラメータで使用するJinja2テンプレートファイルとテンプレート埋め込み変数の登録／更新／廃止を行います。</div>
<div class="line">テンプレート管理でテンプレートモジュールを登録しておくことで、Playbook内で定義しているtemplateモジュールなどで使用するtemplateファイルをテンプレート埋め込み変数で指定することが出来ます。</div>
</div>
<figure class="align-default" id="id95">
<a class="reference internal image-reference" href="../../../_images/image16.png"><img alt="サブメニュー画面（テンプレート管理）" src="../../../_images/image16.png" style="width: 6.12053in; height: 2.7269in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（テンプレート管理）</span><a class="headerlink" href="#id95" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、ファイル管理情報の登録を行います。</div>
</div>
<figure class="align-default" id="id96">
<a class="reference internal image-reference" href="../../../_images/image17.png"><img alt="登録画面（テンプレート管理）" src="../../../_images/image17.png" style="width: 5.76003in; height: 0.75723in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（テンプレート管理）</span><a class="headerlink" href="#id96" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id97">
<caption><span class="caption-text">登録画面項目一覧（テンプレート管理）</span><a class="headerlink" href="#id97" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>テンプレート埋込変数名</p></td>
<td><p>templateモジュールやios_configモジュールなどのパラメータに埋め込む変数名を入力します。</p>
<p>変数名は、「TPF_****」形式で入力します。</p>
<p>****
：半角英数字とアンダースコア（
_
）が利用可能です。(最小値:1バイト、最大値:128バイト)</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>テンプレート素材</p></td>
<td><p>モジュールのパラメータで使用するJinja2テンプレートファイルをアップロードします。</p></td>
<td><p>○</p></td>
<td><p>ファイル登録</p></td>
<td><p>テキスト形式
最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td><p>変数定義</p></td>
<td><p>テンプレート素材で使用している変数を定義します。</p>
<p>具体値は定義のみで使用することはありません。</p>
<p>Ansible-Roleのみで使用するテンプレートで、default変数定義ファイルなどに変数定義をしている場合、変数定義は省略できます。</p>
<p>同名の変数を複数のテンプレートで使用する場合、変数定義を合わせる必要がありのす。変数定義が一致していない場合は登録でエラーとなります。</p>
<p>変数定義はAnsibleの仕様に準拠していますが、ITA独自仕様があります。表5.2-5-1に変数定義の留意事項を記載します。また、変数名の命名規則は表2.1変数の種類と同様です。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">「登録」の前に、「テンプレート素材」を「事前アップロード（①）」してください。「アップロード状況（②）」にPlaybookのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image_2a_2.png"><img alt="../../../_images/image_2a_2.png" class="align-center" src="../../../_images/image_2a_2.png" style="width: 2.60802in; height: 1.55251in;" /></a>
<table class="docutils align-left" id="id98">
<caption><span class="caption-text">変数定義の留意事項</span><a class="headerlink" href="#id98" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>種類</strong></p></th>
<th class="head"><p><strong>留意事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>通常変数</p></td>
<td><p>具体値は省略可能です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_sample_1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="nt">VAR_sample_2</span><span class="p">:</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>複数具体値変数</p></td>
<td><p>具体値は省略可能です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_sample_1</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="nt">VAR_sample_2</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>多段変数</p></td>
<td><p>階層化された変数構造が定義出来ます。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_sample_1</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">item1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">    </span><span class="nt">item2</span><span class="p">:</span>
<span class="nt">VAR_sample_2</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">array</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">item1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">        </span><span class="nt">item2</span><span class="p">:</span>
</pre></div>
</div>
<p>多段変数を定義したテンプレートはAnsible-Roleでのみ使用することが出来ます。</p>
<p>Ansible-Roleで使用する場合、同名の変数をdefault変数定義ファイルなどに定義している場合は、変数定義を合わせる必要があります。変数定義が一致していない場合は登録でエラーとなります。</p>
</td>
</tr>
<tr class="row-odd"><td><p>グローバル変数</p></td>
<td><p>具体値は省略可能です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">GBL_sample_1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="nt">GBL_sample_2</span><span class="p">:</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>ITA独自変数</p></td>
<td><p>変数の定義は不要です。</p></td>
</tr>
<tr class="row-odd"><td><p>読替変数</p></td>
<td><p>定義出来る変数の種類は以下の3種類です。</p>
<p>・通常変数</p>
<p>・複数具体値変数</p>
<p>・多段変数</p>
<p>各変数定義の留意事項は同様です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">LCA_sample_1</span><span class="p">:</span>
<span class="nt">LCA_sample_2</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">LCA_sample_3</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">item1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">    </span><span class="nt">item2</span><span class="p">:</span>
</pre></div>
</div>
<p>読替変数を定義したテンプレートはAnsible-Roleでのみ使用することが出来ます。</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Playbookの記述</div>
<div class="line">テンプレート管理で登録したテンプレートをPlaybookに記述する場合、該当のパラメータにテンプレート埋込変数名を記述します。テンプレート埋込変数名を使用しない場合、代入値管理で登録した変数や該当ファイルのパスを記述します。</div>
<div class="line">※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。</div>
</div>
<div class="line-block">
<div class="line">Exp) テンプレート管理でhostsファイルを/etc/配下に設置する場合</div>
<div class="line">①テンプレート管理メニューから下記のように対象ファイルを登録します。</div>
<div class="line"><strong>テンプレート管理の登録内容</strong></div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>テンプレート埋込変数名</strong></p></th>
<th class="head"><p><strong>テンプレート素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TPF_hosts</p></td>
<td><p>/etc/hosts</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">②Playbookは下記の記述となります。</div>
<div class="line"><strong>Playbookの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src=&#39;{{ TPF_hosts }}&#39; dest=/etc/hosts</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">destはファイル名も記述してください。ファイル名の指定がない場合、登録したﾃﾝﾌﾟﾚｰﾄ素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。</div>
<div class="line">たとえば、dest=/etc/ とした場合、ファイル名は/etc/10桁の数値_hostsとなります。</div>
</div>
</div>
</li>
<li><div class="line-block">
<div class="line">対話ファイルの記述</div>
<div class="line">対話ファイルに記述する場合、テンプレート埋込変数名を記述します。</div>
</div>
<div class="line-block">
<div class="line">Exp) テンプレート管理でhostsファイルを/etc/配下に設置する場合</div>
<div class="line">①テンプレート管理メニューから下記のように対象ファイルを登録します。</div>
<div class="line"><strong>テンプレート管理の登録内容</strong></div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>テンプレート埋込変数名</strong></p></th>
<th class="head"><p><strong>テンプレート素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TPF_hosts</p></td>
<td><p>/etc/hosts</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">②対話ファイルは下記の記述となります。</div>
<div class="line"><strong>対話ファイルの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;scp</span><span class="nv"> </span><span class="s">ITAユーザ@ITAホスト名:{{</span><span class="nv"> </span><span class="s">TPF_hosts</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">転送先&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ITAユーザのパスワード&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">転送先はファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。</div>
<div class="line">例えば、転送先=/etc/ とした場合、ファイル名は/etc/10桁の数字_hostsとなります。</div>
<div class="line">{{△TPF_hosts△}}は実行時に転送元の絶対パスに置換されます。</div>
</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">内部の処理でテンプレートの変数定義を読み取り、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」や「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」で具体値が登録可能になります。</div>
<div class="line">読み取りのタイミングはリアルタイムではないので、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」や「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」で変数が扱えるまでに <strong>時間がかかる※</strong> 場合があります。</div>
<div class="line">※ 読み取りのタイミングは「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-file-list">
<span id="id20"></span><h4>ファイル管理<a class="headerlink" href="#general-operations-file-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[ファイル管理]では、Playbook内で定義している各モジュールで使用するファイルとファイル埋め込み変数の登録／更新／廃止を行います。</div>
<div class="line">ファイル管理でファイル素材を登録しておくことで、Playbook内で定義している各モジュールで使用するファイルをファイル埋め込み変数名で指定することが出来ます。</div>
</div>
<figure class="align-default" id="id99">
<a class="reference internal image-reference" href="../../../_images/image19.png"><img alt="サブメニュー画面（ファイル管理）" src="../../../_images/image19.png" style="width: 6.20054in; height: 2.75357in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（ファイル管理）</span><a class="headerlink" href="#id99" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、ファイル管理情報の登録を行います。</div>
</div>
<figure class="align-default" id="id100">
<a class="reference internal image-reference" href="../../../_images/image20.png"><img alt="登録画面（ファイル管理）" src="../../../_images/image20.png" style="width: 5.65318in; height: 0.81937in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（ファイル管理）</span><a class="headerlink" href="#id100" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id101">
<caption><span class="caption-text">登録画面項目一覧（ファイル管理）</span><a class="headerlink" href="#id101" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ファイル埋込</p>
<p>変数名</p>
</td>
<td><p>各モジュールのパラメータに埋め込む変数名を入力します。</p>
<p>変数名は、「CPF_****」形式で入力します。</p>
<p>****：半角英数字とアンダースコア（ _ ）が利用可能です。(最小値:1バイト、最大値:128バイト)</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>ファイル素材</p></td>
<td><p>各モジュールで使用するファイルをアップロードします。</p></td>
<td><p>○</p></td>
<td><p>ファイル登録</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">「登録」の前に、「ファイル素材」を「事前アップロード（①）」してください。「アップロード状況（②）」にPlaybookのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image_2a_2.png"><img alt="../../../_images/image_2a_2.png" class="align-center" src="../../../_images/image_2a_2.png" style="width: 2.60802in; height: 1.55251in;" /></a>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Playbookの記述</div>
<div class="line">プレイブックの各モジュールに記述する場合、ファイル埋め込み変数を記述します。</div>
<div class="line">※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。</div>
</div>
<div class="line-block">
<div class="line">e.g)</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">ファイル管理でhostsファイルをPlaybook内の各モジュールで使用する場合</div>
<div class="line">①ファイル管理メニューから下記のように対象ファイルを登録します。</div>
<div class="line"><strong>ファイル管理の登録内容</strong></div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファイル埋込変数名</strong></p></th>
<th class="head"><p><strong>ファイル素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPF_hosts</p></td>
<td><p>hosts</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">②Playbookは下記の記述となります。</div>
<div class="line"><strong>Playbookの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src=&#39;{{ CPF_hosts }}&#39; dest=/etc/hosts</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">ファイル管理でtool.tgzファイルをPlaybook内の各モジュールで使用する場合</div>
<div class="line">①ファイル管理メニューから下記のように対象ファイルを登録します。</div>
<div class="line"><strong>ファイル管理の登録内容</strong></div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファイル埋込変数名</strong></p></th>
<th class="head"><p><strong>ファイル素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPF_tool_tgz</p></td>
<td><p>tool.tgz</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">②Playbookは下記の記述となります。</div>
<div class="line"><strong>Playbookの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">unarchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ CPF_tool_tgz }} dest=/usr/local/bin</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">destはファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。</div>
<div class="line">たとえば、dest=/etc/ とした場合、ファイル名は/etc/10桁の数字_hostsとなります。</div>
</div>
</div>
</li>
<li><div class="line-block">
<div class="line">対話ファイルの記述</div>
<div class="line">対話ファイルに記述する場合、ファイル埋め込み変数を記述します。</div>
</div>
<div class="line-block">
<div class="line">e.g) ファイル管理でhostsファイルをPlaybook内の各モジュールで使用する場合</div>
<div class="line">①ファイル管理メニューから下記のように対象ファイルを登録します。</div>
<div class="line"><strong>ファイル管理の登録内容</strong></div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファイル埋込変数名</strong></p></th>
<th class="head"><p><strong>ファイル素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPF_hosts</p></td>
<td><p>hosts</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">②対話ファイルは下記の記述となります。</div>
<div class="line"><strong>対話ファイルの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;scp</span><span class="nv"> </span><span class="s">ITAユーザ@ITAホスト名:{{</span><span class="nv"> </span><span class="s">CPF_hosts</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">転送先&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ITAユーザのパスワード&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">転送先はファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。</div>
<div class="line">たとえば、転送先=/etc/ とした場合、ファイル名は/etc/10桁の数字_hostsとなります。</div>
<div class="line">{{△CPF_hosts△}}は実行時に転送元の絶対パスに置換されます。</div>
</div>
</div>
</li>
</ol>
</li>
</ol>
</section>
<section id="id21">
<h4>収集インターフェース情報<a class="headerlink" href="#id21" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">[収集インターフェース情報]では、収集機能で利用するITAの標準RESTAPIを利用する為、RESTAPIアクセス用の接続インターフェース情報の更新を行います。</div>
</div>
</section>
<section id="id22">
<h4>収集項目値管理<a class="headerlink" href="#id22" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">[収集項目値管理]では、収集対象項目とパラメータシートの項目の紐付設定を行います。</div>
</div>
<div class="line-block">
<div class="line">一覧/更新のメニューIDまたは、メニュー名称のリンクをクリックすると、対象メニューへ遷移します。</div>
</div>
<figure class="align-default" id="id102">
<a class="reference internal image-reference" href="../../../_images/image21.png"><img alt="サブメニュー画面（収集項目値管理）" src="../../../_images/image21.png" style="width: 6.06889in; height: 1.28747in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（収集項目値管理）</span><a class="headerlink" href="#id102" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="ansibel-legacy-legacy-role-pioneer">
<h3>Ansibel-Legacy／Legacy Role／Pioneer　コンソール<a class="headerlink" href="#ansibel-legacy-legacy-role-pioneer" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansibel-Legacy／Legacy Role／Pioneer　コンソールの操作です。</div>
</div>
<section id="os">
<span id="general-operations-os-type-master"></span><h4>OS種別マスタ<a class="headerlink" href="#os" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[OS種別マスタ] 画面では、ITAのPioneerより操作対象となる機器のOS種別を管理します。</div>
<div class="line">※本メニューはAnsible-Pioneer コンソールにのみ存在します。</div>
</div>
<figure class="align-default" id="id103">
<a class="reference internal image-reference" href="../../../_images/image22.png"><img alt="サブメニュー画面（ＯＳ種別マスタ）" src="../../../_images/image22.png" style="width: 6.08053in; height: 2.91359in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（ＯＳ種別マスタ）</span><a class="headerlink" href="#id103" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、OS情報の登録を行います。</div>
</div>
<figure class="align-default" id="id104">
<a class="reference internal image-reference" href="../../../_images/image23.png"><img alt="登録画面（ＯＳ種別マスタ）" src="../../../_images/image23.png" style="width: 5.80331in; height: 0.80347in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（ＯＳ種別マスタ）</span><a class="headerlink" href="#id104" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">一覧/更新の対話素材ファイル集ボタンをクリックすると、対象の <a class="reference internal" href="#general-operations-dialog-files-ansible-pioneer-only"><span class="std std-ref">対話ファイル素材集（Ansible-Pioneerのみ）</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id105">
<a class="reference internal image-reference" href="../../../_images/image24.png"><img alt="サブメニュー画面（ＯＳ種別マスタ）" src="../../../_images/image24.png" style="width: 5.81353in; height: 1.20265in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（ＯＳ種別マスタ）</span><a class="headerlink" href="#id105" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id106">
<caption><span class="caption-text">登録画面項目一覧（ＯＳ種別マスタ）</span><a class="headerlink" href="#id106" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>OS種別ID</p></td>
<td><p>登録情報を識別する一意のＩＤが自動入力されます。</p></td>
<td><p>○</p></td>
<td><p>自動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>OS種別名</p></td>
<td><p>任意の機器名称を入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p>機種別</p></td>
<td><p>SV</p></td>
<td><p>機器種別がサーバの場合「●」を選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>NW</p></td>
<td><p>機器種別がネットワーク機器の場合「●」を選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>ST</p></td>
<td><p>機器種別がストレージ機器の場合「●」を選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="movement">
<span id="general-operations-movement-list"></span><h4>Movement一覧<a class="headerlink" href="#movement" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[Movement一覧]ではMovement名の登録／更新／廃止を行います。</div>
</div>
<figure class="align-default" id="id107">
<a class="reference internal image-reference" href="../../../_images/image25.png"><img alt="サブメニュー画面（Movement一覧）" src="../../../_images/image25.png" style="width: 5.91875in; height: 2.79653in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Movement一覧）</span><a class="headerlink" href="#id107" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、Movement情報の登録を行います。</div>
</div>
<figure class="align-default" id="id108">
<a class="reference internal image-reference" href="../../../_images/image26.png"><img alt="登録画面（Movement一覧）" src="../../../_images/image26.png" style="width: 5.91875in; height: 0.63536in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Movement一覧）</span><a class="headerlink" href="#id108" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">Movement-Playbook紐付(Movement-対話種別紐付、Movement-ロール紐付)ボタンをクリックすると、対象の <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id109">
<a class="reference internal image-reference" href="../../../_images/image27.png"><img alt="サブメニュー画面（Movement一覧）" src="../../../_images/image27.png" style="width: 5.97831in; height: 1.1875in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Movement一覧）</span><a class="headerlink" href="#id109" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id110">
<caption><span class="caption-text">登録画面項目一覧（Movement一覧）</span><a class="headerlink" href="#id110" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Movement名</p></td>
<td><p>Movementの名称を入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td><p>遅延タイマー</p></td>
<td><p>Movementが指定期間遅延した場合にステータスを遅延として警告表示したい場合に指定期間(1～)を入力します。(単位:分)</p>
<p>未入力の場合は警告表示しません。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>ホスト指定形式</p></td>
<td><p>特別にIPアドレスで表現しないホストを指定したい場合に「ホスト名」を選択します。通常はIPが推奨です。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>virtualenv</p></td>
<td><p>Ansibleサーバー内にvirtualenvで構築したansible実行環境で作業実行したい場合、virtualenvのフルパスを入力して下さい。</p>
<p>virtualenv環境が存在しなかったりvirtualenv環境内にansibleがインストールされていない場合、作業実行時に「想定外エラー」となります。</p>
<p>未入力の場合はansibleサーバーにインストールされているansible環境で作業実行を行います。</p>
<p>Exp)</p>
<p>/virtualenv配下にansible11.1.0という名前でvirtualenv環境を作成した場合のvirtualenvのフルパスは下記となります。</p>
<p>virtualenv環境の作成</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">virtualenv</span>
<span class="n">virtualenv</span> <span class="n">ansible11</span><span class="mf">.1.0</span>
</pre></div>
</div>
<p>virtualenvのフルパス</p>
<p>/virtualenv/ansible11.1.0</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-even"><td><p>並列実行数</p>
<p>※PioneerのMovement一覧でのみ表示されます。</p>
</td>
<td><p>Ansible-playbookコマンドのオプションパラメータ「forks」を入力します。</p>
<p>■未入力時の振る舞いについて</p>
<p>サーバの設定ファイル(/etc/ansible.conf)の内容がデフォルト値となります。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>NULLまたは整数</p></td>
</tr>
<tr class="row-odd"><td><p>WinRM接続</p></td>
<td><p>対象ホストがWindowsServerの場合に、「●」を選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>ヘッダーセクション</p>
<p>※PioneerのMovement一覧では表示されません。</p>
</td>
<td><p>ITAが自動生成する親Playbookの先頭からtasksまたはrolesセクションまでのセクションを編集します。</p>
<p>未入力の場合は、以下を適用します。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ansible</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">remote_user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="c1"># Ansible Automation Controller</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
<p>※winrm接続の場合は become: yesは適用しません。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-odd"><td><p>オプションパラメータ</p>
<p>※PioneerのMovement一覧では表示されません。</p>
</td>
<td><p>Movement固有のオプションパラメータを入力します。</p>
<p>実行エンジンがAnsibleCoreの場合はansible-playbookコマンドのオプションパラメータ、実行エンジンがAnsible Core 以外の場合はジョブテンプレートのパラメータを入力します。</p>
<p>オプションパラメータの詳細については、「 <a class="reference internal" href="#general-operations-option-parameter-list"><span class="std std-ref">オプションパラメータ一覧</span></a> 」覧を参照してください。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-even"><td><p>Virtualenv</p>
<p>※実行エンジンがAnsibleTowerの場合に表示されます。</p>
</td>
<td><p>virtualenvで構築したansible実行環境を選択します。</p>
<p>未選択の場合は Ansible Automation Controller インストール時にインストールされた仮想環境を使用します。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>実行環境</p>
<p>※実行エンジンがAnsible Automation controller の場合に表示されます。</p>
</td>
<td><p>Ansible Automation Controllerサーバに構築されている実行環境が表示されています。</p>
<p>作業実行する実行環境を選択します。</p>
<p>未選択の場合は、デフォルト「Default execution environment」が使用されます。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Ansible.cfg</p></td>
<td><p>作業実行時に使用するansible.cfgをアップロードします。</p>
<p>未アップロードの場合は、デフォルトが使用されます。</p>
<p>また、ロールパッケージ管理でアップロードされているzipファイルにansible.cfgが含まれている場合は、この項目でアップロードしたansible.cfgで上書きされます。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">WinRM接続で「●」を選択した場合は接続するホストをすべてWindowsServerとみなします。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="playbook-ansible-legacy">
<span id="general-operations-playbook-file-list-ansible-legacy-only"></span><h4>Playbook素材集（Ansible-Legacyのみ）<a class="headerlink" href="#playbook-ansible-legacy" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[Playbook素材集]ではユーザーが作成したPlaybookの登録／更新／廃止を行います。</div>
<div class="line">※本メニューはAnsible-Legacy コンソールにのみ存在します。</div>
<div class="line">Playbookの記述など関しては、「 <a class="reference internal" href="#general-operations-write-playbook-ansible-legacy"><span class="std std-ref">Playbook（Ansible-Legacy）の記述</span></a> 」を参照してください。</div>
</div>
<figure class="align-default" id="id111">
<a class="reference internal image-reference" href="../../../_images/image28.png"><img alt="サブメニュー画面（Playbook素材集）" src="../../../_images/image28.png" style="width: 6.22721in; height: 2.78024in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Playbook素材集）</span><a class="headerlink" href="#id111" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、Playbookの登録を行います。</div>
</div>
<figure class="align-default" id="id112">
<a class="reference internal image-reference" href="../../../_images/image29.png"><img alt="登録画面（Playbook素材集）" src="../../../_images/image29.png" style="width: 5.99563in; height: 0.89595in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Playbook素材集）</span><a class="headerlink" href="#id112" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">Movement-Playbook紐付ボタンをクリックすると、対象の <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id113">
<a class="reference internal image-reference" href="../../../_images/image30.png"><img alt="サブメニュー画面（Playbook素材集）" src="../../../_images/image30.png" style="width: 6.16965in; height: 1.25024in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Playbook素材集）</span><a class="headerlink" href="#id113" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id114">
<caption><span class="caption-text">登録画面項目一覧（Playbook素材集）</span><a class="headerlink" href="#id114" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>プレイブック素材名</p></td>
<td><p>ITAで管理するプレイブック素材名を入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td><p>プレイブック素材</p></td>
<td><p>作成したPlaybookファイルをアップロードします。</p>
<p>アップロードするPlaybookファイルは文字コードがUTF-8のBOMで作成して下さい。</p>
<p>文字コードがUTF-8のBOMなし以外のPlaybookファイルはアップロードでエラーになります。</p>
</td>
<td><p>○</p></td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">「登録」の前に、「プレイブック素材」を「事前アップロード（①）」してください。「アップロード状況（②）」にPlaybookのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image_2a_3.png"><img alt="../../../_images/image_2a_3.png" class="align-center" src="../../../_images/image_2a_3.png" style="width: 1.81218in; height: 0.98027in;" /></a>
<div class="line-block">
<div class="line">内部の処理でPlaybookファイル内に定義している変数を抜出します。抜出した変数は、「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」や「<a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で具体値の登録が可能になります。</div>
<div class="line">抜出するタイミングはリアルタイムではありませんので、「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」や「<a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で変数が扱えるまでに <strong>時間がかかる※</strong> 場合があります。</div>
<div class="line">※ 抜出のタイミングは「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-role-package-list-ansible-legacy-role-only">
<span id="id23"></span><h4>ロールパッケージ管理（Ansible-Legacy Roleのみ）<a class="headerlink" href="#general-operations-role-package-list-ansible-legacy-role-only" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ユーザーが作成したロールパッケージファイルの登録／更新／廃止を行います。</div>
<div class="line">※本メニューはAnsible-Legacy Role コンソールにのみ存在します。</div>
<div class="line">ロールパッケージファイルは、「roles」のある階層のディレクトリをzipにて圧縮したものを登録してください。ロールパッケージディレクトリ構成などは「 <a class="reference internal" href="#general-operations-write-role-package-ansible-legacy-role"><span class="std std-ref">ロールパッケージ（Ansible-Legacy Role）の記述</span></a> 」を参照してください。</div>
</div>
<figure class="align-default" id="id115">
<a class="reference internal image-reference" href="../../../_images/image32.png"><img alt="サブメニュー画面（ロールパッケージ管理）" src="../../../_images/image32.png" style="width: 5.81384in; height: 2.59356in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（ロールパッケージ管理）</span><a class="headerlink" href="#id115" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、ロールパッケージ情報の登録を行います。</div>
</div>
<figure class="align-default" id="id116">
<a class="reference internal image-reference" href="../../../_images/image33.png"><img alt="登録画面（ロールパッケージ管理）" src="../../../_images/image33.png" style="width: 5.35466in; height: 0.78035in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（ロールパッケージ管理）</span><a class="headerlink" href="#id116" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">一覧/更新のMovement-ロール紐付ボタンをクリックすると、 <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id117">
<a class="reference internal image-reference" href="../../../_images/image34.png"><img alt="サブメニュー画面（ロールパッケージ管理）" src="../../../_images/image34.png" style="width: 6.55395in; height: 1.29253in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（ロールパッケージ管理）</span><a class="headerlink" href="#id117" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id118">
<caption><span class="caption-text">登録画面項目一覧（ロールパッケージ管理）</span><a class="headerlink" href="#id118" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ロールパッケージ名</p></td>
<td><p>ITAで管理するロールパッケージ名を入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td><p>ロールパッケージファイル</p></td>
<td><p>作成したロールパッケージファイル(zip形式)をアップロードします。</p>
<p>アップロードするロールパッケージファイルに含まれるPlaybookファイルは文字コードがUTF-8でBOMなしで作成して下さい。</p>
<p>UTF-8でBOMなし以外のPlaybookファイルが含まれていると登録時にエラーとなります。</p>
<p>詳しくは、「 <a class="reference internal" href="#general-operations-write-role-package-ansible-legacy-role"><span class="std std-ref">ロールパッケージ（Ansible-Legacy Role）の記述</span></a> 」を参照下さい。</p>
</td>
<td><p>○</p></td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">「登録」の前に、「ロールパッケージファイル」を「事前アップロード（①）」してください。「アップロード状況（②）」にロールパッケージファイル名が表示されたのを確認してから、「登録」ボタンを押してください。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image_2a_4.png"><img alt="../../../_images/image_2a_4.png" class="align-center" src="../../../_images/image_2a_4.png" style="width: 2.60802in; height: 1.55251in;" /></a>
<div class="line-block">
<div class="line">内部の処理でロールパッケージ内に定義している変数を取り出します。取り出した変数は、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」や「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」で具体値の登録が可能になります。</div>
<div class="line">抜出するタイミングはリアルタイムではありませんので、「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」や「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で変数が扱えるまでに <strong>時間がかかる※</strong> 場合があります。</div>
<div class="line">※ 抜出のタイミングは「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-dialog-type-list-ansible-pioneer-only">
<span id="id24"></span><h4>対話種別リスト（Ansible-Pioneerのみ）<a class="headerlink" href="#general-operations-dialog-type-list-ansible-pioneer-only" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[対話種別リスト]では、対話種別の登録／更新／廃止を行います。</div>
<div class="line">※本メニューはAnsible-Pioneer コンソールにのみ存在します。</div>
<div class="line">Ansible-Pioneerでは、「OS種別」ごとの差異を対話ファイルごとに定義し、同一目的の対話ファイルを「対話種別」として纏めて機器差分を吸収(抽象化)します。</div>
</div>
<figure class="align-default" id="id119">
<a class="reference internal image-reference" href="../../../_images/image35.png"><img alt="サブメニュー画面（対話種別リスト）" src="../../../_images/image35.png" style="width: 6.25388in; height: 2.78024in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（対話種別リスト）</span><a class="headerlink" href="#id119" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、オペレーション情報の登録を行います。</div>
</div>
<figure class="align-default" id="id120">
<a class="reference internal image-reference" href="../../../_images/image36.png"><img alt="登録画面（対話種別リスト）" src="../../../_images/image36.png" style="width: 5.38086in; height: 0.9422in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（対話種別リスト）</span><a class="headerlink" href="#id120" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">一覧/更新のMovement-対話種別紐付ボタンをクリックすると、対象の <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> へ遷移します。対話素材ファイル集ボタンをクリックすると、対象の <a class="reference internal" href="#general-operations-dialog-files-ansible-pioneer-only"><span class="std std-ref">対話ファイル素材集（Ansible-Pioneerのみ）</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id121">
<a class="reference internal image-reference" href="../../../_images/image37.png"><img alt="サブメニュー画面（対話種別リスト）" src="../../../_images/image37.png" style="width: 6.06944in; height: 1.17301in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（対話種別リスト）</span><a class="headerlink" href="#id121" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id122">
<caption><span class="caption-text">登録画面項目一覧（対話種別リスト）</span><a class="headerlink" href="#id122" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>対話種別名</p></td>
<td><p>対話種別名を入力します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="general-operations-dialog-files-ansible-pioneer-only">
<span id="id25"></span><h4>対話ファイル素材集（Ansible-Pioneerのみ）<a class="headerlink" href="#general-operations-dialog-files-ansible-pioneer-only" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[対話ファイル素材集]では、ユーザーが作成した対話ファイルの登録／更新／廃止を行います。</div>
<div class="line">※本メニューは、Ansible-Pioneer コンソールにのみ存在します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">対話ファイルの記述などに関しては、「 <a class="reference internal" href="#general-operations-write-dialog-file-ansible-pioneer"><span class="std std-ref">対話ファイル（Ansible-Pioneer）の記述</span></a> 」を参照してください。</div>
<div class="line">「対話種別」と「OS種別」の組み合わせごとに対話ファイルを登録します。</div>
<div class="line">１つの「対話種別」で複数のOSに対応させたい場合は、同じ「対話種別」で、「OS種別」それぞれについて対話ファイルを登録してください。</div>
</div>
<figure class="align-default" id="id123">
<a class="reference internal image-reference" href="../../../_images/image38.png"><img alt="サブメニュー画面（対話ファイル素材集）" src="../../../_images/image38.png" style="width: 6.4939in; height: 2.90025in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（対話ファイル素材集）</span><a class="headerlink" href="#id123" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、対話ファイル素材の登録を行います。</div>
</div>
<figure class="align-default" id="id124">
<a class="reference internal image-reference" href="../../../_images/image36.png"><img alt="登録画面（対話ファイル素材集）" src="../../../_images/image36.png" style="width: 5.19507in; height: 0.90966in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（対話ファイル素材集）</span><a class="headerlink" href="#id124" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">一覧/更新の対話種別のリンクをクリックすると、対象の <a class="reference internal" href="#general-operations-dialog-type-list-ansible-pioneer-only"><span class="std std-ref">対話種別リスト（Ansible-Pioneerのみ）</span></a> へ遷移します。</div>
<div class="line">また、os種別のリンクをクリックすると、対象の <a class="reference internal" href="#general-operations-os-type-master"><span class="std std-ref">OS種別マスタ</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id125">
<a class="reference internal image-reference" href="../../../_images/image39.png"><img alt="サブメニュー画面（対話ファイル素材集）" src="../../../_images/image39.png" style="width: 6.2281in; height: 1.2785in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（対話ファイル素材集）</span><a class="headerlink" href="#id125" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id126">
<caption><span class="caption-text">登録画面項目一覧（対話ファイル素材集）</span><a class="headerlink" href="#id126" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>対話種別</p></td>
<td><p>対話種別リストに登録されている対話種別が表示されます。登録する対話ファイルの対話種別を選択します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>OS種別</p></td>
<td><p>OS種別マスタに登録されているOS種別が表示されます。登録する対話ファイルのOS種別を選択します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>対話ファイル素材</p></td>
<td><p>対話種別とOS種別に対応する対話ファイルをアップロードします。</p>
<p>アップロードする対話ファイルは文字コードがUTF-8のBOMなしで作成して下さい。</p>
<p>文字コードがUTF-8のBOMなし以外の対話ファイルはアップロードでエラーになります。</p>
</td>
<td><p>○</p></td>
<td><p>ファイル登録</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">「登録」の前に、「対話ファイル」を「事前アップロード（①）」してください。「アップロード状況（②）」に対話ファイルのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image_2a_3.png"><img alt="../../../_images/image_2a_3.png" class="align-center" src="../../../_images/image_2a_3.png" style="width: 1.81218in; height: 0.98027in;" /></a>
<div class="line-block">
<div class="line">対話ファイルはYAML形式のファイルとして扱います。YAML形式に準じていない記述があると、アップロード時にエラーとなります。詳しくは、「 <a class="reference internal" href="#general-operations-things-to-keep-in-mind-when-writing-dialogue-files-in-yaml-format"><span class="std std-ref">対話ファイルをyaml形式で記載する際の注意事項</span></a> 」を参照して下さい。</div>
<div class="line">内部の処理で対話ファイル内に定義している変数を取り出します。取り出した変数は、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」や「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」で具体値の登録が可能になります。</div>
<div class="line">抜出するタイミングはリアルタイムではありませんので、「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」や「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で変数が扱えるまでに <strong>時間がかかる※</strong> 場合があります。</div>
<div class="line">※ 抜出のタイミングは「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</li>
</ol>
</section>
<section id="movement-playbook-movement-movement">
<span id="general-operations-movement-details"></span><h4>Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）<a class="headerlink" href="#movement-playbook-movement-movement" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">※メニュー名はAnsible-LegacyはMovement-Playbook紐付、Ansible-Pioneer はMovement-対話種別紐付、Ansible-LegacyRoleはMovement-ロール紐付です。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Movementで実行する素材の登録／更新／廃止を行います。</div>
</div>
<figure class="align-default" id="id127">
<a class="reference internal image-reference" href="../../../_images/image40.png"><img alt="サブメニュー画面（Movement-Playbook紐付）" src="../../../_images/image40.png" style="width: 6.16053in; height: 2.76691in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Movement-Playbook紐付）</span><a class="headerlink" href="#id127" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、Movement-Playbook紐付の登録を行います。</div>
</div>
<figure class="align-default" id="id128">
<a class="reference internal image-reference" href="../../../_images/image411.png"><img alt="登録画面（Movement-Playbook紐付）" src="../../../_images/image411.png" style="width: 5.57348in; height: 0.8004in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Movement-Playbook紐付）</span><a class="headerlink" href="#id128" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">Movementのリンクをクリックすると、対象の <a class="reference internal" href="#general-operations-movement-list"><span class="std std-ref">Movement一覧</span></a> へ遷移します。</div>
<div class="line">また、Playbook素材のリンクをクリックすると、<a class="reference internal" href="#general-operations-playbook-file-list-ansible-legacy-only"><span class="std std-ref">Playbook素材集（Ansible-Legacyのみ）</span></a> へ遷移します。</div>
<div class="line">※Movement-対話種別紐付（Ansible-Pioneer）の場合は、Movementと対話種別、Movement-ロール紐付（Ansible-LegacyRole）の場合は、Movementとロールパッケージ名がそれぞれリンクになっています。</div>
</div>
<figure class="align-default" id="id129">
<a class="reference internal image-reference" href="../../../_images/image42.png"><img alt="サブメニュー画面（Movement-Playbook紐付）" src="../../../_images/image42.png" style="width: 6.10208in; height: 1.22666in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Movement-Playbook紐付）</span><a class="headerlink" href="#id129" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line"><strong>Ansible-Legacy の場合</strong></div>
</div>
<table class="docutils align-left" id="id130">
<caption><span class="caption-text">登録画面項目一覧（Movement-Playbook紐付の場合）</span><a class="headerlink" href="#id130" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Movement</p></td>
<td><p>Movement一覧で登録したMovementが表示されます。</p>
<p>Movementを選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>プレイブック素材</p></td>
<td><p>「<a class="reference internal" href="#general-operations-playbook-file-list-ansible-legacy-only"><span class="std std-ref">Playbook素材集（Ansible-Legacyのみ）</span></a>」で登録したプレイブック素材が表示されます。プレイブック素材を選択します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>インクルード順序</p></td>
<td><p>プレイブック素材の実行順序(1～:一意値)を入力します。</p>
<p>入力されたインクルード順序(昇順)でプレイブック素材が実行されます。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>半角整数</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><strong>Ansible-Legacy Role の場合</strong></div>
</div>
<table class="docutils align-left" id="id131">
<caption><span class="caption-text">登録画面項目一覧（Movement-ロール紐付の場合）</span><a class="headerlink" href="#id131" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Movement</p></td>
<td><p>Ansible-Legacyと同様です。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>ロールパッケージ名</p></td>
<td><p>ロールパッケージ管理で登録したロールパッケージが表示されます。実行するロールパッケージを選択します。</p>
<p>同一Movementに複数のロールパッケージは登録出来ません。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>ロール名</p></td>
<td><p>ロールパッケージ名で選択したロールパッケージに含まれているロール名が表示されます。実行するロールパッケージ内のロールを選択します。</p></td>
<td><p>○</p></td>
<td></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>インクルード順序</p></td>
<td><p>Ansible-Legacyと同様です。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>半角整数</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><strong>Ansible-Pioneer の場合</strong></div>
</div>
<table class="docutils align-left" id="id132">
<caption><span class="caption-text">登録画面項目一覧（Movement-対話種別紐付の場合）</span><a class="headerlink" href="#id132" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Movement</p></td>
<td><p>Ansible-Legacyと同様です。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>対話種別</p></td>
<td><p>「<a class="reference internal" href="#general-operations-dialog-type-list-ansible-pioneer-only"><span class="std std-ref">対話種別リスト（Ansible-Pioneerのみ）</span></a>」で登録した対話種別が表示されます。実行する対話種別を選択します。</p>
<p>ホスト毎にOS種別と対話種別に関連付く対話ファイルが実行対象となります。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>インクルード順序</p></td>
<td><p>Ansible-Legacyと同様です。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>半角整数</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
</ol>
</section>
<section id="general-operations-nested-variable-list-ansible-legacy-role-only">
<span id="id26"></span><h4>変数ネスト管理（Ansible-Legacy Roleのみ）<a class="headerlink" href="#general-operations-nested-variable-list-ansible-legacy-role-only" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[変数ネスト管理]では、「 <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理（Ansible-Legacy Roleのみ）</span></a> 」で登録したロールパッケージで定義されている多段変数内で繰返配列定義されているメンバー変数の配列の最大繰返数の更新が行えます。変更したいメンバー変数の更新ボタンをクリックし最大繰返数を更新します。</div>
</div>
<figure class="align-default" id="id133">
<a class="reference internal image-reference" href="../../../_images/image43.png"><img alt="サブメニュー画面（変数ネスト管理）" src="../../../_images/image43.png" style="width: 6.38722in; height: 3.16694in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（変数ネスト管理）</span><a class="headerlink" href="#id133" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「一覧」-「更新」ボタンより最大繰返数の更新を行います。（※登録ボタンではありません）</div>
</div>
<figure class="align-default" id="id134">
<a class="reference internal image-reference" href="../../../_images/image44.png"><img alt="登録画面（変数ネスト管理）" src="../../../_images/image44.png" style="width: 5.94247in; height: 0.80925in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（変数ネスト管理）</span><a class="headerlink" href="#id134" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id135">
<caption><span class="caption-text">登録画面項目一覧（変数ネスト管理）</span><a class="headerlink" href="#id135" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>最大繰返数</p></td>
<td><p>配列の最大繰返数を1～99,999,999の範囲で入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>入力値1～99,999,999</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">メンバー変数名の表示は各階層の変数を「.」でスコープします。また、1階層目が繰返配列の場合はメンバー変数名が「－」と表示されます。</div>
<div class="line">e.g.)</div>
<div class="line"><strong>変数定義</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alice</span>
<span class="w">    </span><span class="nt">authorized</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
<span class="w">    </span><span class="nt">nested</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">craete_users</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xxxxxxxxx</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">craete_users</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xxxxxxxxx</span>
</pre></div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>メンバー変数の表示</strong></p></th>
<th class="head"><p><strong>最大繰返数の初期値</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>－</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>nested</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">内部の処理でロールパッケージ内に定義している多段変数繰返配列で定義されているメンバー変数の繰返数を初期登録します。初期登録後、変数ネスト管理で繰返数を更新することが出来ます。</div>
<div class="line">なお、初期登録および繰返数の更新はリアルタイムではないので、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」や「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」で変数が扱えるまでに <strong>時間がかかる※</strong> 場合があります。</div>
<div class="line">※ 初期登録および繰返数の更新タイミングは「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">変数名の一意管理</div>
<div class="line">変数名の管理は、全ロールパッケージで一意管理しています。ロールパッケージを跨って同じ変数名を使用している場合、変数ネスト管理で設定した繰返し数は、全ロールパッケージの変数に適用されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">アクセス許可ロール</div>
<div class="line">変数ネスト管理に設定されるアクセス許可ロールは、該当の変数が定義されているロールパッケージ管理のアクセス許可ロールが設定されます。複数のロールパッケージ管理で変数が定義されている場合、各ロールパッケージ管理のアクセス許可ロールが全て設定されます。また、アクセス許可ロールが空の場合、全てのロールへのアクセスが可能として扱われます。各ロールパッケージ管理のアクセス許可ロールが空白の場合、変数ネスト管理のアクセス許可ロールも空白が設定されます。</div>
<div class="line">アクセス許可ロールの詳細については <a class="reference internal" href="../it_automation_base/rbac.html"><span class="doc">はじめに</span></a> を参照して下さい。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>ロールパッケージ管理</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"><p>多段変数最大繰返数</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ロールパッケージ</p></td>
<td><p>変数</p></td>
<td><p>アクセス許可ロール</p></td>
<td></td>
<td><p>変数</p></td>
<td><p>アクセス許可ロール</p></td>
</tr>
<tr class="row-odd"><td><p>Packeage_A</p></td>
<td><p>VAR_nest1</p></td>
<td><p>空白</p></td>
<td></td>
<td><p>VAR_nest1</p></td>
<td><p>空白</p></td>
</tr>
<tr class="row-even"><td><p>Packeage_A</p></td>
<td><p>VAR_nest2</p></td>
<td><p>空白</p></td>
<td></td>
<td><p>VAR_nest2</p></td>
<td><p>空白</p></td>
</tr>
<tr class="row-odd"><td><p>Packeage_A</p></td>
<td><p>VAR_nest3</p></td>
<td><p>Role_A</p></td>
<td></td>
<td><p>VAR_nest3</p></td>
<td><p>Role_A,Role_B</p></td>
</tr>
<tr class="row-even"><td><p>Packeage_B</p></td>
<td><p>VAR_nest2</p></td>
<td><p>Role_A</p></td>
<td></td>
<td><p>VAR_nest4</p></td>
<td><p>Role_C</p></td>
</tr>
<tr class="row-odd"><td><p>Packeage_B</p></td>
<td><p>VAR_nest3</p></td>
<td><p>Role_B</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Packeage_B</p></td>
<td><p>VAR_nest4</p></td>
<td><p>Role_C</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="general-operations-substitution-value-auto-registration-setting">
<span id="id27"></span><h4>代入値自動登録設定<a class="headerlink" href="#general-operations-substitution-value-auto-registration-setting" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">メニュー作成機能で作成したパラメータシートと、Movementの変数を紐付けます。登録した情報は内部の処理により代入値管理と作業対象ホストに反映されます。</div>
<div class="line"><a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting2"><span class="std std-ref">代入自動値登録設定</span></a> に反映ルールを記載しています。</div>
</div>
<figure class="align-default" id="id136">
<a class="reference internal image-reference" href="../../../_images/image45.png"><img alt="サブメニュー画面（代入値自動登録設定）" src="../../../_images/image45.png" style="width: 6.08053in; height: 2.71357in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（代入値自動登録設定）</span><a class="headerlink" href="#id136" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより代入値自動登録設定を行います。</div>
</div>
<figure class="align-default" id="id137">
<a class="reference internal image-reference" href="../../../_images/image_2a_8.png"><img alt="登録画面（代入値自動登録設定）" src="../../../_images/image_2a_8.png" style="width: 5.59977in; height: 0.73063in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（代入値自動登録設定）</span><a class="headerlink" href="#id137" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">一覧/更新のメニューIDまたは、メニュー名称のリンクをクリックすると、対象メニューへ遷移します。</div>
</div>
<figure class="align-default" id="id138">
<a class="reference internal image-reference" href="../../../_images/image47.png"><img alt="サブメニュー画面（代入値自動登録設定）" src="../../../_images/image47.png" style="width: 6.43176in; height: 1.54306in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（代入値自動登録設定）</span><a class="headerlink" href="#id138" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<table class="docutils align-left" id="id139">
<caption><span class="caption-text">対応カラム一覧（代入値自動登録設定）</span><a class="headerlink" href="#id139" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p><strong>カラム</strong></p></th>
<th class="head"><p><strong>Legacy</strong></p></th>
<th class="head"><p><strong>Legacy Role</strong></p></th>
<th class="head"><p><strong>Pioneer</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>メニューグループ:メニュー</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>項目</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>登録方式</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>Movement</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p>Key</p>
<p>情報</p>
</td>
<td><p>変数名</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td><p>メンバー変数名</p></td>
<td><p>－</p></td>
<td><p>▲</p></td>
<td><p>－</p></td>
</tr>
<tr class="row-even"><td><p>代入順序</p></td>
<td><p>△</p></td>
<td><p>△</p></td>
<td><p>△</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>Value</p>
<p>情報</p>
</td>
<td><p>変数名</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-even"><td><p>メンバー変数名</p></td>
<td><p>－</p></td>
<td><p>▲</p></td>
<td><p>－</p></td>
</tr>
<tr class="row-odd"><td><p>代入順序</p></td>
<td><p>△</p></td>
<td><p>△</p></td>
<td><p>△</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>NULL連携</p></td>
<td><p>●</p></td>
<td><p>●</p></td>
<td><p>●</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">○:必須</div>
<div class="line">●:任意</div>
<div class="line">△:選択した変数が複数具体値設定可能な変数の場合のみ必須</div>
<div class="line">▲:選択した変数が多段変数の場合のみ必須</div>
<div class="line">－:非表示</div>
</div>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id140">
<caption><span class="caption-text">登録画面項目一覧（代入値自動登録設定）</span><a class="headerlink" href="#id140" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p><strong>カラム</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>メニューグループ:メニュー</p></td>
<td><p>メニュー作成機能で作成したパラメータシートが表示されます。</p>
<p>該当のパラメータシートを選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>項目</p></td>
<td><p>選択したパラメータシートの項目が表示されます。</p>
<p>対象の項目を選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>登録方式</p></td>
<td><p>Value型:項目の設定値を紐付けた変数の具体値とする場合に選択します。</p>
<p>Key型:項目の名称を紐付けた変数の具体値とする場合に選択します。</p>
<p>項目の設定値が空白の場合は紐付け対象外となります。</p>
<p>Key-Value型:項目の名称(Key)と設定値(Value)を紐付けた変数の具体値とする場合に選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>Movement</p></td>
<td><p>Movement一覧で登録したMovementが表示されます。Movementを選択します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td rowspan="3"><p>Key</p>
<p>情報</p>
</td>
<td><p>変数名</p></td>
<td><p>Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）で登録した資材で使用している変数が表示されます。</p>
<p>Key型で具体値に紐付けたい変数を選択します。</p>
</td>
<td><p>○</p>
<p>ま
た
は</p>
<p>/</p>
</td>
<td><p>リスト選択</p></td>
<td><p>登録方式でKey型</p>
<p>またはKey-Value型を</p>
<p>選択した場合は必須</p>
</td>
</tr>
<tr class="row-odd"><td><p>メンバー変数名</p></td>
<td><p>変数名で多段変数を選択した場合に多段変数の</p>
<p>メンバー変数が表示されます。</p>
<p>メンバー変数を選択します。</p>
</td>
<td><p>○</p>
<p>ま
た
は</p>
<p>/</p>
</td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>代入順序</p></td>
<td><p>複数具体値が設定できる変数の場合のみ必須入力になります。</p>
<p>具体値の代入順序（1～）を入力します。入力値に従い昇順で代入されます。具体値が複数ない場合でも代入順序（1～）を入力します。</p>
</td>
<td><p>○</p>
<p>ま
た
は</p>
<p>/</p>
</td>
<td><p>手動入力</p></td>
<td><p>ブランク</p>
<p>または、</p>
<p>正の整数</p>
</td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>Value</p>
<p>情報</p>
</td>
<td><p>変数名</p></td>
<td><p>Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）で登録した資材で使用している変数が表示されます。</p>
<p>Value型で具体値に紐付けたい変数を選択します。</p>
</td>
<td><p>○</p>
<p>ま
た
は</p>
<p>/</p>
</td>
<td><p>リスト選択</p></td>
<td><p>登録方式でValue型</p>
<p>またはKey-Value型を</p>
<p>選択した場合は必須</p>
</td>
</tr>
<tr class="row-even"><td><p>メンバー変数名</p></td>
<td><p>変数名で多段変数を選択した場合に多段変数の</p>
<p>メンバー変数が表示されます。</p>
<p>メンバー変数を選択します。</p>
</td>
<td><p>○</p>
<p>ま
た
は</p>
<p>/</p>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>代入順序</p></td>
<td><p>複数具体値が設定できる変数の場合のみ必須入力になります。</p>
<p>具体値の代入順序（1～）を入力します。入力値に従い昇順で代入されます。具体値が複数ない場合でも代入順序（1～）を入力します。</p>
</td>
<td><p>○</p>
<p>ま
た
は</p>
<p>/</p>
</td>
<td><p>手動入力</p></td>
<td><p>ブランク</p>
<p>または、</p>
<p>正の整数</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>NULL連携</p></td>
<td><p>パラメータシートの具体値がNULL(空白)の場合に、代入値管理への登録をNULL(空白)の値で行うか設定します。</p>
<p>・「有効」の場合、パラメータシートの値がどのような値でも代入値管理への登録が行われます。</p>
<p>・「無効」の場合、パラメータシートに値が入っている場合のみ代入値管理への登録が行われます。</p>
<p>・空白の場合、Ansibleインターフェース情報の「NULL連携」の値が適用されます。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※メンバー変数名の表記内容については「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">パラメータシートの変数項目</div>
<div class="line">「Ansible共通:テンプレート管理:テンプレート変数名」「Ansible共通:ファイル管理:ファイル埋込変数名」をパラメータシートの項目として代入値自動登録設定で使用した場合、項目の設定値は選択されている変数名となり紐付ている変数の具体値は‘{{ 変数名 }}’ として代入値管理に反映されます。</div>
<div class="line">ファイルパスはITAが作業実行時に配置したファイルパスをホスト変数経由でansibleが解釈し処理します。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image_2a_5.png"><img alt="../../../_images/image_2a_5.png" class="align-center" src="../../../_images/image_2a_5.png" style="width: 5.92051in; height: 1.60681in;" /></a>
</li>
<li><div class="line-block">
<div class="line">アクセス許可ロール</div>
<div class="line">代入値自動登録の情報から生成される代入値管理と作業対象ホストに設定されるアクセス許可ロールは、代入値自動登録に設定されているMovementとパラメータシートに設定されているホスト(機器一覧)とオペレーションの各アクセス許可ロールで一致しているロールが設定されます。また、アクセス許可ロールが空の場合、全てのロールへのアクセスが可能として扱われます。各アクセス許可ロールで一致するロールの組み合わせが無いデータは、代入値管理と作業対象ホストにデータが生成されません。</div>
<div class="line">アクセス許可ロールの詳細については <a class="reference internal" href="../it_automation_base/rbac.html"><span class="doc">はじめに</span></a> を参照して下さい。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>オペレーション</p></th>
<th class="head"><p>Host</p></th>
<th class="head"><p>Movement</p></th>
<th class="head"></th>
<th class="head"><p>代入値管理・作業管理ホストに展開されるアクセス許可</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>アクセス許可ロール</p></td>
<td><p>アクセス許可ロール</p></td>
<td><p>アクセス許可ロール</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>空白</p></td>
<td><p>空白</p></td>
<td><p>空白</p></td>
<td></td>
<td><p>空白</p></td>
</tr>
<tr class="row-even"><td><p>Role_A</p></td>
<td><p>空白</p></td>
<td><p>空白</p></td>
<td></td>
<td><p>Role_A</p></td>
</tr>
<tr class="row-odd"><td><p>Role_A</p></td>
<td><p>Role_A</p></td>
<td><p>空白</p></td>
<td></td>
<td><p>Role_A</p></td>
</tr>
<tr class="row-even"><td><p>Role_A</p></td>
<td><p>Role_A</p></td>
<td><p>Role_A</p></td>
<td></td>
<td><p>Role_A</p></td>
</tr>
<tr class="row-odd"><td><p>Role_A,RoleB</p></td>
<td><p>Role_A,RoleB</p></td>
<td><p>Role_A,Role_B,Role_C</p></td>
<td></td>
<td><p>Role_A,RoleB</p></td>
</tr>
<tr class="row-even"><td><p>Role_A</p></td>
<td><p>Role_B</p></td>
<td><p>Role_C</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">パラメータシート(縦メニュー)</div>
<div class="line">パラメータシート(縦メニュー)を使用する際に、リピート設定されている項目において、まとまり単位で値が空の場合、代入値自動登録設定でNULL連携を有効にしていても、代入値管理に登録はされません。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image_2a_6.png"><img alt="../../../_images/image_2a_6.png" class="align-center" src="../../../_images/image_2a_6.png" style="width: 5.44952in; height: 1.80784in;" /></a>
</li>
</ol>
</section>
<section id="general-operations-target-host">
<span id="id28"></span><h4>作業対象ホスト<a class="headerlink" href="#general-operations-target-host" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">[作業対象ホスト]では、オペレーションに関連付くMovementとホストの登録／更新／廃止を行います。</div>
</div>
<figure class="align-default" id="id141">
<a class="reference internal image-reference" href="../../../_images/image56.png"><img alt="サブメニュー画面（作業対象ホスト）" src="../../../_images/image56.png" style="width: 6.69236in; height: 3.32569in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業対象ホスト）</span><a class="headerlink" href="#id141" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより、作業対象ホスト登録を行います。</div>
</div>
<figure class="align-default" id="id142">
<a class="reference internal image-reference" href="../../../_images/image_2a_9.png"><img alt="登録画面（作業対象ホスト）" src="../../../_images/image_2a_9.png" style="width: 5.39203in; height: 1.33953in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（作業対象ホスト）</span><a class="headerlink" href="#id142" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">一覧/更新のMovementのリンクをクリックすると、対象の <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> へ遷移します。</div>
<div class="line">また、代入値管理ボタンをクリックすると、対象の <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id143">
<a class="reference internal image-reference" href="../../../_images/image58.png"><img alt="サブメニュー画面（作業対象ホスト）" src="../../../_images/image58.png" style="width: 6.20485in; height: 1.25094in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業対象ホスト）</span><a class="headerlink" href="#id143" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id144">
<caption><span class="caption-text">登録画面項目一覧（作業対象ホスト）</span><a class="headerlink" href="#id144" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>オペレーション</p></td>
<td><p>オペレーション一覧に登録されているオペレーションが表示されます。オペレーションを選択します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Movement</p></td>
<td><p>Movement一覧に登録されているMovementが表示されます。オペレーションに紐付けるMovementを選択します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>ホスト</p></td>
<td><p>機器一覧に登録されているホスト名が表示されます。</p>
<p>オペレーションに紐付けるホストを選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="general-operations-substitution-value-list">
<span id="id29"></span><h4>代入値管理<a class="headerlink" href="#general-operations-substitution-value-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">変数への代入値の登録／更新／廃止を行います。</div>
<div class="line">オペレーションごとに、対象のMovementで利用されるPlaybookやテンプレートファイル内の変数「VAR_」に代入する具体値をメンテナンス(閲覧/登録/更新/廃止)できます。</div>
<div class="line">また、読替表の定義により「VAR_」以外の変数「LCA_」に対して代入する具体値をメンテナンスできます。詳しくは「 <a class="reference internal" href="#general-operations-write-translation-table-ansible-legacy-role-only"><span class="std std-ref">読替表（Ansible-Legacy Roleのみ）の記述</span></a> 」を参照してください。</div>
<div class="line">登録した変数の情報は作業実行時にホスト変数ファイル(host_vars/配下)に出力されます。</div>
</div>
<figure class="align-default" id="id145">
<a class="reference internal image-reference" href="../../../_images/image59.png"><img alt="サブメニュー画面（代入値管理）" src="../../../_images/image59.png" style="width: 6.21389in; height: 2.8072in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（代入値管理）</span><a class="headerlink" href="#id145" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">「登録」-「登録開始」ボタンより代入値管理を行います。</div>
</div>
<figure class="align-default" id="id146">
<a class="reference internal image-reference" href="../../../_images/image60.png"><img alt="登録画面（代入値管理）" src="../../../_images/image60.png" style="width: 6.14722in; height: 0.63535in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（代入値管理）</span><a class="headerlink" href="#id146" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line">代入値管理の変数名は、アップロードされたPlaybookや代入値自動登録設定で登録された情報から反映されます。</div>
<div class="line">反映のタイミングは「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id147">
<caption><span class="caption-text">対応カラム一覧（代入値管理）</span><a class="headerlink" href="#id147" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>カラム</strong></p></th>
<th class="head"><p><strong>Legacy</strong></p></th>
<th class="head"><p><strong>Legacy Role</strong></p></th>
<th class="head"><p><strong>Pioneer</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>オペレーション</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td><p>Movement</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-even"><td><p>ホスト</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td><p>変数名</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-even"><td><p>メンバー変数名</p></td>
<td><p>－</p></td>
<td><p>▲</p></td>
<td><p>－</p></td>
</tr>
<tr class="row-odd"><td><p>代入順序</p></td>
<td><p>△</p></td>
<td><p>△</p></td>
<td><p>△</p></td>
</tr>
<tr class="row-even"><td><p>デフォルト値(表示のみ)</p></td>
<td><p>－</p></td>
<td><p>○</p></td>
<td><p>－</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">○:必須</div>
<div class="line">△:選択した変数が複数具体値設定可能な変数の場合のみ必須</div>
<div class="line">▲:選択した変数が多段変数の場合のみ必須</div>
<div class="line">－:非表示</div>
</div>
<table class="docutils align-left" id="id148">
<caption><span class="caption-text">登録画面項目一覧（代入値管理）</span><a class="headerlink" href="#id148" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>オペレーション</p></td>
<td><p>作業対象ホストに登録されているオペレーションが表示されます。オペレーションを選択します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="3"><p>Movement</p></td>
<td><p>作業対象ホストに登録されているデータの中から、選択されたオペレーションに紐づくMovementが表示されます。</p>
<p>Movementを選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="3"><p>ホスト</p></td>
<td><p>作業対象ホストに登録されているデータで選択されたオペレーションとMovementに紐づくホストが表示されます。</p>
<p>ホストを選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="3"><p>変数名</p></td>
<td><p>Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）にて登録されている資材の中から、選択されたMovementにアタッチしている変数名が表示されます。変数を選択します。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="3"><p>メンバー変数名</p></td>
<td><p>変数名で多段変数を選択した場合に多段変数のメンバー変数が表示されます。</p>
<p>メンバー変数を選択します。</p>
</td>
<td><p>○</p>
<p>ま
た
は</p>
<p>/</p>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>具体値</p></td>
<td rowspan="2"><p>文字列</p></td>
<td><p>Sensitive設定</p></td>
<td><p>「OFF」または「ON」を選択します。</p>
<p>「ON」を選択した場合、具体値を暗号化しITA上で表示させないようにします。</p>
<p>・Legacy/Legacy-Roleの場合</p>
<p>ansibleに渡すホスト変数ファイルには、ansible-vaultで暗号化された内容が設定されます。</p>
<p>・Pioneerの場合</p>
<p>ansibleに渡すホスト変数ファイルには、ITA独自で暗号化した内容が設定されます。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ボタン選択</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>値※１</p></td>
<td><p>オペレーション/Movement/ホストで使用する変数の具体値を入力します。複数行の具体値も入力できますが、Pioneerで複数行の具体値を設定すると、作業実行時にエラーとなります。</p>
<p>具体値にファイル埋込変数「CPF_」とテンプレート埋込変数「TPF_」が入力出来ます。変数を記述する場合、Playbookに変数を記述する場合と同様、変数名を{{}}で囲みます。</p>
<p>Exp)</p>
<p>具体値にTPF_sampleを入力する場合</p>
<p>'{{△TPF_sample△}}'</p>
<p>△:半角スペース</p>
<p>':シングル・ダブルコーテーションで囲む「必須」</p>
<p>尚、具体値に値とファイルの両方を設定することは出来ません。Sensitive設定ONで設定されている値をクリアしたい場合、Sensitive設定をOFFにして更新して下さい。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長8192バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>ファイル</p></td>
<td><p>オペレーション/Movement/ホストで使用する変数にファイルを埋込む場合に、埋込むファイルをアップロードします。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>代入順序</p></td>
<td><p>複数具体値が設定できる変数の場合のみ必須入力になります。</p>
<p>具体値の代入順序（1～）を入力します。入力値に従い昇順で代入されます。具体値が複数ない場合でも代入順序（1～）を入力します。</p>
</td>
<td><p>○</p>
<p>ま
た
は</p>
<p>/</p>
</td>
<td><p>手動入力</p></td>
<td><p>ブランク</p>
<p>または、</p>
<p>正の整数</p>
</td>
</tr>
<tr class="row-odd"><td colspan="3"><p>デフォルト値</p></td>
<td><p>変数名およびメンバー変数名で選択されている変数のデフォルト変数定義ファイル(defaults-&gt;main.yml)に設定されている具体値を表示します。</p>
<p>詳しくは「 <a class="reference internal" href="#general-operations-write-ita-readme-ansible-legacy-role-only"><span class="std std-ref">ITAreadme（Ansible-Legacy Roleのみ）の記述</span></a> 」を参照してください。</p>
<p>具体値が8進数文字列(0755)や16進数文字列(0x1ED)の場合、10進数(493)で表示されます。</p>
<p>具体値が「true」「Yes」「Y」「y」の場合は空白が表示されます。</p>
<p>具体値が「false」「No」「N」「n」の場合はFalseが表示されます。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>表示のみ</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="3"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※１具体値にファイル埋込変数「CPF_」・テンプレート埋込変数「TPF_」を設定する場合、Sensitive設定は「OFF」に設定して下さい。Sensitive設定が「ON」の場合、各変数として扱われません。</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">【メンバー変数名の表示内容】</div>
<div class="line">多段変数の場合にのみメンバー変数の選択が必要になります。メンバー変数に表示される変数は具体値を必要とする変数のみです。</div>
<div class="line">メンバー変数名の表示は各階層の変数を「.」でスコープします。繰返配列の場合は「[ ]」で繰返位置(0～)をスコープします。繰返し配列の数は「 <a class="reference internal" href="#general-operations-nested-variable-list-ansible-legacy-role-only"><span class="std std-ref">変数ネスト管理（Ansible-Legacy Roleのみ）</span></a> 」で設定を行います。</div>
</div>
<div class="line-block">
<div class="line">e.g.)</div>
<div class="line"><strong>変数定義</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alice</span>
<span class="w">    </span><span class="nt">authorized</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
<span class="w">    </span><span class="nt">mysql</span><span class="p">:</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-password</span>
<span class="w">        </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;127.0.0.1&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bob</span>
<span class="w">    </span><span class="nt">authorized</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
<span class="w">    </span><span class="nt">mysql</span><span class="p">:</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-password</span>
<span class="w">        </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;127.0.0.1&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span>
</pre></div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>メンバー変数の表示</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[0].name</p></td>
</tr>
<tr class="row-odd"><td><p>[0].authorized</p></td>
</tr>
<tr class="row-even"><td><p>[0].mysql.password</p></td>
</tr>
<tr class="row-odd"><td><p>[0].mysql.hosts</p></td>
</tr>
<tr class="row-even"><td><p>[1].name</p></td>
</tr>
<tr class="row-odd"><td><p>[1].authorized</p></td>
</tr>
<tr class="row-even"><td><p>[1].mysql.password</p></td>
</tr>
<tr class="row-odd"><td><p>[1].mysql.hosts</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※mysqlは階層を示す変数なのでメンバー変数には表示されません。</div>
</div>
<div class="line-block">
<div class="line">代入値自動登録設定で登録した情報は、内部の処理で代入値管理と作業対象ホストへ反映されます。</div>
<div class="line">※反映のタイミングは「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>代入順序の入力</strong></div>
<div class="line">Ansible-Legacyでは、代入順序が未入力の場合は、通常変数として扱います。</div>
<div class="line">代入順序が入力されている場合は、複数具体値変数として扱います。複数具体値変数の場合は複数の具体値が必要ない場合(具体値が1個でよい)でも代入順序は入力してください。</div>
<div class="line">Ansible-Legacy Roleでは、変数名またはメンバー変数名を選択することで、複数具体値変数の場合のみ代入順序が入力可能となります。複数具体値変数の場合に入力してください。</div>
<div class="line">Ansible-Pioneerでは、代入順序が未入力の場合は、通常変数として扱います。</div>
<div class="line">代入順序が入力されている場合は、複数具体値変数として扱います。複数具体値変数の場合は、複数の具体値が必要ない場合(具体値が1個でよい)でも代入順序を入力してください。</div>
<div class="line">各モードとも、特定の複数具体値変数に対して代入順序が連続していなくても問題ありません。</div>
<div class="line">e.g.)</div>
</div>
<table class="docutils align-left" id="id149">
<caption><span class="caption-text">代入値管理の登録</span><a class="headerlink" href="#id149" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>ホスト</p></th>
<th class="head"><p>変数</p></th>
<th class="head"><p>具体値</p></th>
<th class="head"><p>代入</p>
<p>順序</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HOST_A</p></td>
<td><p>VAR_std</p></td>
<td><p>value1</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>HOST_A</p></td>
<td><p>VAR_list_a</p></td>
<td><p>value2</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>HOST_A</p></td>
<td><p>VAR_list_b</p></td>
<td><p>value3</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>HOST_A</p></td>
<td><p>VAR_list_b</p></td>
<td><p>value4</p></td>
<td><p>200</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><strong>HOST_Aのホスト変数ファイルへの出力内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_std</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
<span class="nt">VAR_list_a</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
<span class="nt">VAR_list_b</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value3</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value4</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>ホスト変数ファイルへの出力</strong></div>
<div class="line">代入値管理で登録した変数の具体値はホスト変数ファイルへ出力されます。</div>
<div class="line">Ansible-Legacyと Ansible-Pioneerでは、作業実行時にPlaybookまたは対話ファイルで使用している変数の具体値が代入値管理に登録されていないと作業実行が想定外エラーとなります。</div>
<div class="line">Ansible-Legacy Roleでは、代入値管理で具体値を登録した変数のみが作業実行時にホスト変数ファイルへ出力されます。多段変数も同様で具体値を登録しているメンバー変数のみとなります。</div>
<div class="line">e.g.)</div>
</div>
<div class="line-block">
<div class="line"><strong>変数定義</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alice</span>
<span class="w">    </span><span class="nt">authorized</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
<span class="w">    </span><span class="nt">mysql</span><span class="p">:</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-password</span>
<span class="w">        </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;127.0.0.1&quot;</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bob</span>
<span class="w">    </span><span class="c1"># 略</span>
</pre></div>
</div>
<table class="docutils align-left" id="id150">
<caption><span class="caption-text">代入値管理の登録</span><a class="headerlink" href="#id150" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>ホスト</p></th>
<th class="head"><p>変数</p></th>
<th class="head"><p>メンバー変数</p></th>
<th class="head"><p>具体値</p></th>
<th class="head"><p>代入順序</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HOST_A</p></td>
<td><p>VAR_users</p></td>
<td><p>[0].name</p></td>
<td><p>value1</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>HOST_A</p></td>
<td><p>VAR_users</p></td>
<td><p>[1].authorized</p></td>
<td><p>value2</p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><strong>HOST_Aのホスト変数ファイルへの出力内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">.authorized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>デフォルト値チェックオプション</strong></div>
<div class="line">複数ロール間でデフォルト値が一致していない変数に対して具体値の登録した場合に、警告メッセージを表示して登録させないパラメータを「ITA管理コンソール システム設定」で設定することが出来ます。このパラメータはデフォルトでは未登録です。必要に応じて登録して下さい。</div>
<div class="line">システム設定に登録する内容は以下の通りです。尚、システム設定については <a class="reference internal" href="../it_automation_base/management_console.html"><span class="doc">管理コンソール</span></a> を参照してください。</div>
</div>
<table class="docutils align-left" id="id151">
<caption><span class="caption-text">システム設定登録内容</span><a class="headerlink" href="#id151" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>入力値</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>識別ID</p></td>
<td><p>ANSIBLE_DEF_VAL_CHK</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td><p>項目名</p></td>
<td><p>任意の文字列</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>設定値</p></td>
<td><p>1： パラメータ有効</p>
<p>1以外またはレコード未登録 ： パラメータ無効</p>
</td>
<td><p>○</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>任意の文字列</p></td>
<td></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="general-operations-check-operation-status">
<span id="id30"></span><h4>作業状態確認<a class="headerlink" href="#general-operations-check-operation-status" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業の実行状態を監視します。</div>
</div>
<figure class="align-default" id="id152">
<a class="reference internal image-reference" href="../../../_images/image61.png"><img alt="サブメニュー画面（作業状態確認）" src="../../../_images/image61.png" style="width: 4.63326in; height: 5.27826in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業状態確認）</span><a class="headerlink" href="#id152" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>実行状態表示</strong></div>
<div class="line">実行状況に即し、「ステータス」が表示されます。</div>
<div class="line">また、実行ログ、エラーログに実行状況の詳細が表示されます。</div>
<div class="line">「実行種別」には、ドライランの場合は「ドライラン」、それ以外は「通常」が表示されます。</div>
<div class="line">ステータスが想定外エラーで終了した場合、Webコンテンツの登録不備が原因であれば、エラーログにメッセージが表示されます。</div>
<div class="line">また、「 <a class="reference internal" href="#general-operations-interface-information"><span class="std std-ref">インターフェース情報</span></a> 」の登録不備等で、Ansible RestAPIとの通信に失敗した場合にはエラーログにメッセージが表示されません。この場合は、アプリケーションログにエラー情報が記録されます。必要に応じてアプリケーションログを確認ください。</div>
<div class="line">Symphonyから実行した場合に、「呼出元Symphony」には、どのSymphonyから実行されたかを表示します。</div>
<div class="line">Conductorから実行した場合に、「呼出元Conductor」には、どのConductorから実行されたかを表示します。</div>
<div class="line">Ansible-Legacy,Pioneer,LegacyRole,ドライバから直接実行した場合は空欄になります。</div>
<div class="line">「実行ユーザ」には、作業実行メニューより「実行」ボタンまたは「ドライラン」ボタンを押下した際のログインユーザが表示されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業対象ホスト確認</strong></div>
<div class="line">「確認」ボタンで「 <a class="reference internal" href="#general-operations-target-host"><span class="std std-ref">作業対象ホスト</span></a> 」が表示され、作業対象のオペレーションとMovementに絞り込んだホストが表示されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>代入値確認</strong></div>
<div class="line">「確認」ボタンで「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」が表示され、作業対象のオペレーションとMovementに絞り込んだ代入値が表示されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>緊急停止/予約取り消し</strong></div>
<div class="line">「緊急停止」ボタンで構築作業を停止させることができます。</div>
<div class="line">また、実行前の「予約実行」の作業の場合は、「予約取消」ボタンが表示されます。「予約取消」ボタンで予約実行が取り消せます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>実行ログ表示</strong></div>
<div class="line">Ansible Automation Controllerで実行した場合、構築対象機器の機器一覧のユーザー・パスワード・インスタンスグルーブなのどの項目値でグループ化された構築対象機器の単位でPlaybookが実行され、ansibleの実行ログが分割されます。</div>
<div class="line">さらに、Movement一覧のオプションパラメータでジョブスライス数を指定するすることによりグループ化された構築対象機器をさらにジョブスライス数で分割しplaybookが実行され、ansibleの実行ログも分割されます。</div>
<div class="line">実行ログが分割された場合、表示ログファイルのプルダウンが表示され、表示したいログファイルを選択する事ができます。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image62.png"><img alt="../../../_images/image62.png" class="align-center" src="../../../_images/image62.png" style="width: 6.68819in; height: 0.736in;" /></a>
<div class="line-block">
<div class="line">表示ログファイルのプルダウンに表示されるログファイル名は以下の2種類があります。</div>
<div class="line">exec.log:　全ての実行ログをまとめたログファイルです。</div>
<div class="line">exec.log以外: 分割された実行ログファイルです。ファイル命名規則は以下になります。</div>
<div class="line">Ita_&lt;mode名&gt;_executions_jobtpl_&lt;作業番号&gt;_&lt;グループ番号&gt;_&lt;通番&gt;</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>ログ検索</strong></div>
<div class="line">実行ログ、エラーログは、フィルタリングができます。各ログのフィルタのテキストボックスに検索したい文字列を入力し、「該当行のみ表示」のチェックボックスをチェックすることで該当する行だけが表示されます。</div>
<div class="line">実行ログ、エラーログのリフレッシュ表示間隔と最大表示行数を、「 <a class="reference internal" href="#general-operations-interface-information"><span class="std std-ref">インターフェース情報</span></a> 」の「状態監視周期（単位ミリ秒）」と「進行状態表示行数」で設定できます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>投入データ</strong></div>
<div class="line">実行したPlaybookなどをダウンロードすることができます。</div>
<div class="line">投入データの構成は「 <a class="reference internal" href="#general-operations-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu"><span class="std std-ref">Ansible実行時に使用される投入データとITAメニューの紐づけ</span></a> 」を参照して下さい。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>結果データ</strong></div>
<div class="line">実行ログ、エラーログなどをダウンロードすることができます。</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-execution-list">
<span id="id31"></span><h4>作業管理<a class="headerlink" href="#general-operations-execution-list" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業の履歴を閲覧できます。</div>
<div class="line">条件を指定し「フィルタ」ボタンをクリックすると、作業一覧テーブルを表示します。</div>
<div class="line">「作業状態確認」ボタンで、「 <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」に遷移し、実行状態の詳細を見ることができます。</div>
</div>
<figure class="align-default" id="id153">
<a class="reference internal image-reference" href="../../../_images/image63.png"><img alt="サブメニュー画面（作業管理）" src="../../../_images/image63.png" style="width: 6.12053in; height: 3.04693in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業管理）</span><a class="headerlink" href="#id153" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</section>
<section id="general-operations-execution">
<span id="id32"></span><h4>作業実行<a class="headerlink" href="#general-operations-execution" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業の実行を指示します。Movement一覧、オペレーション一覧からそれぞれラジオボタンで選択し、実行ボタンを押すと、「 <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」に遷移し、実行されます。</div>
</div>
<figure class="align-default" id="id154">
<a class="reference internal image-reference" href="../../../_images/image64.png"><img alt="サブメニュー画面（作業実行）" src="../../../_images/image64.png" style="width: 6.5739in; height: 3.82033in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業実行）</span><a class="headerlink" href="#id154" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>ドライラン</strong></div>
<div class="line">「ドライラン」ボタンをクリックすると、実際に対象機器に対して構築作業をせず、ドライランを行うことができます。ドライランを行った場合の、モード毎の動作は以下のとおりです。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Driver</strong></p></th>
<th class="head"><p><strong>動作</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ansible-Legacy</p></td>
<td><p>Ansible-Playbookコマンドの—checkパラメータを指定しPlaybookを実行します。</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Legacy Role</p></td>
<td><p>Ansible-Playbookコマンドの—checkパラメータを指定しroleを実行します。</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><p>対象機器への接続チェックのみを行います。</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><strong>予約日時の指定</strong></div>
<div class="line">「予約日時」を入力することで、実行を予約することがきます。</div>
<div class="line">「予約日時」には、未来の日時のみ登録可能です。</div>
</div>
<div class="line-block">
<div class="line">作業実行時にアクセス許可ロールの適合判定</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Movement</p></th>
<th class="head"><p>オペレーション</p></th>
<th class="head"></th>
<th class="head"><p>作業管理</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>アクセス許可ロール</p></td>
<td><p>アクセス許可ロール</p></td>
<td></td>
<td><p>アクセス許可ロール</p></td>
</tr>
<tr class="row-odd"><td><p>空白</p></td>
<td><p>空白</p></td>
<td></td>
<td><p>空白</p></td>
</tr>
<tr class="row-even"><td><p>空白</p></td>
<td><p>Role_A</p></td>
<td></td>
<td><p>Role_A</p></td>
</tr>
<tr class="row-odd"><td><p>Role_B</p></td>
<td><p>Role_B</p></td>
<td></td>
<td><p>Role_B</p></td>
</tr>
<tr class="row-even"><td><p>Role_B,Role_C</p></td>
<td><p>Role_B,Role_C</p></td>
<td></td>
<td><p>Role_B</p></td>
</tr>
<tr class="row-odd"><td><p>Role_D</p></td>
<td><p>Role_E</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Movement一覧、オペレーション一覧で選択したMovementとオペレーションの各アクセス許可ロールで一致するロールがあるかを判定します。一致するロールが無い場合、その旨のエラーメッセージが表示され作業実行は出来ません。また、一致するロールが作業管理のアクセス許可ロールとして設定されます。また、アクセス許可ロールが空白の場合は、全てのロールへのアクセスが可能として扱われます。各アクセス許可ロールが空白の場合、作業管理のアクセス許可ロールも空白に設定されます。</div>
<div class="line">アクセス許可ロールの詳細については <a class="reference internal" href="../it_automation_base/rbac.html"><span class="doc">はじめに</span></a> を参照して下さい。</div>
</div>
</li>
</ol>
</section>
</section>
</section>
<section id="id33">
<h2><span class="section-number">8.7. </span>構築コード記述方法<a class="headerlink" href="#id33" title="この見出しへのパーマリンク">¶</a></h2>
<section id="general-operations-write-playbook-ansible-legacy">
<span id="id34"></span><h3>Playbook（Ansible-Legacy）の記述<a class="headerlink" href="#general-operations-write-playbook-ansible-legacy" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">「 <a class="reference internal" href="#general-operations-playbook-file-list-ansible-legacy-only"><span class="std std-ref">Playbook素材集（Ansible-Legacyのみ）</span></a> 」でアップロードされたPlaybookは、ITAで生成するマスターPlaybookよりinclude形式で実行されます。</div>
<div class="line">ITAで作成するマスターPlaybookはへッダーセクションとtasksセクションで構成されます。</div>
</div>
<section id="id35">
<h4>ヘッダーセクション<a class="headerlink" href="#id35" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">アップロードアップロードするPlaybookにはヘッダーセクションは含む必要はありません。</div>
<div class="line">ヘッダーセクションは、デフォルト値が決まっていますが、「 <a class="reference internal" href="#general-operations-movement-list"><span class="std std-ref">Movement一覧</span></a> 」のヘッダーセクションで変更することが出来ます。</div>
<div class="line"><br /></div>
<div class="line">▼ヘッダーセクションのデフォルト値について</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible Coreの場合</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ヘッダーセクションのデフォルト値</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="nt">remote_user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible Automation Controllerの場合</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ヘッダーセクションのデフォルト値</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
</section>
<section id="tasks">
<h4>tasksセクション<a class="headerlink" href="#tasks" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">アップロードされたPlaybookは、ITAで生成するマスタPlaybookよりinclude形式で実行されます。</div>
<div class="line">Playbook基本書式についてはAnsibleの公式マニュアルを参照してください。</div>
<div class="line"><br /></div>
<div class="line">例)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">コメント</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">src</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.src</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.dest</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">none</span><span class="nv"> </span><span class="s">|ternary(&#39;root&#39;,</span><span class="nv"> </span><span class="s">item.owner)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.group</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">none</span><span class="nv"> </span><span class="s">|ternary(&#39;bacula&#39;,</span><span class="nv"> </span><span class="s">item.group)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.mode</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">none</span><span class="nv"> </span><span class="s">|ternary(&#39;0654&#39;,</span><span class="nv"> </span><span class="s">item.mode)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">Playbook内のインデントは2倍数で調整して下さい。</div>
<div class="line">文字コードは、UTF-8のBOMなしで作成して下さい。</div>
</div>
</div>
<div class="line-block">
<div class="line">アップロードさたPlaybookは、「 <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> 」のインクルード順序に従いincludeします。</div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image_2b_1.png"><img alt="../../../_images/image_2b_1.png" src="../../../_images/image_2b_1.png" style="width: 6.85417in; height: 4.67187in;" /></a>
</figure>
</section>
</section>
<section id="general-operations-write-dialog-file-ansible-pioneer">
<span id="id36"></span><h3>対話ファイル（Ansible-Pioneer）の記述<a class="headerlink" href="#general-operations-write-dialog-file-ansible-pioneer" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible-Pioneerでは、ITA独自モジュールをAnsibleに組込んでいます。</div>
<div class="line">対話ファイルはITA独自書式となります。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">文字コードは、UTF-8のBOMなしで作成して下さい。</div>
<div class="line">対話ファイルはYAML形式のファイルとして扱います。YAML形式に準じていない記述があると、対話ファイルのアップロード時や作業実行時にエラーとなります。詳しくは、本章の「 <a class="reference internal" href="#general-operations-things-to-keep-in-mind-when-writing-dialogue-files-in-yaml-format"><span class="std std-ref">対話ファイルをyaml形式で記載する際の注意事項</span></a> 」を参照して下さい。</div>
</div>
</div>
<section id="id37">
<h4>対話ファイルの構成<a class="headerlink" href="#id37" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話ファイルは2種類のセクションにより構成されます。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>セクション名</strong></p></th>
<th class="head"><p><strong>用途</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>conf</p></td>
<td><p>timeoutパラメータによりタイムアウト値を指定します。</p>
<p>タイムアウト値:1～3600(単位:秒)</p>
</td>
</tr>
<tr class="row-odd"><td><p>exe_list</p></td>
<td><p>4種の対話コマンドにより作業対象ホストの構築を行います。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">以降に対話コマンドを記述します。</div>
<div class="line">例1-1)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># コメント</span>
<span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">exec_list</span><span class="p">:</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">対話ファイルの先頭にtimeoutパラメータを記述します。</div>
<div class="line">コメントはAnsibleの基本書式と同様の記述が出来ます。</div>
</div>
</div>
</section>
<section id="id38">
<h4>対話コマンド<a class="headerlink" href="#id38" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話コマンドは以下の5種類があります。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>モジュール</strong></p></th>
<th class="head"><p><strong>用途</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>exec</p></td>
<td><p>作業対象ホストにコマンドを投入します。</p></td>
</tr>
<tr class="row-odd"><td><p>expect</p></td>
<td><p>作業対象ホストが標準出力に出力する内容より、期待する文字列(プロンプト)の出力を待ち合せます。</p></td>
</tr>
<tr class="row-even"><td><p>state</p></td>
<td><p>作業対象ホストにコマンドを投入し、標準出力にプロンプトを出力するまでの
標準出力の内容を外部Shellで解析し結果判定をします。</p></td>
</tr>
<tr class="row-odd"><td><p>command</p></td>
<td><p>作業対象ホストにコマンドを投入する前後において、繰り返しや条件分岐を行うことができます。</p></td>
</tr>
<tr class="row-even"><td><p>localaction</p></td>
<td><p>Ansible/Ansible AutomationControllerサーバ上でコマンドを実行します。</p></td>
</tr>
</tbody>
</table>
<section id="expect">
<h5>①expectモジュール<a class="headerlink" href="#expect" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">作業対象ホストが標準出力に出力する内容より、期待する文字列(プロンプト)の出力を待ち合せます。期待する文字列を正規表記で記述できます。</div>
<div class="line">期待する文字列を受取ると次へ進みます。また、timeoutパラメータで指定された時間内に受取れない場合は対話ファイルを異常終了します。</div>
<div class="line">例2-1)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># telnet接続でパスワード入力のプロンプトを待ち合せます。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Password&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">待ち合わせる文字列をコーテーションで囲むことを推奨します。</div>
</div>
</div>
</section>
<section id="exec">
<h5>②execモジュール<a class="headerlink" href="#exec" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">作業対象ホストにコマンドを投入します。</div>
<div class="line">execモジュールとexpectモジュールは対で使用します。</div>
<div class="line">例2-2)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># telnet接続でパスワード入力のプロンプトを待ち合せてパスワードを投入します。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Password&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">itapassword</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">必要に応じコーテーションで囲むことを推奨します。</div>
</div>
</div>
</section>
<section id="state">
<h5>③stateモジュール<a class="headerlink" href="#state" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">作業対象ホストにコマンドを投入し、標準出力にプロンプトを出力するまでの標準出力の内容を外部Shellで解析し結果判定をします。</div>
</div>
<table class="docutils align-left" id="id155">
<caption><span class="caption-text">stateモジュールの書式</span><a class="headerlink" href="#id155" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>必須/任意</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>state</p></td>
<td><p>必須</p></td>
<td><p>投入するコマンドを指定します。</p></td>
</tr>
<tr class="row-odd"><td><p>prompt</p></td>
<td><p>必須</p></td>
<td><p>待受けプロンプトを指定します。正規表記で記述できます。</p></td>
</tr>
<tr class="row-even"><td><p>shell</p></td>
<td><p>任意</p></td>
<td><p>作成したshellで結果を確認する場合に、shellファイル名を指定します。</p>
<p>作成したshellのexitコードが0の場合は正常、他は異常と判定します。</p>
<p>デフォルトのshellで結果を確認する場合、本パラメータは不要となります。</p>
<p>デフォルトのshellはparameter(-)で指定された文字列で標準出力の内容をgrepします。</p>
<p>マッチする行が1行でもあれば正常とし、マッチする行がなければ異常と判定します。</p>
<p>また、parameterを指定しなかった場合、異常と判定されます。</p>
<p>コマンドの結果(標準出力)をstdout_fileで指定したファイルに退避したい目的で使用する場合、ignore_errorsで「yes」を指定して下さい。</p>
</td>
</tr>
<tr class="row-odd"><td><p>parameter</p></td>
<td><p>任意</p></td>
<td><p>投入するコマンドの結果(標準出力)を検索する文字列を指定します。</p>
<p>shellを指定している場合、作成したshellの実行時パラメータとなります。複数ある場合は検索文字列を列挙します。</p>
</td>
</tr>
<tr class="row-even"><td><p>stdout_file</p></td>
<td><p>任意</p></td>
<td><p>投入するコマンドの結果(標準出力)を退避するファイルです。</p></td>
</tr>
<tr class="row-odd"><td><p>success_exit</p></td>
<td><p>任意</p></td>
<td><p>検索結果が正常の場合で対話ファイルを正常終了する場合に「yes」を指定します。</p>
<p>「no」の場合は正常の場合は次に進みます。</p>
<p>デフォルトは「no」。</p>
</td>
</tr>
<tr class="row-even"><td><p>ignore_errors</p></td>
<td><p>任意</p></td>
<td><p>検索結果が異常でも次に進む場合に「yes」を指定します。</p>
<p>「no」の場合は、異常の場合に対話ファイルを異常終了とします。</p>
<p>デフォルトは「no」。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">例2-3)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、表示結果をparameter値でgrepしている。139.0.0.1、lalhostを含む行があれば正常と判定し次に進みます。</span>
<span class="c1"># 行がなければ異常と判定し対話ファイルを異常終了します。</span>
<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;139.0.0.1&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lalhost&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例2-4)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、表示結果をparameter値でgrepしている。</span>
<span class="c1"># 139.0.0.1、lalhostを含む行があれば正常と判定しますがsuccess_exit: yesの設定により対話ファイルを正常終了します。</span>
<span class="c1"># 行がなければ異常と判定し対話ファイルを異常終了します。</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;139.0.0.1&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lalhost&#39;</span>
<span class="w">    </span><span class="nt">success_exit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例2-5)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、表示結果をparameter値でgrepしている。139.0.0.1、lalhostを含む</span>
<span class="c1"># 139.0.0.1、lalhostを含む行があれば正常と判定し次に進みます。</span>
<span class="c1"># 行がなければ異常と判定しますがignore_errors: yesの設定により次に進みます。</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;139.0.0.1&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lalhost&#39;</span>
<span class="w">    </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例2-6)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、ユーザー作成のshellで表示結果をparameter値でgrepしている。</span>
<span class="c1"># 139.0.0.1、lalhostを含む行があれば正常と判定し次に進みます。</span>
<span class="c1"># 行がなければ異常と判定し対話ファイルを異常終了します。</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/tmp/grep.sh&#39;</span>
<span class="w">    </span><span class="nt">stdout_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/tmp/stdout.txt&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;139.0.0.1&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lalhost&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>

<span class="c1"># ユーザー作成 shell(/tmp/grep.sh)</span>
<span class="c1">#!/bin/bash</span>
<span class="l l-Scalar l-Scalar-Plain">STDOUT=/tmp/STDOUT.tmp</span>
<span class="l l-Scalar l-Scalar-Plain">STDERR=/tmp/STDERR.tmp</span>
<span class="l l-Scalar l-Scalar-Plain">cat /tmp/stdout.txt|grep $1|grep $2 | wc -l &gt;${STDOUT} 2&gt;${STDERR}</span>
<span class="l l-Scalar l-Scalar-Plain">RET=$?</span>
<span class="l l-Scalar l-Scalar-Plain">if [ $RET -ne 0 ]; then</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">EXIT_CODE=$RET</span>
<span class="l l-Scalar l-Scalar-Plain">else</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">if [ -s ${STDERR} ]; then</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">EXIT_CODE=1</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">else</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">CNT=`cat ${STDOUT}`</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">if [ ${CNT} -eq 0 ]; then</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">EXIT_CODE=1</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">else</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">EXIT_CODE=0</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
<span class="l l-Scalar l-Scalar-Plain">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例2-7)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、表示結果をstdout_file で指定したファイルに保存し次に進みます。</span>
<span class="c1"># デフォルトのshellはparameterの設定がないと異常と判定します。次に進める為にignore_errors: yesを設定します。</span>
<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">stdout_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__symphony_workflowdir__</span><span class="nv"> </span><span class="s">}}/hosts&#39;</span>
<span class="w">    </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
</section>
<section id="command">
<h5>④commandモジュール<a class="headerlink" href="#command" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">作業対象ホストにコマンドを投入する前後において、繰り返しや条件分岐を行うことができます。</div>
<div class="line">commandモジュールの書式</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>必須/任意</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>command</p></td>
<td><p>必須</p></td>
<td><p>投入するコマンドを指定します。</p></td>
</tr>
<tr class="row-odd"><td><p>prompt</p></td>
<td><p>必須</p></td>
<td><p>待受けプロンプトを指定します。正規表記で記述できます。</p></td>
</tr>
<tr class="row-even"><td><p>timeout</p></td>
<td><p>任意</p></td>
<td><p>コマンドを送ってからのプロンプト待ちタイマを指定します。</p>
<p>省略されている場合は、conf-&gt;timeoutを使用します。</p>
</td>
</tr>
<tr class="row-odd"><td><p>register</p></td>
<td><p>任意</p></td>
<td><p>コマンドを送信後に標準出力の情報を設定する変数「任意の文字列」を指定します。</p>
<p>with_itemsでループしている場合は、最後のコマンド送信後の標準出力の情報が設定されます。</p>
<p>設定した変数はcommandモジュールの条件判定(when・exec_when・failed_when)でのみ使用できます。</p>
<p>設定した変数は、1つのみ保持できます。次にregisterで別の変数に値を設定した場合、前に設定した変数は削除されます。</p>
</td>
</tr>
<tr class="row-even"><td><p>with_items</p></td>
<td><p>任意</p></td>
<td><p>with_itemsにコマンドをループして投入する場合にに複数具体値変数の変数名を設定します。各変数のスコープはitem.X(Xは0から99)とします。</p>
<p>prompt、timeoutでwith_itemsを利用する場合の変数名は下記の通りにしてください。</p>
<p>prompt: {{ VAR_prompt_XXX }}</p>
<p>timeout: {{ VAR_timeout_XXX }}</p>
<p>(XXXは任意の半角英数字とアンダースコア)</p>
<p>with_itemsに設定する各変数の具体値数が同じでない場合、各変数の具体値数の最大値数でループします。具体値が不足している変数の具体値は空として扱います。</p>
<p>また、promptやtimeoutでwith_itemsを利用する場合、具体値数に注意が必要です。</p>
<p>prompt→command→prompt→command→prompt・・・(以下ループ)となり、command数+1の具体値を設定する必要があります。(timeoutも同様)</p>
<p>prompt、timeout の変数の具体値数が不足していると、作業実行時にエラーになります。</p>
</td>
</tr>
<tr class="row-odd"><td><p>when</p></td>
<td><p>任意</p></td>
<td><p>command実行前の条件判定です。</p>
<p>条件にマッチしてcommand実行します。</p>
<p>条件にマッチしていなければ次のcommand行に移ります。</p>
<p>条件式</p>
<p>　変数定義判定</p>
<p>　VAR_xx is define　　　変数が定義されている　　true</p>
<p>　VAR_xx is undefine　　変数が未定義　　　　　　true</p>
<p>　Exp）</p>
<p>　　- 'VAR_status is define'</p>
<p>　　- 'VAR_status is undefine'</p>
<p>※define/undefineはITAの変数(VAR_xx)のみ指定可能</p>
<p>変数具体値判定</p>
<p>VAR_xx/register変数　比較演算子　文字列</p>
<p>VAR_xx/register変数　比較演算子　VAR_xx</p>
<p>VAR_xx/register変数　match(正規表記文字列/VAR_xx)</p>
<p>VAR_xx/register変数　no match(正規表記文字列/VAR_xx)</p>
<p>※比較演算子は「==」、「!=」、「&gt;」、「&gt;=」、「&lt;」、「&lt;=」</p>
<p>※比較演算子の「&gt;」、「&gt;=」、「&lt;」、「&lt;=」は数値を想定しています。</p>
<p>　Exp）</p>
<p>　　- '{{ VAR_status }} match(active)'</p>
<p>　　- '{{ VAR_status }} == active'</p>
<p>　　- 'register変数match(active)'</p>
<p>　※activeなどの条件判定する文字列をクォーテーションで囲む必要はありません。</p>
<p>and/orによる複合条件</p>
<p>　or条件を行いたい場合、判定条件の間にORを記述します。</p>
<p>　Exp）</p>
<p>　　- '{{ VAR_status }} == 1　OR {{ VAR_status }} == 2'</p>
<p>　and条件を行いたい場合、複数行に分けて記述するとand条件になります。</p>
<p>　Exp）</p>
<p>　　- '{{ VAR_status }} == 1　OR {{ VAR_status }} == 2'</p>
<p>　　- '{{ VAR_sub_status }} == 1'</p>
</td>
</tr>
<tr class="row-even"><td><p>exec_when</p></td>
<td><p>任意</p></td>
<td><p>ループ毎の条件判定です。(continue条件)</p>
<p>with_itemsが記述されている場合に条件判定を行います。</p>
<p>条件にマッチしていれば該当ループのcommandを実行します。</p>
<p>マッチしていなければ次のループへ移ります。</p>
<p>条件式</p>
<p>　when:と同様の記述が行えます。</p>
</td>
</tr>
<tr class="row-odd"><td><p>failed_when</p></td>
<td><p>任意</p></td>
<td><p>command実行後(ループ毎)のstdoutの内容に対する条件判定です。</p>
<p>with_itemsが記述されている場合に条件判定を行います。</p>
<p>条件にマッチしていれば正常とします。</p>
<p>マッチしていなければ異常とし、対話ファイルを異常終了させます。</p>
<p>条件式</p>
<p>　変数具体値判定</p>
<p>　stdout 比較演算子 文字列</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">registerパラメータの有効範囲</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;assword:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">status</span><span class="nv"> </span><span class="s">httpd&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd_status_register</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">restart</span><span class="nv"> </span><span class="s">httpd&#39;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd_status_register no match(running)</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">status</span><span class="nv"> </span><span class="s">mysql&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql_status_register</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">restart</span><span class="nv"> </span><span class="s">mysql&#39;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql_status_register no match(running)</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">6行目のhttpd_status_registerは、11行目のcommandモジュール内のregisterで別の変数(mysql_status_register)に値を設定している為、10行目までが有効範囲となります。</div>
</div>
</div>
<p>例)　with_itemsで定義した変数はregister/when以外でitem.Xでスコープすることが出来ます。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_item1</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1">#item.0</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_item2</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1">#item.1</span>
<span class="nt">exec_when</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">active&#39;</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">VAR_status</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;register変数</span><span class="nv"> </span><span class="s">match({{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}})&#39;</span>
<span class="nt">failed_when</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;stdout</span><span class="nv"> </span><span class="s">match({{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}})&#39;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例）commandモジュールで、下記コマンドを実行したい場合</div>
<div class="line-block">
<div class="line">・systemctl start httpd</div>
<div class="line">・systemctl start mysql</div>
</div>
</div>
<div class="line-block">
<div class="line">対話ファイルの記述とwith_itemsで使用する変数の具体値は以下の様になります。</div>
</div>
<div class="line-block">
<div class="line">▼対話ファイルの記述内容</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;systemctl</span><span class="nv">  </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}</span><span class="nv">  </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.2</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.3</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_status_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">    </span><span class="c1"># item.0</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1"># item.1</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_prompt_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">    </span><span class="c1"># item.2</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_timeout_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1"># item.3</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">▼with_itemsで使用する変数の具体値</div>
</div>
<div class="line-block">
<div class="line">　VAR_status_list:　　　　　 VAR_service_list:</div>
<div class="line">　- start　　　　　　　　　　- httpd</div>
<div class="line">　- start　　　　　　　　　　- mysql</div>
<div class="line">　VAR_prompt_list:　　　　　 VAR_timeout_list:</div>
<div class="line">　 - コマンドプロンプト　　　 - 10</div>
<div class="line">　 - コマンドプロンプト　　　 - 10</div>
<div class="line">　 - コマンドプロンプト　　　 - 10</div>
</div>
<div class="line-block">
<div class="line">例3-1)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># VAR_hosts_makeというITA変数がホスト変数ファイルに記載されている場合、</span>
<span class="c1"># hostsファイルをcatします。記載されていない場合は、スキップします。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /etc/hosts</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAR_hosts_make is define</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例3-2)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># VAR_hosts_makeというITA変数がホスト変数ファイルに記載されている場合、</span>
<span class="c1"># hostsファイルをcatします。記載されていない場合は、スキップします。</span>
<span class="c1"># catにより、標準出力されたhostsファイルの内容をresult_stdoutに退避します。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /etc/hosts</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result_stdout</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAR_hosts_make is define</span>

<span class="c1"># VAR_hosts_makeというITA変数がホスト変数ファイルに記載されている場合、</span>
<span class="c1"># command実行します。記載されていない場合は、スキップします。</span>
<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># ループ毎の条件判定として、hostsファイルに「ipアドレス ホスト名」が該当しない場合</span>
<span class="c1"># command実行します。</span>
<span class="c1"># hostsファイルの最終行にechoによる、「IPアドレス ホスト名」を追記します。</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;echo</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}</span><span class="nv">  </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">&gt;&gt;</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAR_hosts_make is define</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_hosts_ip</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">      </span><span class="c1"># item.0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_hosts_name</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1"># item.1</span>
<span class="w">    </span><span class="nt">exec_when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result_stdout no match({{ item.0 }} *{{ item.1 }})</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例3-3)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># 自動起動設定を実行します。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">enable</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_name_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.0</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># サービスの起動を実行します。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">start</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_name_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.0</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># サービスのステータスを標準出力します。</span>
<span class="c1"># 標準出力された結果の内容に、item.1の正規表現がある場合、正となります。</span>
<span class="c1"># 例えば、VAR_service_status_listの具体値をrunningと設定し、サービスが起動している場合、</span>
<span class="c1"># 「Active: active (running)」のrunnigが一致するので正となります。(次のループに移ります)</span>
<span class="c1"># そうでない場合は、異常と判断し、対話ファイルは異常終了となります。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">status</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_name_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_status_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.1</span>
<span class="w">    </span><span class="nt">failed_when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stdout match({{ item.1 }})</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例3-4)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># commandに「{{ item.0 }}」のみの記述をする場合は、ダブルクォーテーションで囲みます。</span>
<span class="c1"># promptやtimeoutでwith_itemsを利用する場合、具体値数に注意が必要です。</span>
<span class="c1"># prompt→command→prompt→command→prompt ・・・(以下ループ)となり、command数+1</span>
<span class="c1"># 設定する必要があります。(timeoutも同様)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.2</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_command_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_prompt_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">    </span><span class="c1"># item.1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_timeout_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">    </span><span class="c1"># item.2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例3-5)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># 代入値管理の具体値に{{ item.X }} を設定することができます。その際は対話ファイルに記載する</span>
<span class="c1"># item.Xより具体値に記載するitem.Xの数値が大きくなるようにしてください。</span>
<span class="c1"># 今回の例で実行するcommandは「systemctl status ky_pioneer_execute-workflow.service」</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_command_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">      </span><span class="c1"># item.0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_name_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.1</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">※ VAR_command_list      ・・・ systemctl status {{ item.1 }}</div>
<div class="line">※ VAR_service_name_list ・・・ ky_pioneer_execute-workflow.service</div>
</div>
<div class="line-block">
<div class="line">例3-6)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># and/orによる複合条件の記述例です。</span>
<span class="c1"># or条件を行いたい場合、if文を横に記述することができます。</span>
<span class="c1"># and条件を行いたい場合、複数行に分けて記述するとand条件になります。</span>
<span class="c1"># 今回、whenを例にしていますが、exec_when、failed_whenも同様です。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo aaa</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10 == 9 OR 10 != 9 OR 10 &gt;= 9</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10 &gt; 9 OR 10 &lt;= 9 OR 10 &lt; 9</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
</section>
<section id="localaction">
<h5>⑤localactionモジュール<a class="headerlink" href="#localaction" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">Ansible/Ansible Automation Controllerサーバ上でコマンドを実行します。</div>
<div class="line">localactionモジュールの書式</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>必須/任意</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>localaction</p></td>
<td><p>必須</p></td>
<td><p>実行するコマンドを指定します。</p>
<p>confセクションのtimeoutパラメータでのタイマ監視は適用外です。</p>
<p>コマンドが完了するまで次のステップに進みません。</p>
</td>
</tr>
<tr class="row-odd"><td><p>ignore_errors</p></td>
<td><p>任意</p></td>
<td><p>コマンドの実行結果が異常でも次に進む場合に「yes」を指定します。</p>
<p>「no」の場合は、異常の場合に対話ファイルを異常終了します。</p>
<p>デフォルトは「no」。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">例4-1)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Symphony実行時の各Movementで共有するディレクトリ({{ __symphony_workflowdir__ }})にホスト毎のディレクトリを設けて、hostsファイルを退避します。</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">localaction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mkdir -p 755 {{ __symphony_workflowdir__ }}/{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /etc/hosts</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">stdout_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__symphony_workflowdir__</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}/hosts&#39;</span>
<span class="w">    </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
</section>
</section>
<section id="id39">
<h4>正規表記<a class="headerlink" href="#id39" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">下記のコマンド及びパラメータに記述された文字列は正規表記で評価されます。</div>
</div>
<ul class="simple">
<li><p>expectモジュール</p></li>
<li><p>stateモジュールのpromptパラメータ</p></li>
<li><p>commandモジュールのpromptパラメータ</p></li>
</ul>
<div class="line-block">
<div class="line">正規表記で記述した文字列にメタ文字「(){}.など」を含む場合、メタ文字の前にエスケープ文字「\」を挿入する必要があります。</div>
</div>
<div class="line-block">
<div class="line">正しい例)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">XAMPP Developer Files ¥[Y¥/n¥] exec_list</span><span class="p p-Indicator">:</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">誤った例)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">XAMPP Developer Files [Y/n] exec_list</span><span class="p p-Indicator">:</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">stateモジュールとcommandモジュールは、実行したコマンドの結果（標準出力）の取り出しを行っています。取り出す上での留意事項を以下に記述します。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">実行したコマンドの結果（標準出力）とプロンプトの区切り</div>
<div class="line">実行したコマンドの結果（標準出力）とプロンプトの区切りをpromptパラメータで指定された文字列で行います。実行したコマンドの結果（標準出力）の判定やファイルへの保存を行う場合は、正規表記で .*付の後方一致は記述しないで下さい。実行したコマンドの結果（標準出力）が取り出せません。</div>
<div class="line"><br /></div>
<div class="line">.* 付の後方一致の正規表記の例</div>
<div class="line">'<strong>.*</strong>[\#\$\%] $''</div>
<div class="line"><br /></div>
</div>
</li>
<li><div class="line-block">
<div class="line">エスケープシーケンスの対応</div>
<div class="line">構築対象機器に依存しますが、構築対象機器から送られてくるプロンプトの直前にOperating</div>
<div class="line">System Commandシーケンスが付加されている場合があります。promptパラメータで指定された文字列の直前にあるエスケープシーケンスを排除しています。</div>
</div>
</li>
</ol>
</section>
<section id="id40">
<h4>複数具体値変数使用時の注意事項<a class="headerlink" href="#id40" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話ファイルで複数具体値変数が使用出来るパラメータは、commandモジュールのwith_itemsパラメータのみです。これ以外で使用した場合、作業実行時にエラーとなります。</div>
</div>
</section>
<section id="id41">
<h4>コマンドプロンプト以外のプロンプトを処理する場合の注意事項<a class="headerlink" href="#id41" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">コマンドプロンプト以外のプロンプトを処理する場合、execモジュールとexpectモジュールの組合せで対話ファイルを作成して下さい。commandとstateモジュールでは処理できません。</div>
</div>
<div class="line-block">
<div class="line">例)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ssh-keygenを対話ファイルで処理する。</span>

<span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>


<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># ssh接続　パスワード認証</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;assword:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># ssh-keygenコマンド実行</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh-keygen</span>

<span class="c1"># 以降がコマンドプロンプト以外のプロンプトに対する処理</span>
<span class="c1"># 秘密鍵ファイルのパスを設定</span>
<span class="c1"># expectは正規表記で評価されるので、エスケープが必要なメタ文字にはエスケープ文字(\)を挿入する必要があります。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;id_rsa\):&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_id_rsa_path</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># パスフレーズを設定</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;</span><span class="nv"> </span><span class="s">passphrase\):&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_passphrase</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># パスフレーズを確認</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;</span><span class="nv"> </span><span class="s">passphrase</span><span class="nv"> </span><span class="s">again:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_passphrase</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># 生成された 秘密鍵ファイルを確認</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ls</span><span class="nv"> </span><span class="s">-al</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">VAR_id_rsa_path</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># ssh接続クローズ</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">※ VAR_id_rsa_path　・・・　秘密鍵ファイルのパスを設定します。</div>
<div class="line">※ VAR_passphrase 　・・・　パスフレーズを設定します。</div>
<div class="line"><br /></div>
<div class="line">◎リターンしたい場合</div>
<div class="line">変数使用の場合は具体値を空白(未入力)にします。</div>
<div class="line">変数を使用していない場合は空文字列(コーテーションを2個並べます)を記載します。</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</pre></div>
</div>
</section>
<section id="id42">
<h4>対話ファイル終了時の注意事項<a class="headerlink" href="#id42" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話ファイルの最後に、セッションを終了するコマンドを投入するようにして下さい。</div>
<div class="line">最終行のモジュールが終了するとセッションをクローズします。最終行にファイルコピーなど処理に時間がかかるコマンドが記載されている場合、コマンド終了前にセッションがクローズされコマンドが異常終了してしまう場合があります。</div>
</div>
<div class="line-block">
<div class="line">例)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># ssh接続　パスワード認証</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;assword:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># ファイルコピー</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cp</span><span class="nv"> </span><span class="s">-rfp</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">VAR_src_path</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">VAR_dest_path</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># 直前のコマンド終了をコマンドプロンプトで待ち合わせ、exitコマンドを投入する記載を対話ファイルの最後に挿入</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
</section>
<section id="yaml">
<span id="general-operations-things-to-keep-in-mind-when-writing-dialogue-files-in-yaml-format"></span><h4>対話ファイルをyaml形式で記載する際の注意事項<a class="headerlink" href="#yaml" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話ファイルはyaml形式のファイルとして扱います。以下のようなYAML形式に準じていない記載があると対話モジュールのアップロード時や作業実行時にエラーとなります。</div>
</div>
<ul class="simple">
<li><p>各モジュールのパラメータに変数を記載している場合でパラメータ全体をクォーテーションで囲んでいない場合。</p></li>
<li><p>各パラメータを定数のみで記載している場合で、定数の終端が「<strong>:</strong>」の場合など、パラメータ全体をクォーテーションで囲んでいない場合。</p></li>
</ul>
<div class="line-block">
<div class="line">各モジュールのパラメータは、パラメータ全体をクォーテーションで囲むことを推奨します。</div>
</div>
<div class="line-block">
<div class="line">正しい例）</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;assword:&#39;</span>
<span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w">  </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ls&#39;</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;echo</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">exec_when</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">run&#39;</span>
<span class="w">  </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_echo</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_exec_when</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_failed_when</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">failed_when</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stdout == match({{ item.2 }})</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_command</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_p1</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_p2</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">success_exit</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;yes&#39;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">誤った例）</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span>- expect: assword:
  exec:  {{ __loginpassword__ }}
- expect: {{ __loginuser__ }}@{{ __loginhostname__ }}
  exec: ls
- command: echo {{ item.0 }}
  prompt: {{ __loginuser__ }}@{{ __loginhostname__ }}
  exec_when:
    - {{ item.1 }} == run
  with_items:
    - {{ VAR_echo }}
    - {{ VAR_exec_when }}
    - {{ VAR_failed_when }}
  failed_when:
    - stdout == match({{ item.2 }})
- state: {{ VAR_command }}
  prompt: {{ __loginuser__ }}@{{ __loginhostname__ }}
  parameter:
    - {{ VAR_p1 }}
    - {{ VAR_p2 }}
  success_exit: yes
</pre></div>
</div>
</section>
<section id="lang">
<h4>構築対象機器のログインユーザーのLANGについての注意事項<a class="headerlink" href="#lang" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ログインユーザーの「LANG」は、「UTF-8/euc/shift_jis」の3種類についてサポートしています。</div>
<div class="line">ログインユーザーの「LANG」の設定は機器一覧より行ってください。</div>
<div class="line">「euc/shift_jis」を設定した場合、構築対象機器との通信制御で使用しているpexpectモジュールのUTF-8へのデコード処理の特性で対話ファイルを正しく処理出来ない場合があります。</div>
</div>
<ul class="simple">
<li><p>一部の全角文字( ①②等)をUTF-8にデコード出来ません。デコード出来ない文字は??で表示されます。</p></li>
<li><p>一部の全角文字( － 等)をexpect等のプロンプト待ちで使用した場合、「LANG」がUTF-8では待ち受けが正しく出来ますが、LANGが「euc/shift_jis」では待ち受けがタイムアウトしてしまいます。</p></li>
</ul>
</section>
<section id="id43">
<h4>構築対象機器へ投入するコマンドの終端コードについての注意事項<a class="headerlink" href="#id43" title="この見出しへのパーマリンク">¶</a></h4>
<p>構築対象機器へ投入するコマンドの終端コードは「LF」を送信します。構築対象機器のコマンド終端コードが「CRLF」の場合、対話ファイルで構築対象機器に投入するコマンドの末尾に「r」を追加して下さい。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;XXXXXXXX\r&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_command</span><span class="nv"> </span><span class="s">}}\r&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_state</span><span class="nv"> </span><span class="s">}}\r&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_parameter1</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_parameter2</span><span class="nv"> </span><span class="s">}}&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="general-operations-write-role-package-ansible-legacy-role">
<span id="id44"></span><h3>ロールパッケージ（Ansible-Legacy Role）の記述<a class="headerlink" href="#general-operations-write-role-package-ansible-legacy-role" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">基本書式についてはAnsibleベストプラクティスの公式マニュアルを参照してください。</div>
<div class="line">「 <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理（Ansible-Legacy Roleのみ）</span></a> 」でアップロードするロールパッケージファイルのZipに含めるべきディレクトリと、ITAでの扱いについて記述します。</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(上位ディレクトリ)
│
├─── site.yml                           ・・・・・・・・・・・・・・・・・・・・・・・・ (1)
│
├─── hosts                              ・・・・・・・・・・・・・・・・・・・・・・・・ (2)
│
├─── group_vars                         ・・・・・・・・・・・・・・・・・・・・・・・・ (3)
│
├─── host_vars                          ・・・・・・・・・・・・・・・・・・・・・・・・ (4)
│
├─── ITA readme                         ・・・・・・・・・・・・・・・・・・・・・・・・ (5)
│
├─── 読替表                             ・・・・・・・・・・・・・・・・・・・・・・・・ (6)
│
└─── roles                              ・・・・・・・・・・・・・・・・・・・・・・・・ (7)
        │
        ├─ [role名①]                              ・・・・・・・・・・・・・・・・・・・・・・・・ (8)
        │     │
        │     ├── readme.md                               ・・・・・・・・・・・・・・・・・・・・・・・・ (9)
        │     │
        │     ├── tasks                                   ・・・・・・・・・・・・・・・・・・・・・・・・ (10)
        │     │      ├── main.yml
        │     │      └── user_files
        │     │      └── user.yml
        │     │
        │     ├── handlers                                ・・・・・・・・・・・・・・・・・・・・・・・・ (11)
        │     │      ├── main.yml
        │     │      └── user_files
        │     │      └── user.yml
        │     │
        │     ├── templates                               ・・・・・・・・・・・・・・・・・・・・・・・・ (12)
        │     │      ├── hosts.j2
        │     │      └── user_files
        │     │      └── user.j2
        │     │
        │     ├── files                                   ・・・・・・・・・・・・・・・・・・・・・・・・ (13)
        │     │      └── sudoers
        │     │
        │     ├── vars                                    ・・・・・・・・・・・・・・・・・・・・・・・・ (14)
        │     │      └─ main.yml
        │     │
        │     ├── defaults                                ・・・・・・・・・・・・・・・・・・・・・・・・ (15)
        │     │      ├── main.yml
        │     │      └── user_files
        │     │              └── user.yml
        │     │
        │     ├── meta                                    ・・・・・・・・・・・・・・・・・・・・・・・・ (16)
        │     │      └── main.yml
        │     │
        │     上記以外のディレクトリやファイルが存在する場合、 ITAは関知しません。
        │
        └─ [role名②] ロールの数に特に制限はありません。
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>（1） site.yml</strong></div>
<div class="line">　site.yml(マスターPlaybook)は ITA で作成します。</div>
<div class="line">　存在する場合は上書きします。</div>
<div class="line"><br /></div>
<div class="line"><strong>（2） hosts</strong></div>
<div class="line">　hosts ファイルは ITA で作成します。</div>
<div class="line">　存在する場合は上書きします。</div>
<div class="line"><br /></div>
<div class="line"><strong>（3） group_vars</strong></div>
<div class="line">　ホストグループ変数は扱えません。</div>
<div class="line">　group_vars ディレクトリが存在する場合は削除します。</div>
<div class="line"><br /></div>
<div class="line"><strong>（4） host_vars</strong></div>
<div class="line">　ホスト変数は ITA で作成します。</div>
<div class="line">　host_vars ディレクトリが存在する場合が上書きします。</div>
<div class="line"><br /></div>
<div class="line"><strong>（5） ITA readme</strong></div>
<div class="line">　ホストグループ変数は扱えません。</div>
<div class="line">　group_vars ディレクトリが存在する場合は削除します。</div>
<div class="line">　ITA readme のファイル名の命名規則</div>
<div class="line">　　ita_readme_[ロール名].yml</div>
<div class="line">　例 )</div>
<div class="line">　　ロール名: mysql　　　　　　　ファイル名: ita_readme_mysql.yml</div>
<div class="line">　　ロール名: mysql/install　　　ファイル名: ita_readme_mysql%install.yml</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">roleのディレクトリ階層が深い場合、ロール名に含まれる / を % に置き換える必要があります。</div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><strong>（6） 読替表</strong></div>
<div class="line">　読替表はロール毎に定義します。無くてもエラーにはなりません。</div>
<div class="line">　読替表のファイル名のファイル名の命名規則</div>
<div class="line">　　ita_translation-table_[ロール名].txt</div>
<div class="line">　例 )</div>
<div class="line">　　ロール名: mysql　　　　　　　ファイル名: ita_translation-table_mysql.txt</div>
<div class="line">　　ロール名: mysql/install　　　ファイル名: ita_translation-table_mysql%install.txt</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">roleのディレクトリ階層が深い場合、ロール名に含まれる / を % に置き換える必要があります。</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>（7） roles</strong></div>
<div class="line">　roles ディレクトリが存在しない場合はアップロードでエラーになります。</div>
<div class="line"><br /></div>
<div class="line"><strong>（8）roles/[role 名①]</strong></div>
<div class="line">　role 名ディレクトリが存在しない場合はアップロードでエラーになります。</div>
<div class="line">　tasks ディレクトリを含むディレクトリを role として扱います。</div>
<div class="line">　ディレクトリ階層が深くても問題ありません。</div>
<div class="line"><br /></div>
<div class="line"><strong>（9）roles/[role 名①]/readme.md</strong></div>
<div class="line">　ITA は関知しません。</div>
<div class="line"><br /></div>
<div class="line"><strong>（10）roles/[role 名①]/tasks</strong></div>
<div class="line">　tasks ディレクトリは必須です。</div>
<div class="line">　playbook ファイルは、文字コードが UTF-8 の BOM なで作成して下さい。</div>
<div class="line">　main.yml がない場合はアップロードでエラーになります。</div>
<div class="line">　main.yml 以外のファイルも配置できます</div>
<div class="line">　サブディレクトリに main.yml 以外のファイルを配置できます。</div>
<div class="line"><br /></div>
<div class="line"><strong>（11）roles/[role 名①]/handlers</strong></div>
<div class="line">　handlers ディレクトリの有無は関知しません。</div>
<div class="line">　playbook ファイルは、文字コードが UTF-8 の BOM なしで作成して下さい。</div>
<div class="line">　ディレクトリ階層が深くても問題ありません。</div>
<div class="line"><br /></div>
<div class="line"><strong>（12）roles/[role 名①]/templates</strong></div>
<div class="line">　templates ディレクトリの有無は関知しません。</div>
<div class="line">　サブディレクトリにファイルを配置できます。</div>
<div class="line"><br /></div>
<div class="line"><strong>（13）roles/[role 名①]/files</strong></div>
<div class="line">　files ディレクトリの有無は関知しません。</div>
<div class="line">　ファイル及びサブディレクトリの有無は関知しません。</div>
<div class="line">　ファイル内容は関知しません。</div>
<div class="line"><br /></div>
<div class="line"><strong>（14）roles/[role 名①]/vars</strong></div>
<div class="line">　vars ディレクトリの有無は関知しません。</div>
<div class="line">　playbook ファイルは、文字コードが UTF-8 の BOM なしで作成して下さい。</div>
<div class="line">　ファイル及びサブディレクトリの有無は関知しません。</div>
<div class="line">　ファイル内容は関知しません。</div>
<div class="line"><br /></div>
<div class="line"><strong>（15）roles/[role 名①]/defaults</strong></div>
<div class="line">　defaults ディレクトリの有無は関知しません。</div>
<div class="line">　playbook ファイルは、文字コードが UTF-8 の BOM なしで作成して下さい。</div>
<div class="line">　main.yml の有無は関知しません。</div>
<div class="line">　main.yml 以外のファイルも配置できます。</div>
<div class="line">　サブディレクトリに main.yml 以外のファイルを配置できます。</div>
<div class="line"><br /></div>
<div class="line"><strong>（16）roles/[role 名①]/meta</strong></div>
<div class="line">　meta ディレクトリの有無は関知しません。</div>
<div class="line">　playbook ファイルは、文字コードが UTF-8 の BOM なしで作成して下さい。</div>
<div class="line">　ファイル及びサブディレクトリの有無は関知しません。</div>
<div class="line">　ファイル内容は関知しません。</div>
</div>
<section id="playbook">
<h4>マスターPlaybook<a class="headerlink" href="#playbook" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ITAで作成するマスターPlaybookはへッダーセクションとrolesセクションで構成されます。</div>
</div>
<section id="id45">
<h5>① へッダーセクション<a class="headerlink" href="#id45" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">ヘッダーセクションは、デフォルト値が決まっていますが、「 <a class="reference internal" href="#general-operations-movement-list"><span class="std std-ref">Movement一覧</span></a> 」のヘッダーセクションで変更することが出来ます。</div>
</div>
<div class="line-block">
<div class="line">▼ヘッダーセクションのデフォルト値について</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible Coreの場合</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ヘッダーセクションのデフォルト値</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="nt">remote_user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible Automation Controllerの場合</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ヘッダーセクションのデフォルト値</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
</section>
<section id="roles">
<h5>② rolesセクション<a class="headerlink" href="#roles" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">アップロードさたロールパッケージ内のロールを、「 <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）</span></a> 」のインクルード順序に従いroleで実行します。</div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image_2b_2.png"><img alt="../../../_images/image_2b_2.png" src="../../../_images/image_2b_2.png" style="width: 8.85417in; height: 6.67187in;" /></a>
</figure>
</section>
</section>
<section id="id46">
<h4>変数名の一意管理<a class="headerlink" href="#id46" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ITAの代入値管理で登録された変数の情報はホスト変数として扱います。変数名はドライバー毎の全ロールパッケージで一意管理します。ロールを跨って同じ変数名を使用しているが変数構造が違う場合は、アップロード時にエラーとなります。</div>
<div class="line">例えば、通常変数と多段変数や多段変数同士で多段構造が違う場合など。</div>
</div>
</section>
<section id="defaults-main-yml-ita">
<h4>デフォルト変数定義ファイル(defaults-&gt;main.yml)のITA独自仕様<a class="headerlink" href="#defaults-main-yml-ita" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">デフォルト変数定義ファイルの記述(変数定義)にはITA独自仕様があります。</div>
<div class="line">詳しくは、別資料「利用手順マニュアル_Ansible-driver_別紙_Ansible利用ガイドライン_追加ルール」を参照してください。</div>
</div>
</section>
<section id="ansible-role-directory-structure">
<h4>Ansible Role Directory Structureにおける所定ディクレトリのサブディレクトリについて注意事項<a class="headerlink" href="#ansible-role-directory-structure" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">Ansible Role Directory Structureにおける所定ディクレトリの下位に当該の所定ディクレトリ名と</div>
<div class="line">同名のサブディレクトリ（例えば、filesディレクトリの下位にそれと同名のfilesディレクトリなど）を作成されていると、作業実行時にエラーになります。</div>
</div>
</section>
<section id="id47">
<h4>ロールパッケージ内のロール名をディレクトリ階層にした場合の留意点<a class="headerlink" href="#id47" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">下記のようなディレクトリ階層のロールパッケージを例に説明します。</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>└── roles
├── parent
│     ├── sample_role1
│     │ ├── defaults
│     │ └── tasks
│     └── sample_role2
│            ├── defaults
│            ├── sample_role3
│            │     ├── defaults
│            │     └── tasks
│            ├── sample_role4
│            │     ├── defaults
│            │     └── tasks
│            └── tasks
├── sample_role5
│     └── defaults
└── sample_role6
       ├── defaults
       └── tasks
</pre></div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ロールとして認識するディレクトリは、tasksディレクトリがあるディレクトリになります。</div>
<div class="line">この例だと、ロールして扱うディレクトリ階層(ロール名)は以下の3個になります。</div>
</div>
<ul class="simple">
<li><p>parent/sample_role1</p></li>
<li><p>parent/sample_role2</p></li>
<li><p>sample_role6</p></li>
</ul>
</li>
<li><div class="line-block">
<div class="line">tasksディレクトリが複数あるディレクトリ階層の除外</div>
<div class="line">parent/sample_role2/sample_role3とparent/sample_role2/sample_role4にもtasksディレクトリがありますが、parent/sample_role2にtasksディレクトリがありロールとして認識していますので、ロールとして扱いません。</div>
</div>
</li>
</ol>
</section>
</section>
<section id="itareadme-ansible-legacy-role">
<span id="general-operations-write-ita-readme-ansible-legacy-role-only"></span><h3>ITAreadme（Ansible-Legacy Roleのみ）の記述<a class="headerlink" href="#itareadme-ansible-legacy-role" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">代入値管理機能は、defaults変数定義ファイルに定義した変数の型を解釈して、各変数およびそのメンバー変数などに変数の値を設定します。</div>
<div class="line"><br /></div>
<div class="line">Playbook中に直接変数を定義したくない場合など、defaults変数定義ファイルに変数が定義されていない場合、ITA readmeファイルに変数の定義を設定することで、代入値管理機能で変数の値を指定することができます。</div>
</div>
<section id="ita-readme">
<h4>ITA readmeのファイル名の命名規則<a class="headerlink" href="#ita-readme" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">　ita_readme_[ロール名].yml</div>
<div class="line">　例)</div>
<div class="line">　　 ロール名: mysql ファイル名: ita_readme_mysql.yml</div>
<div class="line">　　 ロール名: mysql/install ファイル名: ita_readme_mysql%install.yml</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">roleのディレクトリ階層が深い場合、ロール名に含まれる / を % に置き換える必要があります。</div>
</div>
</div>
</section>
<section id="id48">
<h4>読替表のフォーマット<a class="headerlink" href="#id48" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">フォーマットはYAML形式となります。</div>
<div class="line">文字コードはUTF-8のBOMなしで作成して下さい。</div>
</div>
<div class="line-block">
<div class="line">ITA readmeファイルと、代入値管理機能の関係を以下の図に示します。</div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image_2b_3.png"><img alt="../../../_images/image_2b_3.png" src="../../../_images/image_2b_3.png" style="width: 8.85417in; height: 6.67187in;" /></a>
</figure>
<div class="line-block">
<div class="line">Playbook中に無い変数をITA readmeファイルで定義した場合、定義した変数を代入値管理機能で値を設定することができます。</div>
<div class="line">また、Playbook中の変数と異なる型をITA readmファイルで定義した場合、代入値管理機能には、上書きした変数の型で値を登録することができます。</div>
<div class="line"><br /></div>
<div class="line">代入値管理機能で設定した値は、各ホスト用に変数定義ファイル(host_vars)に出力され、Ansibleで元のPlaybookと変数定義用ファイルを入力として各ホストに実行されます。</div>
<div class="line"><br /></div>
<div class="line">ITA readme ファイルは代入値管理機能に変数情報を与えるためだけに使用され、ITA readme に定義した変数および、変数の値はAnsible実行には影響を与えません。</div>
<div class="line"><br /></div>
<div class="line">ITA readmeの作成は任意です。ITA readmeとdefaults変数定義ファイルで変数定義が重なった場合など、以下のルールで処理されます。</div>
<div class="line"><br /></div>
</div>
<table class="docutils align-left" id="id156">
<caption><span class="caption-text"><strong>変数採用ルール</strong></span><a class="headerlink" href="#id156" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">defaults変数</div>
<div class="line">定義ファイル</div>
</div>
</th>
<th class="head"><p>ITA readme</p></th>
<th class="head"><p>変数定義の採用先</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>定義あり</p></td>
<td><p>定義なし</p></td>
<td><p>デフォルト変数定義ファイル</p></td>
</tr>
<tr class="row-odd"><td><p>定義なし</p></td>
<td><p>定義あり</p></td>
<td><p>ITA readme</p></td>
</tr>
<tr class="row-even"><td><p>定義あり</p></td>
<td><p>定義あり</p></td>
<td><p>ITA readme</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">また、「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」に表示するデフォルト値は以下のルールで処理されます。</div>
</div>
<table class="docutils align-left" id="id157">
<caption><span class="caption-text"><strong>デフォルト値表示ルール</strong></span><a class="headerlink" href="#id157" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><div class="line-block">
<div class="line">defaults変数</div>
<div class="line">定義ファイル</div>
</div>
</th>
<th class="head"><p>ITA readme</p></th>
<th class="head"><p>変数定義の採用先</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>あり</p></td>
<td><p>なし</p></td>
<td><p>デフォルト変数定義ファイルを採用。</p></td>
</tr>
<tr class="row-odd"><td><p>なし</p></td>
<td><p>あり</p></td>
<td><p>デフォルト値なしの扱いとなる。</p></td>
</tr>
<tr class="row-even"><td><p>あり</p></td>
<td><p>あり</p></td>
<td><p>デフォルト変数定義ファイルを採用。
ただし、変数定義が一致している場合のみ。変数定義が一致していない場合はデフォルト値なしの扱いとなる。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">ITA readmeは、作業実行時はロールパッケージから切り離されます。</div>
<div class="line">ITA readmeに記載した変数と具体値は適用されません。</div>
</div>
</section>
</section>
<section id="general-operations-write-translation-table-ansible-legacy-role-only">
<span id="id49"></span><h3>読替表（Ansible-Legacy Roleのみ）の記述<a class="headerlink" href="#general-operations-write-translation-table-ansible-legacy-role-only" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">defaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」以外の変数に対して、「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」機能で変数の具体値を設定出来るようにするための設定を行うファイルです。</div>
<div class="line">defaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」以外の変数「任意変数」に対して代入値管理機能で扱う変数「読替変数」の紐付を定義します。</div>
</div>
<section id="id50">
<h4>読替表のファイル名は以下の命名規則<a class="headerlink" href="#id50" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">　ita_translation-table_[ロール名].txt</div>
<div class="line">　例)</div>
<div class="line">　　 ロール名: mysql ファイル名: ita_translation-table_mysql.txt</div>
<div class="line">　　 ロール名: mysql/install ファイル名: ita_translation-table_mysql%install.txt</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">roleのディレクトリ階層が深い場合、ロール名に含まれる / を % に置き換える必要があります。</div>
</div>
</div>
</section>
<section id="id51">
<h4>読替表のフォーマット<a class="headerlink" href="#id51" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">テキスト形式で下記フォーマットとなります。</div>
<div class="line">文字コードはUTF-8のBOMなしで作成して下さい。</div>
<div class="line">ロール内で読替変数と任意変数の組合せは一意である必要があります。</div>
<div class="line">　　読替変数($s*):($s+)任意変数</div>
</div>
<div class="line-block">
<div class="line">　　　　読替変数:LCA_***</div>
<div class="line">　　　　　　　***：半角英数字とｱﾝﾀﾞｽｺｱ（ _ ）が利用可能です。(最小値:1 ﾊﾞｲﾄ、最大値:256 ﾊﾞｲﾄ)</div>
<div class="line">　　　　任意変数::(最小値:1 ﾊﾞｲﾄ、最大値:256 ﾊﾞｲﾄ)</div>
<div class="line">　　　　($s*):半角スペース 0 個以上</div>
<div class="line">　　　　($s+):半角スペース 1 個以上</div>
<div class="line"><br /></div>
<div class="line">　　例)</div>
<div class="line">　　　LCA_var1: var1</div>
<div class="line">　　　# #から始まる行はコメント行</div>
<div class="line">　　　LCA_var2: var</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image65.png"><img alt="../../../_images/image65.png" class="align-center" src="../../../_images/image65.png" style="width: 6.22054in; height: 1.90683in;" /></a>
</section>
<section id="id52">
<h4>注意事項<a class="headerlink" href="#id52" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">読替表を作成する際の注意事項を列挙します。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>ケース</strong></p></th>
<th class="head"><p>ITA<strong>の動作</strong></p></th>
<th class="head"><p><strong>備考</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>読替表はあるが、defaults変数定義ファイルとITAreadmeがない。(ロール毎)</p></td>
<td><p>読替表を読込まない。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>任意変数にVAR_で始まる変数が定義されている。</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>defaults変数定義ファイルとITAreadmeに定義されていない任意変数を使用している。</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>ロール内で読替変数が重複定義されている</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td><p>パッケージA-&gt;ロールA</p>
<p>LCA_A:user_A/LCA_A:user_B</p>
</td>
</tr>
<tr class="row-even"><td><p>ロール内で任意変数が重複定義されている</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td><p>パッケージA-&gt;ロールB</p>
<p>LCA_A:user_A/LCA_B:user_A</p>
</td>
</tr>
<tr class="row-odd"><td><p>ロール間で任意変数の構造に差異がある。</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td><p>パッケージA-&gt;ロー
ルA/B</p>
<p>LCA_C:user_C</p>
</td>
</tr>
<tr class="row-even"><td><p>ロールパッケージ内で置換変数と任意変数の組合せが一意でない。</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td><p>パッケージA</p>
<p>ロールA  LCA_D: user_D</p>
<p>ロールB  LCA_D: user_E</p>
</td>
</tr>
<tr class="row-odd"><td><p>ロールパッケージ間で任意変数の構造に差異がある。</p></td>
<td><p>ロールパッケージアップロード時にエラーなりませんが、読替変数が代入値管理に表示されません。</p></td>
<td><p>パッケージA-&gt;ロールA</p>
<p>LCA_F: user_F</p>
<p>パッケージB-&gt;ロールA</p>
<p>LCA_F: user_F</p>
</td>
</tr>
<tr class="row-even"><td><p>ロールパッケージ間で多段の任意変数を定義している</p></td>
<td><p>多段の構造が一致しているのでエラーにはなりませんが、多段繰返回数の設定は各パッケージで共通の設定となります。</p></td>
<td><p>パッケージA-&gt;ロールB</p>
<p>LCA_H: user_H</p>
<p>パッケージB-&gt;ロールA</p>
<p>LCA_H: user_H</p>
</td>
</tr>
</tbody>
</table>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image66.png"><img alt="../../../_images/image66.png" src="../../../_images/image66.png" style="width: 4.85417in; height: 3.67187in;" /></a>
</figure>
</section>
</section>
<section id="ita-readme-ansible-legacy-role">
<h3>「ita_readme」と「読替表」の活用例（Ansible-Legacy Roleのみ）<a class="headerlink" href="#ita-readme-ansible-legacy-role" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible-Legacy Roleにおける「ita_readme」と「読替表」の活用例について、観点1～9を列挙します。</div>
<div class="line"><br /></div>
<div class="line">前提として、Ansible-Legacy Role（「roles」ディレクトリ）は外部から取得したものとします。</div>
<div class="line">以下は、「ita_readme」と「読替表」を用いてアップロードから結果確認までを表した全体イメージ図です。</div>
</div>
<figure class="align-center" id="id158">
<a class="reference internal image-reference" href="../../../_images/image67.png"><img alt="全体イメージ図" src="../../../_images/image67.png" style="width: 6.49606in; height: 4.84121in;" /></a>
<figcaption>
<p><span class="caption-text">全体イメージ図</span><a class="headerlink" href="#id158" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line">以降、上記の図をベースに観点1～9について掘り下げていきます。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>NO.</strong></p></th>
<th class="head"><p><strong>観点</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>外部から取得したAnsible-Legacy Roleを編集せず利用する</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>「ita_readme」と「読替表」の役割</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>「defaults/main.yml」に記載の変数定義およびデフォルト値について</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p>「host_varsファイル」と「ITAのCMDB」について</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p>「defaults/main.yml」に追記したい場合の救済処置</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="6">
<li></li>
</ol>
</td>
<td><p>変数名の先頭“VAR_”の有無について</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="7">
<li></li>
</ol>
</td>
<td><p>「ita_readme」と「読替表」の連携活用</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="8">
<li></li>
</ol>
</td>
<td><p>playbookにおけるlength評価への応用</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="9">
<li></li>
</ol>
</td>
<td><p>playbookにおけるdefined評価への応用</p></td>
</tr>
</tbody>
</table>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点１：外部から取得したAnsible-Legacy Roleを編集せず利用する</strong></div>
<div class="line">外部(Galaxy等)から取得したAnsible-Legacy Role（「roles」ディレクトリ）は編集を加えずに利用いただくことが可能です。</div>
<div class="line">そのため「ita_readme」や「読替表」を「roles」ディレクトリの外に置いて、Ansible-Legacy Role（「roles」ディレクトリ）内で使われている変数にパラメータを与えることが可能となっております。</div>
</div>
</li>
</ul>
<figure class="align-center" id="id159">
<a class="reference internal image-reference" href="../../../_images/image68.png"><img alt="観点１のイメージ図" src="../../../_images/image68.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点１のイメージ図</span><a class="headerlink" href="#id159" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点２：「ita_readme」と「読替表」の役割について</strong></div>
<div class="line">「ita_readme」、「読替表」は変数名および変数の型をITAに伝えるための機能です。</div>
<div class="line">言い換えれば、「ita_readme」および「読替表」は変数の具体値（パラメータ）を定義するための機能ではありません（具体値を記載してもITAで認識しません）。</div>
<div class="line"><br /></div>
<div class="line">具体値を与える方法を以降の観点で説明します。</div>
</div>
</li>
</ul>
<figure class="align-center" id="id160">
<a class="reference internal image-reference" href="../../../_images/image69.png"><img alt="観点２のイメージ図" src="../../../_images/image69.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点２のイメージ図</span><a class="headerlink" href="#id160" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点３：「defaults/main.yml」に記載の変数定義およびデフォルト値について</strong></div>
<div class="line">「roles」配下の「defaults/main.yml」はそのまま変更なくansibleに渡されます。</div>
<div class="line">変数定義およびデフォルト値はhost_varsで定義されない限り有効となります。(例：『VAR_A：aaa』)</div>
</div>
</li>
</ul>
<figure class="align-center" id="id161">
<a class="reference internal image-reference" href="../../../_images/image70.png"><img alt="観点３のイメージ図" src="../../../_images/image70.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点３のイメージ図</span><a class="headerlink" href="#id161" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点４：「host_varsファイル」と「ITAのCMDB」について</strong></div>
<div class="line">host_varsファイルはITAのCMDB（パラメータシート）から実行ごとに自動作成されます。</div>
</div>
</li>
</ul>
<figure class="align-center" id="id162">
<a class="reference internal image-reference" href="../../../_images/image71.png"><img alt="観点４のイメージ図" src="../../../_images/image71.png" style="width: 6.49606in; height: 4.84121in;" /></a>
<figcaption>
<p><span class="caption-text">観点４のイメージ図</span><a class="headerlink" href="#id162" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点５：「defaults/main.yml」に追記したい場合の救済処置</strong></div>
<div class="line">Ansible-Legacy Role（「roles」ディレクトリ）に変更を加えたい場合、救済処置として「ita_readme」に変数名および型を記述することが可能です。</div>
<div class="line"><br /></div>
<div class="line">既に「defaults/main.yml」に記載がある変数を、改めて「ita_readme」に定義する必要はありません。</div>
<div class="line">もし二つのファイルで同じ変数が定義されている場合は、「ita_readme」側が優位になります。</div>
<div class="line"><br /></div>
<div class="line">※下図のとおり、変数「VAR_H」を「ita_readme」に記述することで変数の追加が可能</div>
</div>
</li>
</ul>
<figure class="align-center" id="id163">
<a class="reference internal image-reference" href="../../../_images/image72.png"><img alt="観点５のイメージ図" src="../../../_images/image72.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点５のイメージ図</span><a class="headerlink" href="#id163" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点６：変数名の先頭“VAR_”の有無について</strong></div>
<div class="line">「defaults/main.yml」の変数のうち、ITAは“VAR_”という接頭文字から始まるものを変数マスタに管理します。</div>
<div class="line">「defaults/main.yml」の変数のうち、“VAR_”という接頭文字から始まっていないものをITAにて変数管理させる場合は「読替表」を活用します。</div>
<div class="line">「読替表」では“VAR_”という接頭文字から始まっていない変数を“LCA_”という接頭文字から始まる変数名と紐づけることでITAにて変数管理させることが可能となります。</div>
<div class="line"><br /></div>
<div class="line">なお、本機能の応用例として、「defaults/main.yml」の変数（“VAR_”という接頭文字から始まっていない）にITAからパラメータを与えずに実行したい場合は、あえて「読替表」での変数紐づけを避けることも可能です。</div>
<div class="line"><br /></div>
<div class="line">※以下、図の変数名「hoge3」のパターン</div>
<div class="line">※「読替表」には“LCA_”から始まる変数定義のみ有効</div>
</div>
</li>
</ul>
<figure class="align-center" id="id164">
<a class="reference internal image-reference" href="../../../_images/image73.png"><img alt="観点６のイメージ図" src="../../../_images/image73.png" style="width: 6.49606in; height: 4.84121in;" /></a>
<figcaption>
<p><span class="caption-text">観点６のイメージ図</span><a class="headerlink" href="#id164" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点７：「ita_readme」と「読替表」の連携活用</strong></div>
<div class="line">「tasks/main.yml」（playbook本体）において“VAR_”から始まっていない変数が使われており、また、その変数が「default/main.yml」に定義されていない場合、「ita_readme」と「読替表」を連携活用することで、ITAからパラメータを与えることが可能です。</div>
<div class="line">例えば、下図の様に「roles」配下の「tasks/main.yml」に変数「hoge」が使われている場合、以下の手順によってITAに変数を伝えることが可能です。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">「ita_readme」に、変数名「hoge」を追記する</div>
</div>
</li>
<li><div class="line-block">
<div class="line">「読替表」に、変数名「hoge」をITAのCMDB（パラメータシート）で「LCA_xxx」という変数名で扱うことを追記する</div>
</div>
</li>
</ol>
</li>
</ul>
<figure class="align-center" id="id165">
<a class="reference internal image-reference" href="../../../_images/image74.png"><img alt="観点７のイメージ図" src="../../../_images/image74.png" style="width: 6.49606in; height: 4.23387in;" /></a>
<figcaption>
<p><span class="caption-text">観点７のイメージ図</span><a class="headerlink" href="#id165" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点８：playbookにおけるlength評価への応用</strong></div>
<div class="line">変数に対し具体値があるか否かによって、length評価における条件分岐に活用することが可能です。</div>
<div class="line">例えば、「defaults/main.yml」に『VAR_C:[]』がある状態で、変数「VAR_C」に具体値を与えずに実行した場合length＝0となります。</div>
<div class="line">反対に、何らかの具体値を与えて実行した場合length＞0となります。（例：『VAR_X:sss』）</div>
</div>
</li>
</ul>
<figure class="align-center" id="id166">
<a class="reference internal image-reference" href="../../../_images/image75.png"><img alt="観点８のイメージ図" src="../../../_images/image75.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点８のイメージ図</span><a class="headerlink" href="#id166" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点９：playbookにおけるdefined評価への応用</strong></div>
<div class="line">変数に対し具体値を定義しているか否かによって、defined評価による条件分岐に活用することが可能です。</div>
<div class="line">例えば、「defaults/main.yml」で定義のない変数「VAR_G」と「VAR_H」を、「ita_readme」で定義を記述します。「ita_readme」に記述することで、ITAのCMDB（パラメータシート）で取り扱うことが可能となります。</div>
<div class="line"><br /></div>
<div class="line">変数「VAR_G」に具体値を付与せず実行すると、「defaults/main.yml」および「host_vars」に定義されずに動作するためdefined→falseとなります。</div>
<div class="line">反対に、変数「VAR_H」に具体値「kkk」を付与し実行すると、「host_vars」に定義されて動作するためdefined→trueとなります。</div>
</div>
</li>
</ul>
<figure class="align-center" id="id167">
<a class="reference internal image-reference" href="../../../_images/image76.png"><img alt="観点９のイメージ図" src="../../../_images/image76.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点９のイメージ図</span><a class="headerlink" href="#id167" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</section>
<section id="backyard">
<h3>BackYardコンテンツ<a class="headerlink" href="#backyard" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id53">
<h4>変数自動登録<a class="headerlink" href="#id53" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">変数解析対象の資材をアップロードした場合、アップロードされた資材から変数を取出します。</div>
</div>
<table class="docutils align-left" id="id168">
<caption><span class="caption-text">モード別アップロードした資材の変数の扱い</span><a class="headerlink" href="#id168" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>メニュー</p></th>
<th class="head"><p>Legacy</p></th>
<th class="head"><p>Legacy Role</p></th>
<th class="head"><p>Pioneer</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Playbook素材集</p></td>
<td><p>○</p></td>
<td><p>×</p></td>
<td><p>×</p></td>
</tr>
<tr class="row-odd"><td><p>ロールパッケージ管理</p></td>
<td><p>×</p></td>
<td><p>○</p></td>
<td><p>×</p></td>
</tr>
<tr class="row-even"><td><p>対話ファイル素材集</p></td>
<td><p>×</p></td>
<td><p>×</p></td>
<td><p>○</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">なお、取出すタイミングは 自動プロセスの起動周期 に依存します。</div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※変数名の一意管理</div>
<div class="line">取出した変数名は、モード毎に全資材で一意管理されます。</div>
<div class="line">デフォルト変数定義ファイルで変数構造を定義しますので、各資材で変数構造が違う場合の留意事項を以下に明記します。</div>
<div class="line"><br /></div>
<div class="line">●単一ロールパッケージ</div>
<div class="line">ロールを跨って同じ変数名を使用しているが変数構造が違う場合。</div>
<div class="line">※通常変数と多段変数や多段変数同士で多段構造が違う場合など</div>
<div class="line">⇒ アップロード時にエラーとなります。</div>
<div class="line"><br /></div>
<div class="line">●全ロールパッケージ</div>
<div class="line">ロールパッケージを跨って同じ変数名を使用しているが変数構造が違う場合。</div>
<div class="line">⇒ アップロード時にエラーとなります。</div>
</div>
</div>
</section>
<section id="general-operations-substitution-value-auto-registration-setting2">
<span id="id54"></span><h4>代入自動値登録設定<a class="headerlink" href="#general-operations-substitution-value-auto-registration-setting2" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">連携対象としたパラメータシートのオペレーションとホスト毎の項目の設定値と紐付けたMovementと変数の情報を代入値管理と作業対象ホストに反映されます。</div>
<div class="line">なお、反映のタイミングは前述と同様に 自動プロセスの起動周期に依存します。</div>
<div class="line">作業対象ホストと代入値管理は複数の操作者が更新を行います。最終更新者が他操作者の場合は反映処理をしません。</div>
<div class="line">代入値自動登録設定のデータを反映したい場合は、代入値管理で該当レコードを廃止にする。他</div>
<div class="line">BackYard処理で該当レコードの更新を無効にする。などの操作を行ってください。</div>
</div>
<div class="line-block">
<div class="line">作業対象ホストと代入値管理への反映ルールを以下に明記します。</div>
</div>
<section id="id55">
<h5>① 代入値自動登録に登録されている情報を代入値管理へ反映時<a class="headerlink" href="#id55" title="この見出しへのパーマリンク">¶</a></h5>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head" rowspan="4"><p><strong>代入値管理の状態</strong></p></th>
<th class="head" rowspan="4"><p><strong>該当レコードなし</strong></p></th>
<th class="head" colspan="3"><p><strong>該当レコードあり</strong></p></th>
<th class="head" rowspan="4"><p><strong>該当レコード廃止中</strong></p></th>
</tr>
<tr class="row-even"><th class="head" rowspan="3"><p><strong>=具体値</strong></p></th>
<th class="head" colspan="2"><p><strong>≠具体値</strong></p></th>
</tr>
<tr class="row-odd"><th class="head" colspan="2"><p><strong>最終更新者</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>BackYard処理</strong></p></th>
<th class="head"><p><strong>他操作者</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p><strong>代入値管理への反映</strong></p></td>
<td><p><strong>新規レコード追加</strong></p></td>
<td><p>ー</p></td>
<td><p>該当レコードの具体値更新</p></td>
<td><p>ー</p></td>
<td><p>廃止レコード復活</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※該当レコード：オペレーション＋ホスト＋Movement+変数名+(メンバー変数)+(代入順序)が同一のレコードの意</div>
</div>
</section>
<section id="id56">
<h5>② 代入値自動登録に登録されていない情報（代入値管理のみに登録）を代入値管理へ反映時<a class="headerlink" href="#id56" title="この見出しへのパーマリンク">¶</a></h5>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head" rowspan="3"><p><strong>代入値管理の状態</strong></p></th>
<th class="head" colspan="2"><p><strong>該当レコードあり</strong></p></th>
</tr>
<tr class="row-even"><th class="head" colspan="2"><p><strong>最終更新者</strong></p></th>
</tr>
<tr class="row-odd"><th class="head"><p><strong>BackYard処理</strong></p></th>
<th class="head"><p><strong>他操作者</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>代入値管理への反映</strong></p></td>
<td><p>該当レコード廃止</p></td>
<td><p>ー</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id57">
<h5>③ 代入値自動登録に登録されている情報を作業対象ホストへの反映時<a class="headerlink" href="#id57" title="この見出しへのパーマリンク">¶</a></h5>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>作業対象ホストの状態</strong></p></th>
<th class="head"><p><strong>該当レコードなし</strong></p></th>
<th class="head"><p><strong>該当レコードあり</strong></p></th>
<th class="head"><p><strong>該当レコード廃止中</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>作業対象ホストへの反映</strong></p></td>
<td><p>新規レコード追加</p></td>
<td><p>－</p></td>
<td><p>廃止レコード復活</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※ 該当レコード：オペレーション＋ホスト＋Movementが同一のレコードの意</div>
</div>
</section>
<section id="id58">
<h5>④ 代入値自動登録に登録されていない情報（作業対象ホストのみに登録）を作業対象ホストへ反映時<a class="headerlink" href="#id58" title="この見出しへのパーマリンク">¶</a></h5>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head" rowspan="3"><p><strong>代入値管理の状態</strong></p></th>
<th class="head" colspan="2"><p><strong>該当レコードあり</strong></p></th>
</tr>
<tr class="row-even"><th class="head" colspan="2"><p><strong>最終更新者</strong></p></th>
</tr>
<tr class="row-odd"><th class="head"><p><strong>BackYard処理</strong></p></th>
<th class="head"><p><strong>他操作者</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>代入値管理への反映</strong></p></td>
<td><p>該当レコード廃止</p></td>
<td><p>ー</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id59">
<h5>⑤ 同一Movementと変数と代入順序に、複数項目の紐付が登録されている場合<a class="headerlink" href="#id59" title="この見出しへのパーマリンク">¶</a></h5>
<p>複数のパラメータシートで同一のオペレーションとホストが紐付されている場合は、ランダムに1項目を選択し代入値管理へ反映を行います。</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image_2b_5.png"><img alt="../../../_images/image_2b_5.png" src="../../../_images/image_2b_5.png" style="width: 6.49606in; height: 4.23387in;" /></a>
</figure>
</section>
</section>
</section>
<section id="ansibleita">
<h3>Ansible利用ガイドラインITA追加ルール<a class="headerlink" href="#ansibleita" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">ITAを使用して、Ansibleで実行する為のPlaybook作成ガイドラインを記述します。</div>
<div class="line">詳しくは、別資料「利用手順マニュアル_Ansible-driver_別紙_Ansible利用ガイドライン_追加ルール」を参照してください。</div>
</div>
</section>
</section>
<section id="id60">
<h2><span class="section-number">8.8. </span>運用操作<a class="headerlink" href="#id60" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本機能を活用する操作は、クライアントPCのブラウザ画面からのユーザー利用による入力だけでなく、システム運用・保守による操作もあります。用意している運用・保守の操作は次のとおりです。</div>
</div>
<section id="id61">
<h3>メンテナンス<a class="headerlink" href="#id61" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible-driverのプロセスの開始/停止/再起動に必要なファイルは以下となります。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>対象ファイル名</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Legacy/pioneer/legacyRole実行監視</p>
<p>未実行作業の実行を行う。</p>
</td>
<td><p>ky_ansible_execute-workflow.service</p></td>
</tr>
<tr class="row-odd"><td><p>legacy変数自動登録</p>
<p>アップロードした資材から変数の取出しを行う。</p>
</td>
<td><p>ky_legacy_varsautolistup-workflow.service</p></td>
</tr>
<tr class="row-even"><td><p>legacy自動登録設定</p>
<p>自動登録設定に設定された情報を代入値
管理と作業対象メニューに反映を行う。</p>
</td>
<td><p>ky_legacy_valautostup-workflow.service</p></td>
</tr>
<tr class="row-odd"><td><p>pioneer自動登録設定</p>
<p>自動登録設定に設定された情報を代入値
管理と作業対象メニューに反映を行う。</p>
</td>
<td><p>ky_
pioneer
_valautostup-workflow.service</p></td>
</tr>
<tr class="row-even"><td><p>legacyRole変数自動登録</p>
<p>アップロードした資材から変数の取出しを行う。</p>
</td>
<td><p>ky_legacy_role_varsautolistup-workflow.service</p></td>
</tr>
<tr class="row-odd"><td><p>legacyRole自動登録設定</p>
<p>自動登録設定に設定された情報を代入値
管理と作業対象メニューに反映を行う。</p>
</td>
<td><p>ky_legacy_role_valautostup-workflow.service</p></td>
</tr>
<tr class="row-even"><td><p>Ansible AutomationControllerデータ同期</p>
<p>Ansible AutomationControllerから各種設定情報の取得を行う。</p>
</td>
<td><p>ky_ansible_towermasterSync-workflow.service</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">対象ファイルは「/usr/lib/systemd/system」に格納されています。</div>
<div class="line">プロセス起動/停止/再起動の方法は次の通りです。</div>
<div class="line">root権限でコマンドを実行してください。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">プロセス起動</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl start ky_ansible_execute-workflow.service
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">プロセス停止</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl stop ky_ansible_execute-workflow.service
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">プロセス再起動</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl restart ky_ansible_execute-workflow.service
</pre></div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">各対象ファイル名に置き換えて起動/停止/再起動を行ってください。</div>
</div>
</section>
<section id="general-operations-about-the-maintenance-method">
<span id="id62"></span><h3>メンテナンス方法について<a class="headerlink" href="#general-operations-about-the-maintenance-method" title="この見出しへのパーマリンク">¶</a></h3>
<ol class="arabic">
<li><div class="line-block">
<div class="line">NORMALレベルへの変更</div>
<div class="line">以下のファイルの8行目「DEBUG」を「NORMAL」に書き換えます。</div>
<div class="line">ログレベル設定ファイル： &lt;インストールディレクトリ&gt;/ita-root/confs/backyardconfs/ita_env</div>
</div>
</li>
<li><div class="line-block">
<div class="line">DEBUGレベルへの変更</div>
<div class="line">以下のファイルの8行目「NORMAL」を「DEBUG」に書き換えます。</div>
<div class="line">ログレベル設定ファイル： &lt;インストールディレクトリ&gt;/ita-root/confs/backyardconfs/ita_env</div>
</div>
</li>
<li><div class="line-block">
<div class="line">起動周期の変更</div>
<div class="line">各対象ファイルのExecStartの5番目のパラメータを変更します。（単位:秒）</div>
<div class="line">例外を除き起動周期はデフォルト値の使用をしてください。</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ExecStart=/exastro/ita-root/backyards/common/ky_loopcall-php-procedure.sh /usr/local/bin/php /usr/local/bin/php /exastro/ita-root/backyards/ansible_driver/ky_pioneer_varsautolistup-workflow.php /exastro/ita-root/logs/backyardlogs 10 NORMAL &gt; /dev/null 2&gt;&amp;1
</pre></div>
</div>
<div class="line-block">
<div class="line">書き換え後、<strong>プロセス再起動(restart)後に有効になります。</strong></div>
<div class="line">ログファイルの出力先： <em>&lt;インストールディレクトリ&gt;/ita-root/logs/backyardlogs</em></div>
</div>
</li>
</ol>
</section>
</section>
<section id="id63">
<h2><span class="section-number">8.9. </span>付録<a class="headerlink" href="#id63" title="この見出しへのパーマリンク">¶</a></h2>
<section id="general-operations-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu">
<span id="id64"></span><h3>Ansible実行時に使用される投入データとITAメニューの紐づけ<a class="headerlink" href="#general-operations-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">各ITAメニューより情報を抜出してAnsible実行に必要な投入データを作ります。この際、機器一覧のパスワードや代入値管理でSensitive設定をONした変数の具体値がansible-vaultで暗号化されています。</div>
<div class="line">投入データはZIP形式で「 <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」よりダウンロードが可能です。</div>
<div class="line">ダウンロードした投入データを所定のディレクトリに解凍することで、Ansibleを直接実行することも可能です。</div>
<div class="line"><br /></div>
<div class="line">各種データとITAメニューの関係性は以下の通りです。</div>
</div>
<section id="id65">
<h4>Ansible-Legacy投入データ<a class="headerlink" href="#id65" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id169">
<caption><span class="caption-text">Ansible-Legacy投入データ</span><a class="headerlink" href="#id169" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>メニューグループ</p></th>
<th class="head"><p>メニュー</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>ディレクトリ解凍時のパス</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ansible-Legacy</p></td>
<td><p>Playbook素材集</p></td>
<td><p>プレイブック素材</p></td>
<td><p>/child_playbooks</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible 共通</p></td>
<td><p>テンプレート管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/template_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/copy_files</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Legacy</p></td>
<td><p>代入値管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/upload_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>グローバル変数管理</p></td>
<td><p>変数名/具体値</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Legacy</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(文字列)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Legacy</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(ファイル)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Legacy</p></td>
<td><p>template 管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Legacy</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル変数名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Legacy</p></td>
<td><p>インターフェース情報</p></td>
<td><p>データリレイストレージパス(ITA)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Legacy</p></td>
<td><p>インターフェース情報</p></td>
<td><p>Symphony インスタンスデータリレイストレージパス(ANS)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Legacy</p></td>
<td><p>インターフェース情報</p></td>
<td><p>Conductor インスタンスデータリレイストレージパス(ANS)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>プロトコル</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインパスワード</p>
<p>※ansible-vault で暗号化</p>
</td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ssh 認証鍵ファイル</p></td>
<td><p>/ssh_key_files</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>サーバ証明書</p></td>
<td><p>/winrm_ca_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>インターフェース情報</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Legacy</p></td>
<td><p>Movement 一覧</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインパスワード</p>
<p>※ansible-vault で暗号化</p>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>IP アドレス</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>インベントリファイル追加オプション</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>WinRM 接続情報</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>接続オプション</p>
<p>※ansible_ssh_extra_args の値</p>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Legacy</p></td>
<td><p>Playbook 素材集</p></td>
<td><p>プレイブック素材</p></td>
<td><p>/playbook.yml</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Legacy</p></td>
<td><p>Movement-Playbook紐付</p>
<p>（Movement-対話種別紐付、Movement-ロール紐付）</p>
</td>
<td><p>インクルード順序</p></td>
<td><p>/playbook.yml</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id66">
<h4>Ansible-Pioneer投入データ<a class="headerlink" href="#id66" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id170">
<caption><span class="caption-text">Ansible-Pioneer投入データ</span><a class="headerlink" href="#id170" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>メニューグループ</p></th>
<th class="head"><p>メニュー</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>ディレクトリ解凍時のパス</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ansible-Legacy</p></td>
<td><p>Playbook素材集</p></td>
<td><p>プレイブック素材</p></td>
<td><p>/child_playbooks</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible 共通</p></td>
<td><p>テンプレート管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/template_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/copy_files</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible- Pioneer</p></td>
<td><p>代入値管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/upload_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>グローバル変数管理</p></td>
<td><p>変数名/具体値</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(文字列)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(ファイル)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>template 管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル変数名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>インターフェース情報</p></td>
<td><p>データリレイストレージパス(ITA)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><p>インターフェース情報</p></td>
<td><p>Symphony インスタンスデータリレイストレージパス(ANS)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>インターフェース情報</p></td>
<td><p>Conductor インスタンスデータリレイストレージパス(ANS)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>プロトコル</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインパスワード</p>
<p>※base64、rot13の順でエンコードした値</p>
</td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>Pioneer 利用情報</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>Movement 一覧</p></td>
<td><p>並列実行数</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ssh 認証鍵ファイル</p></td>
<td><p>/ssh_key_files</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible 共通</p></td>
<td><p>インターフェース情報</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><p>Movement 一覧</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインパスワード</p>
<p>※base64、rot13の順でエンコードした値</p>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>IP アドレス</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>インベントリファイル追加オプション</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>Pioneer 利用情報</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>接続オプション</p>
<p>※ansible_ssh_extra_args の値</p>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><p>対話ファイル素材集</p></td>
<td><p>対話ファイル素材</p></td>
<td><p>/playbook.yml</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>Movement-Playbook紐付</p>
<p>（Movement-対話種別紐付、Movement-ロール紐付）</p>
</td>
<td><p>インクルード順序</p></td>
<td><p>/playbook.yml</p></td>
</tr>
</tbody>
</table>
</section>
<section id="ansible-legacyrole">
<h4>Ansible-LegacyRole投入データ<a class="headerlink" href="#ansible-legacyrole" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id171">
<caption><span class="caption-text">Ansible-LegacyRole投入データ</span><a class="headerlink" href="#id171" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>メニューグループ</p></th>
<th class="head"><p>メニュー</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>ディレクトリ解凍時のパス</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>Playbook素材集</p></td>
<td><p>プレイブック素材</p></td>
<td><p>/child_playbooks</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible 共通</p></td>
<td><p>テンプレート管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/template_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/copy_files</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>代入値管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/upload_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>グローバル変数管理</p></td>
<td><p>変数名/具体値</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(文字列)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(ファイル)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>template 管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル変数名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>インターフェース情報</p></td>
<td><p>データリレイストレージパス(ITA)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>インターフェース情報</p></td>
<td><p>Symphony インスタンスデータリレイストレージパス(ANS)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>インターフェース情報</p></td>
<td><p>Conductor インスタンスデータリレイストレージパス(ANS)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>プロトコル</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインパスワード</p>
<p>※ansible-vault で暗号化</p>
</td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ssh 認証鍵ファイル</p></td>
<td><p>/ssh_key_files</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>サーバ証明書</p></td>
<td><p>/winrm_ca_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>インターフェース情報</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>Movement 一覧</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインパスワード</p>
<p>※ansible-vault で暗号化</p>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>IP アドレス</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>インベントリファイル追加オプション</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>WinRM 接続情報</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>基本コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>接続オプション</p>
<p>※ansible_ssh_extra_args の値</p>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>Playbook 素材集</p></td>
<td><p>プレイブック素材</p></td>
<td><p>/playbook.yml</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>Movement-Playbook紐付</p>
<p>（Movement-対話種別紐付、Movement-ロール紐付）</p>
</td>
<td><p>インクルード順序</p></td>
<td><p>/playbook.yml</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id67">
<h4>投入データを直接実行する方法<a class="headerlink" href="#id67" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id68">
<h5>① 投入データの解凍先ディレクトリの作成<a class="headerlink" href="#id68" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">以下の2つのディレクトリを作成し、1.のディレクトリに投入データを解凍します。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">/ベースディレクトリ/ドライバパス/作業番号/in</div>
</div>
</li>
<li><div class="line-block">
<div class="line">/ベースディレクトリ/ドライバパス/作業番号/out</div>
<div class="line">ベースディレクトリ　: インターフェース情報=&gt;データリレイストレージパス(Ansible)</div>
<div class="line">ドライバパス　:  legacy: legacy/ns　 Legacy-role: legacy/rl　 pioneer: pioneer/ns</div>
<div class="line">作業番号:　作業実行時の作業番号を右寄せで不足分は0を埋めた10桁の文字列。</div>
<div class="line">　　　　　 作業番号: 12345 =&gt; 0000012345</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">尚、投入データには、機器一覧にアップロードした秘密鍵ファイルが含まれていません。秘密鍵ファイルを必要といる認証方式の場合、投入データに含まれているインベントリファイル「hosts」を開き、ansible_ssh_private_key_fileに設定されているパスに秘密鍵ファイルをコピーして下さい。</div>
</div>
<div class="line-block">
<div class="line">インベントリファイル「hosts」</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> all:
children:
  hostgroups:
    hosts:
      target_host_1:
        ansible_ssh_user: keyauth_user
        ansible_ssh_private_key_file: /exastro/data_relay_storage/ansible_driver/legacy/ns/0000000060/in/ssh_key_files/0000000006-keyauth_user_id_rsa
</pre></div>
</div>
</section>
<section id="id69">
<h5>② 投入データを直接実行するコマンド<a class="headerlink" href="#id69" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">Ansible-Legacy</div>
<div class="line">　　   ansible-playbook (オプション) –i hosts --vault-password-file　パスワードファイル playbook.yml</div>
<div class="line">Ansible-Pioneer</div>
<div class="line">　　   ansible-playbook (オプション) –i hosts --vault-password-file　パスワードファイル playbook.yml</div>
<div class="line">Ansible-LegacyRole</div>
<div class="line">　　   ansible-playbook (オプション) –i hosts --vault-password-file　パスワードファイル site.yml</div>
<div class="line"><br /></div>
<div class="line">パスワードファイル名は任意です。パスワードファイルに設定するパスワードは、ＩＴＡインストール先/ita-root/confs/commonconfs/ansible_vault_accesskey.txtの内容を、rot13、base64の順でデコードした値を使用して下さい。</div>
</div>
</section>
</section>
</section>
<section id="id70">
<h3>Ansible実行時に作成される結果データ<a class="headerlink" href="#id70" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">[投入データ]をansibleで実行した結果を[結果データ]としてZIP形式で保存します。</div>
<div class="line">[結果データ]はZIP形式で「 <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」よりダウンロードが可能です。</div>
</div>
<section id="legacy">
<h4>Legacy結果データに保存されるファイル一覧<a class="headerlink" href="#legacy" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id172">
<caption><span class="caption-text">Legacy結果データの保存されるファイル一覧</span><a class="headerlink" href="#id172" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファイル名</strong></p></th>
<th class="head"><p><strong>記録内容</strong></p></th>
<th class="head"><p>AnsibleCoreの場合</p></th>
<th class="head"><p>AnsibleAutomationControllerの場合</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>result.txt</p></td>
<td><p>Ansibleの実行結果を記録</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>xxx.pid</p></td>
<td><p>Ansible-playbbokコマンドのプロセスIDを記録するファイル。</p>
<p>xxx:Ansible-playbbokコマンドのプロセスID</p>
</td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>error.log</p></td>
<td><p>作業実行時にITAがなにかしらのエラーによりエラーメッセージを出力した場合、または、Ansible-playbbokコマンドがなにかとらのエラーによりエラーメッセージを出力した場合のエラー出力先ファイル。</p>
<p>作業実行確認のエラーログに表示に表示される内容。</p>
</td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>exec.log</p></td>
<td><p>Ansible-playbbokが出力した実行ログを一部加工したログファイル。作業実行確認の実行ログに表示される内容。</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>exec.log.org</p></td>
<td><p>Ansible-playbbokが出力した実行ログ</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>I
ta_&lt;mode名&gt;_</p>
<p>execut
ions_jobtpl_</p>
<p>&lt;作業番号&gt;_&lt;
グループ番号&gt;</p>
</td>
<td><p>分割された実行ログファイルです。</p>
<p>ファイル名の命名規則は <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> の⑥実行ログ表示を参照下さい。</p>
</td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>forced.txt</p></td>
<td><p>緊急停止をした場合の記録ファイル</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>user_files</p></td>
<td><p>実行したplaybookでITA独自変数「__workflowdir__」になにかしらのファイル出力をした場合のファイルが記録されるディレクトリ。</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pioneer">
<h4>Pioneer結果データに保存されるファイル一覧<a class="headerlink" href="#pioneer" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id173">
<caption><span class="caption-text">Pioneer結果データの保存されるファイル一覧</span><a class="headerlink" href="#id173" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファイル名</strong></p></th>
<th class="head"><p><strong>記録内容</strong></p></th>
<th class="head"><p>AnsibleCoreの場合</p></th>
<th class="head"><p>AnsibleAutomationControllerの場合</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>result.txt</p></td>
<td><p>Ansibleの実行結果を記録</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>xxx.pid</p></td>
<td><p>Ansible-playbbokコマンドのプロセスIDを記録するファイル。</p>
<p>xxx:Ansible-playbbokコマンドのプロセスID</p>
</td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>pioneer.xxx</p></td>
<td><p>PioneerモジュールのプロセスIDを記録するファイル。</p>
<p>xxx: PioneerモジュールのプロセスID</p>
</td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>error.log</p></td>
<td><p>作業実行時にITAがなにかしらのエラーによりエラーメッセージを出力した場合、または、Ansible-playbbokコマンドがなにかとらのエラーによりエラーメッセージを出力した場合のエラー出力先ファイル。</p>
<p>作業実行確認のエラーログに表示に表示される内容。</p>
</td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>exec.log</p></td>
<td><p>Ansible-playbbokが出力した実行ログを一部加工したログファイル。作業実行確認の実行ログに表示される内容。</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>exec.log.org</p></td>
<td><p>Ansible-playbbokが出力した実行ログ</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>I
ta_&lt;mode名&gt;_</p>
<p>execut
ions_jobtpl_</p>
<p>&lt;作業番号&gt;_&lt;
グループ番号&gt;</p>
</td>
<td><p>分割された実行ログファイルです。</p>
<p>ファイル名の命名規則は <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> の⑥実行ログ表示を参照下さい。</p>
</td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>forced.txt</p></td>
<td><p>緊急停止をした場合の記録ファイル</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>user_files</p></td>
<td><p>実行したplaybookでITA独自変数「__workflowdir__」になにかしらのファイル出力をした場合のファイルが記録されるディレクトリ。</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
</tbody>
</table>
</section>
<section id="legacy-role">
<h4>Legacy-Role 結果データに保存されるファイル一覧<a class="headerlink" href="#legacy-role" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id174">
<caption><span class="caption-text">Legacy-Role結果データの保存されるファイル一覧</span><a class="headerlink" href="#id174" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファ
イル名</strong></p></th>
<th class="head"><p><strong>記録内容</strong></p></th>
<th class="head"><p>AnsibleCoreの場合</p></th>
<th class="head"><p>AnsibleAutomationControllerの場合</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>result.txt</p></td>
<td><p>Ansibleの実行結果を記録</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>xxx.pid</p></td>
<td><p>Ansible-playbbokコマンドのプロセスIDを記録するファイル。</p>
<p>xxx:Ansible-playbbokコマンドのプロセスID</p>
</td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>error.log</p></td>
<td><p>作業実行時にITAがなにかしらのエラーによりエラーメッセージを出力した場合、または、Ansible-playbbokコマンドがなにかとらのエラーによりエラーメッセージを出力した場合のエラー出力先ファイル。</p>
<p>作業実行確認のエラーログに表示に表示される内容。</p>
</td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>exec.log</p></td>
<td><p>Ansible-playbbokが出力した実行ログを一部加工したログファイル。作業実行確認の実行ログに表示される内容。</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>exec.log.org</p></td>
<td><p>Ansible-playbbokが出力した実行ログ</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>Ita_&lt;mode名&gt;_</p>
<p>executions_jobtpl_</p>
<p>&lt;作業番号&gt;_&lt;グループ番号&gt;</p>
</td>
<td><p>分割された実行ログファイルです。</p>
<p>ファイル名の命名規則は <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> の⑥実行ログ表示を参照下さい。</p>
</td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>forced.txt</p></td>
<td><p>緊急停止をした場合の記録ファイル</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>user_files</p></td>
<td><p>実行したplaybookでITA独自変数「__workflowdir__」になにかしらのファイル出力をした場合のファイルが記録されるディレクトリ。</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="general-operations-option-parameter-list">
<span id="id71"></span><h3>オプションパラメータ一覧<a class="headerlink" href="#general-operations-option-parameter-list" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">インターフェース情報とMovement一覧のオプションパラメータについて説明します。</div>
<div class="line">ITAでは、以下の順番でansible-playbookのオプションパラメータを設定するので、単一の値しか許容していないパラメータを複数定義した場合、Movement一覧=&gt;オプションパラメータのパラメータが有効になります。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible共通=&gt;インターフェース情報=&gt;オプションパラメータ</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movement一覧=&gt;オプションパラメータ</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">▼実行エンジンがAnsible Coreの場合</div>
<div class="line">　　実行エンジンがAnsible Coreの場合、ansible-playbookコマンドのオプションパラメータを入力します。</div>
<div class="line">　　ansible-playbookコマンドのオプションパラメータの仕様については、以下のコマンドを実行して表示されたヘルプを参照してください。</div>
<div class="line">　　「 ansible-playbook -h 」</div>
<div class="line"><br /></div>
<div class="line">▼実行エンジンがAnsible Core以外の場合</div>
<div class="line">　　以下の表 8.3.1は実行エンジンがAnsible Core以外の場合に、指定可能なオプションパラメータです。</div>
<div class="line"><br /></div>
</div>
<table class="docutils align-left" id="id175">
<caption><span class="caption-text">実行エンジンがAnsible Core以外の場合に指定可能なオプションパラメータ一覧</span><a class="headerlink" href="#id175" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>オプションパラメータ</strong></p></th>
<th class="head"><p><strong>指定方法</strong></p></th>
<th class="head"><p><strong>AnsibleAutomationControllerの設定箇所</strong></p></th>
<th class="head"><p><strong>備考</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-v</p>
<p>--verbose</p>
</td>
<td><p>-v</p>
<p>-vv</p>
<p>-vvv</p>
<p>-vvvv</p>
<p>-vvvvv</p>
<p>--verbose</p>
</td>
<td><p>テンプレート
画面の[詳細
]に指定した
vの数を設定</p></td>
<td><p>・vの合計値を適用</p>
<p>・--verboseは、-vと同様</p>
<p>例：--verbose -vvv
の場合、-vvvvと同様</p>
<p>・vを6以上指定した場合
、vは5の指定となる</p>
</td>
</tr>
<tr class="row-odd"><td><p>-f</p>
<p>--forks</p>
</td>
<td><p>-f FORKS</p>
<p>--forks=FORKS</p>
</td>
<td><p>テンプレートの[フォーク]に指定したFORKSが設定される</p></td>
<td><p>・FORKSには数値を指定</p>
<p>・複数定義した場合、最後に定義したパラメータが有効</p>
<p>例：-f 1-forks=10の場合、--forks=10が有効となる</p>
<p>・数値以外が指定された場合、エラーとなる</p>
</td>
</tr>
<tr class="row-even"><td><p>-l</p>
<p>--limit</p>
</td>
<td><p>-l SUBSET</p>
<p>--limit=SUBSET</p>
</td>
<td><p>テンプレートの[制限]に指定したSUBMITが設定される</p></td>
<td><p>・SUBSET:機器一覧にあるホスト名</p>
<p>・複数定義した場合、最後に定義したパラメータが有効</p>
</td>
</tr>
<tr class="row-odd"><td><p>-e</p>
<p>--extra-vars</p>
</td>
<td><p>-e EXTRA_VARS</p>
<p>--extra-vars=EXTRA_VARS</p>
</td>
<td><p>テンプレートの[追加変数]に変数名:具体値の形式で設定される</p></td>
<td><p>・EXTRA_VARS:変数名、具体値をjson形式またはyaml形式</p>
<p>例：json形式の場合
-extra-vars={&quot;VAR_1&quot;:&quot;directory&quot;,&quot;VAR_2&quot;:&quot;0755&quot;}</p>
<p>yaml形式の場合
-extra-vars=VAR_1:directory\nVAR_2:0755</p>
<p>・複数定義した場合、最後に定義したパラメータが有効</p>
</td>
</tr>
<tr class="row-even"><td><p>-t</p>
<p>--tags</p>
</td>
<td><p>-t TAGS</p>
<p>--tags=TAGS</p>
</td>
<td><p>テンプレートの[ジョブタグ]に設定したTAGSが設定される</p></td>
<td><p>・TAGS:タグ名</p>
<p>・複数個のパラメータを許容</p>
</td>
</tr>
<tr class="row-odd"><td><p>-b</p>
<p>--become</p>
</td>
<td><p>-b</p>
<p>--become</p>
</td>
<td><p>テンプレートのオプション[権限昇格の有効化]がチェックされる</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-even"><td><p>-D</p>
<p>--diff</p>
</td>
<td><p>-D</p>
<p>--diff</p>
</td>
<td><p>テンプレートの[変更]の表示が有効化される</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-odd"><td><p>--skip-tags</p></td>
<td><p>--skip-tags=SKIP_TAGS</p></td>
<td><p>テンプレートの[スキップタグ]に設定したSKIP_TAGSが設定される</p></td>
<td><p>・SKIP_TAGS:スキップタグ名</p>
<p>・複数個のパラメータを許容</p>
</td>
</tr>
<tr class="row-even"><td><p>--st
art-at-task</p></td>
<td><p>--start-at-task=START_AT_TASK</p></td>
<td><p>※Ansible Automation ControllerのWebUI には--start-at-taskの表示はない。</p></td>
<td><p>・複数定義した場合、最後に定義したパラメータが有効</p></td>
</tr>
<tr class="row-odd"><td><p>-ufc</p>
<p>--use
_fact_cache</p>
</td>
<td><p>-ufc</p>
<p>--use_fact_cache</p>
</td>
<td><p>テンプレートのオプション[ファクトキャッシュの有効化]がチェックされる</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-even"><td><p>-as</p>
<p>--allow_simultaneous</p>
</td>
<td><p>-as</p>
<p>--allow_simultaneous</p>
</td>
<td><p>テンプレートのオプション[同時実行ジョブの有効化]がチェックされる</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-odd"><td><p>-jsc</p>
<p>--jobslice_count</p>
</td>
<td><p>-jscジョブスライス数</p>
<p>--job_slice_count=ジョブスライス数</p>
</td>
<td><p>テンプレートの[ジョブスライス数]に指定したジョブスライス数が設定される</p></td>
<td><p>・ジョブスライス数には数値を指定</p>
<p>・複数定義した場合、最後に定義したパラメータが有効</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※Ansible Automation Controllerのオプションパラメータの仕様については、Ansible Automation Controllerユーザーガイドのジョブテンプレートの説明を参照して下さい。</div>
</div>
</section>
<section id="ansible-automation-controllerita">
<h3>Ansible Automation ControllerでITA独自変数を利用する場合の留意事項<a class="headerlink" href="#ansible-automation-controllerita" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">下記ITA独自変数を利用してファイル出力をするPlyabookを含むMovementをクラスタ構成のAnsible Automation Controllerで作業実行した場合の留意事項について記載します。</div>
<div class="line"><br /></div>
<div class="line">　対象のITA独自変数</div>
<div class="line">　・ __workflowdir__</div>
<div class="line">　・ __symphony_workflowdir__</div>
<div class="line">　・ __conductor_workflowdir__</div>
<div class="line">　・ __movement_status_filepath__</div>
<div class="line">　・ __parameters_dir_for_epc__</div>
<div class="line">　・ __parameters_file_dir_for_epc__</div>
<div class="line">　・ __parameter_dir__</div>
<div class="line">　・ __parameters_file_dir__</div>
<div class="line"><br /></div>
</div>
<section id="ita">
<h4>ITA独自変数を利用して作成したファイルの取り扱い<a class="headerlink" href="#ita" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ITA独自変数を利用して作成したファイルの出力先ディレクトリパスはAnsible Automation ControllerのITA作業用ディレクトリ配下「/var/lib/exastro」に設定されます。Movement実行前に結果データをAnsible </div>
<div class="line">Automation ControllerのITA作業用ディレクトリ配下「/var/lib/exastro」にファイル転送します。Movement実行でここに作成されたファイルは、Movement実行後に各Ansible </div>
<div class="line">Automation Controllerより結果データに上書きモードでファイル転送します。同一ファイル名でファイルを作成している場合、更新したファイルが結果データに正しく反映されない場合があります。</div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image_2b_4.png"><img alt="../../../_images/image_2b_4.png" src="../../../_images/image_2b_4.png" style="width: 7.49606in; height: 5.84593in;" /></a>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Movementをsymphony/conductorから実行している場合、Movement実行前に該当symphony/conductorインスタンス配下のファイルをAnsible Automation ControllerのITA作業用ディレクトリ配下にファイル転送</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movement実行前に該当Movement配下のファイルをAnsible Automation ControllerのITA作業用ディレクトリにファイル転送</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movementをsymphony/conductorから実行している場合、Movement実行後にAnsible Automation ControllerのITA作業用ディレクトリの該当Movementで作成したファイルを結果データにファイル転送</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movement実行後にAnsible Automation ControllerのITA作業用ディレクトリの該当symphony/conductorインスタンス配下に作成したファイルを結果データにファイル転送</div>
</div>
</li>
</ol>
</section>
<section id="id72">
<h4>留意事項<a class="headerlink" href="#id72" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ファイル名はansible「__loginhostname__」を含めるなどして、Movementに紐づいているターゲットホスト毎に同一ファイル名に出力しないように工夫して下さい。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">symphony/conductorから実行する場合、複数のMovementで同一ファイル名への出力しないよう工夫して下さい。</div>
</div>
</li>
</ol>
</section>
</section>
<section id="general-operations-data-resources-deleted-when-executing">
<span id="id73"></span><h3>実行時データ削除で削除されるデータリソース<a class="headerlink" href="#general-operations-data-resources-deleted-when-executing" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">インターフェース情報の実行時データ削除で「削除する」を選択した場合に、削除されるデータリソースを以下に列挙します。</div>
</div>
<table class="docutils align-left" id="id176">
<caption><span class="caption-text">実行時データ削除で削除されるデータリソース一覧(Ansible Automation Controller側)</span><a class="headerlink" href="#id176" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>データリソース</p></th>
<th class="head" rowspan="2"><p>リソースタイプ</p></th>
<th class="head" colspan="2"><p>実行エンジン</p></th>
<th class="head" rowspan="2"><p>備考</p></th>
</tr>
<tr class="row-even"><th class="head"><p>AnsibleTower3.x</p></th>
<th class="head"><p>Ansible Automation Controller4.x</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>ITA作業用ディレクトリ
/var/lib/exastro/ita_&lt;区分&gt;_executions_10桁の作業番号</p></td>
<td><p>ディレクトリ</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SCM管理ディレクトリ</p>
<p>/var/lib/awx/projects/ita_&lt;区分&gt;_executions_10桁の作業番号</p>
</td>
<td><p>ディレクトリ</p></td>
<td><p>〇</p></td>
<td><p>※</p></td>
<td><p>※プロジェクトリソースを削除により削除される</p></td>
</tr>
<tr class="row-odd"><td><p>インベントリリソース名:ita_&lt;区分&gt;_executions_inventory_10桁の作業番号_通番</p></td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>認証情報リソース名:ita_&lt;区分&gt;_executionscredential_10桁の作業番号_通番</p>
<p>ita_&lt;区分&gt;_executions_vault_credential_10桁の作業番号</p>
<p>ita_&lt;区分&gt;_executions_git_credential_10桁の作業番号</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>プロジェクトリソース名:ita_&lt;区分&gt;_executions_project_10桁の作業番号</p></td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ジョブテンプレートリソース名:ita_&lt;区分&gt;_executions_jobtpl_10桁の作業番号_通番</p></td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>ワークフロージョブテンプレートリソース名:ita_&lt;区分&gt;_executions_workflowtpl_10桁の作業番号</p></td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ジョブリソース名:Job番号—ita_&lt;区分&gt;_execut
ions_workflowtpl_10桁の作業番号</p>
<p>Job番号—ita_&lt;区分&gt;_executions_jobtpl_10桁の作業番号</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id177">
<caption><span class="caption-text">実行時データ削除で削除されるデータリソース一覧(ITA側)</span><a class="headerlink" href="#id177" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>データリソース</p></th>
<th class="head" rowspan="2"><p>リソースタイプ</p></th>
<th class="head" colspan="2"><p>実行エンジン</p></th>
<th class="head" rowspan="2"><p>備考</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Ansible
Automation
Controller4.x</p></th>
<th class="head"><p>Ansible</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Git リポジトリ
ITAインストールディレクトリ/ita-root/repositorys/ansible_driver/&lt;区分&gt;_10桁の作業番号</p></td>
<td><p>Gitリポジトリ</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td><p>ディレクトリごと削除</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


</div>


<div id="articleNavigation">
  <ul>
  </ul>
</div>


<div id="pageTopLink">
  <a href="#container"><i>↑</i> Page Top</a>
</div>

</article>
</div>
</main>
</div><!-- End #contents -->
<div id="footer">
  <footer class="divInner">
    <small>Copyright © 2023 NEC Corporation</small>
  </footer>
</div><!-- End #footer -->

<div id="overlay"></div>

</div><!-- End #container -->
  </body>
</html>